<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ×× ×•×™×™ ×”×ª×¨××•×ª WhatsApp - ××” ×™×© ×¤×”?</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap');
        
        :root {
            --primary-color: #F69898;
            --primary-light: #ffb6c1;
            --primary-dark: #e58080;
            --whatsapp-color: #25D366;
            --dark-bg: #333333;
            --darker-bg: #222222;
            --text-light: #ffffff;
            --text-muted: #cccccc;
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Assistant', Arial, sans-serif;
        }

        body {
            background-color: #000;
            color: white;
            direction: rtl;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(145deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: var(--text-muted);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            color: white;
            box-shadow: 0 4px 15px rgba(246, 152, 152, 0.3);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .admin-section, .section {
            background: linear-gradient(145deg, var(--dark-bg), var(--darker-bg));
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(246, 152, 152, 0.2);
        }

        .section-header {
            margin-bottom: 20px;
        }

        .section-title, .section h2, .section h3 {
            color: var(--primary-color);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(246,152,152,0.3);
        }

        .btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(246,152,152,0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--whatsapp-color), #128C7E);
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #128C7E, #0f6b5c);
            box-shadow: 0 6px 15px rgba(37, 211, 102, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-small {
            padding: 6px 10px;
            font-size: 0.8rem;
            min-width: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label, .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary-color);
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea,
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(246, 152, 152, 0.3);
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus,
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(246, 152, 152, 0.1);
        }

        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(246, 152, 152, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(246, 152, 152, 0.2);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            color: var(--primary-color);
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .filter-control {
            padding: 10px;
            border: 1px solid rgba(246, 152, 152, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.9rem;
        }

        .filter-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .whatsapp-message {
            background: #dcf8c6;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: system-ui;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #ff4757;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .success {
            background: #2ed573;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .preview-content {
            background: var(--darker-bg);
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--primary-color);
        }

        .close-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            float: right;
            margin-top: 15px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .alert-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .alert-error {
            background: linear-gradient(135deg, #dc3545, #e74c3c);
            color: white;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .search-filters {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ×›×•×ª×¨×ª -->
        <div class="header">
            <h1><i class="fas fa-users-cog"></i> × ×™×”×•×œ ×× ×•×™×™ ×”×ª×¨××•×ª WhatsApp</h1>
            <p>××¢×¨×›×ª × ×™×”×•×œ ××ª×§×“××ª ×œ×× ×•×™×™ ×”×ª×¨××•×ª ××©×¨×•×ª - ××” ×™×© ×¤×”?</p>
        </div>

        <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª -->
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="totalSubscribers">0</span>
                <div class="stat-label">×× ×•×™×™× ×¤×¢×™×œ×™×</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalAlerts">0</span>
                <div class="stat-label">×”×ª×¨××•×ª × ×©×œ×—×•</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="newThisWeek">0</span>
                <div class="stat-label">×× ×•×™×™× ×”×©×‘×•×¢</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="categoriesCount">0</span>
                <div class="stat-label">×§×˜×’×•×¨×™×•×ª ×¤×¢×™×œ×•×ª</div>
            </div>
        </div>

        <!-- ×›×œ×™ × ×™×”×•×œ -->
        <div class="admin-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-tools"></i> ×›×œ×™ × ×™×”×•×œ</h2>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="exportSubscribers()">
                    <i class="fas fa-download"></i> ×™×™×¦× ×× ×•×™×™×
                </button>
                <label for="import-file" class="btn">
                    <i class="fas fa-upload"></i> ×™×™×‘× ×× ×•×™×™×
                </label>
                <input type="file" id="import-file" style="display: none;" accept=".json" onchange="importSubscribers(event)">
                <button class="btn btn-secondary" onclick="clearAllData()">
                    <i class="fas fa-trash"></i> × ×§×” ×”×›×œ
                </button>
                <button class="btn" onclick="generateReport()">
                    <i class="fas fa-chart-bar"></i> ×“×•×— ××¤×•×¨×˜
                </button>
                <button class="btn btn-secondary" onclick="refreshSubscribersList()">
                    <i class="fas fa-sync"></i> ×¨×¢× ×Ÿ ×¨×©×™××”
                </button>
                <button class="btn" onclick="addTestSubscribers()">
                    <i class="fas fa-users-plus"></i> ×”×•×¡×£ ×× ×•×™×™× ×œ×‘×“×™×§×”
                </button>
            </div>
        </div>

        <!-- ×›×œ×™ ×‘×“×™×§×” ×•×”×ª×××•×ª -->
        <div class="admin-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-microscope"></i> ×›×œ×™ ×‘×“×™×§×” ×•×”×ª×××•×ª</h2>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="analyzeJobsStructure()">
                    <i class="fas fa-chart-pie"></i> × ×ª×— ××‘× ×” ××©×¨×•×ª
                </button>
                <button class="btn" onclick="testJobSearchDemo()">
                    <i class="fas fa-search"></i> ×‘×“×•×§ ×—×™×¤×•×© ××©×¨×•×ª
                </button>
                <button class="btn" onclick="testMatchingDemo()">
                    <i class="fas fa-users"></i> ×‘×“×•×§ ×”×ª×××ª ×× ×•×™×™×
                </button>
                <button class="btn" onclick="testCategoryMatching()">
                    <i class="fas fa-tags"></i> ×‘×“×•×§ ×”×ª×××ª ×§×˜×’×•×¨×™×•×ª
                </button>
                <button class="btn" onclick="testGenderMatching()">
                    <i class="fas fa-venus-mars"></i> ×‘×“×•×§ ×–×›×¨/× ×§×‘×”
                </button>
                <button class="btn" onclick="showMatchingRules()">
                    <i class="fas fa-book"></i> ×—×•×§×™ ×”×ª×××”
                </button>
            </div>
            
            <!-- ×‘×“×™×§×” ×‘×–××Ÿ ×××ª -->
            <div style="margin-top: 20px; padding: 20px; background: rgba(246, 152, 152, 0.05); border-radius: 10px; border: 1px solid rgba(246, 152, 152, 0.2);">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">âš¡ ×‘×“×™×§×” ×‘×–××Ÿ ×××ª</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <input type="text" id="testJobCategory" placeholder="×§×˜×’×•×¨×™×™×ª ××©×¨×”" style="padding: 10px; border: 1px solid rgba(246, 152, 152, 0.3); border-radius: 5px; background: rgba(255, 255, 255, 0.1); color: white;">
                    <input type="text" id="testSubscriberCategories" placeholder="×§×˜×’×•×¨×™×•×ª ×× ×•×™ (××•×¤×¨×“×•×ª ×‘×¤×¡×™×§)" style="padding: 10px; border: 1px solid rgba(246, 152, 152, 0.3); border-radius: 5px; background: rgba(255, 255, 255, 0.1); color: white;">
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-small" onclick="testRealTimeMatching()">
                            <i class="fas fa-play"></i> ×‘×“×•×§
                        </button>
                        <button class="btn btn-small btn-outline" onclick="clearTestInputs()">
                            <i class="fas fa-eraser"></i> × ×§×”
                        </button>
                    </div>
                </div>
                <div id="realTimeResults" style="display: none; margin-top: 15px;"></div>
            </div>
        </div>

        <!-- × ×™×ª×•×— ×”×ª×××•×ª ×—×›× -->
        <div class="admin-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-brain"></i> × ×™×ª×•×— ×”×ª×××•×ª ×—×›×</h2>
            </div>
            
            <div class="form-group">
                <label for="detailedJobSearch">×”×›× ×¡ ××¡×¤×¨ ××©×¨×” ×œ× ×™×ª×•×— ××¤×•×¨×˜:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="detailedJobSearch" placeholder="××¡×¤×¨ ××©×¨×” (×œ××©×œ: A-25821)" style="flex: 1;">
                    <button class="btn" onclick="analyzeJobMatching()">
                        <i class="fas fa-brain"></i> × ×ª×— ×”×ª×××•×ª
                    </button>
                </div>
            </div>

            <div id="detailedAnalysisResults" style="margin-top: 20px; display: none;"></div>
        </div>

        <!-- ×¡×¨×™×§×ª ××©×¨×•×ª ×•××¦×™××ª ×”×ª×××•×ª -->
<div class="admin-section">
    <div class="section-header">
        <h2 class="section-title"><i class="fas fa-radar"></i> ×¡×¨×™×§×ª ××©×¨×•×ª ×•×”×ª×××” ×œ×× ×•×™×™×</h2>
    </div>
    
    <div style="margin-bottom: 20px; padding: 15px; background: rgba(40, 167, 69, 0.1); border-radius: 8px; border: 1px solid rgba(40, 167, 69, 0.3);">
        <h4 style="color: #28a745; margin-bottom: 10px;">
            <i class="fas fa-info-circle"></i> ××™×š ×–×” ×¢×•×‘×“:
        </h4>
        <p style="margin: 0; color: #cccccc;">
            ×”××¢×¨×›×ª ×¡×•×¨×§×ª ××ª ×›×œ ×”××©×¨×•×ª ×‘×§×•×‘×¥ jobs.json ×•××ª××™××” ××•×ª×Ÿ ×œ×× ×•×™×™× ×œ×¤×™ ×”×§×˜×’×•×¨×™×•×ª ×•×”××–×•×¨×™× ×©×œ×”×.
            ×›×œ ×× ×•×™ ×™×§×‘×œ ×”×ª×¨××” ×¨×§ ×¢×œ ××©×¨×•×ª ×©××ª××™××•×ª ×‘×“×™×•×§ ×œ×”×¢×“×¤×•×ª ×©×œ×•.
        </p>
    </div>

    <div class="action-buttons">
        <button class="btn" onclick="scanAllJobsForAllSubscribers()" style="background: linear-gradient(135deg, #28a745, #20c997);">
            <i class="fas fa-search"></i> ×¡×¨×•×§ ×›×œ ×”××©×¨×•×ª
        </button>
        <button class="btn" onclick="scanNewJobsOnly()" style="background: linear-gradient(135deg, #17a2b8, #138496);">
            <i class="fas fa-clock"></i> ×¨×§ ××©×¨×•×ª ×—×“×©×•×ª
        </button>
        <button class="btn" onclick="showJobMatchingReport()">
            <i class="fas fa-chart-line"></i> ×“×•×— ×”×ª×××•×ª
        </button>
    </div>

    <div id="jobScanResults" style="margin-top: 20px; display: none;"></div>
</div>

        <!-- ×¡×§×¦×™×™×ª ×”×•×¡×¤×ª ×× ×•×™ ×—×“×© -->
        <div class="admin-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-user-plus"></i> ×”×•×¡×¤×ª ×× ×•×™ ×—×“×©</h2>
            </div>
            
            <div class="form-group">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label for="newSubscriberName" style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color);">×©× ××œ× *</label>
                        <input type="text" id="newSubscriberName" style="width: 100%; padding: 12px; border: 2px solid rgba(246, 152, 152, 0.3); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white;" placeholder="×”×›× ×¡ ×©× ××œ×" required>
                    </div>
                    <div>
                        <label for="newSubscriberPhone" style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color);">××¡×¤×¨ ×˜×œ×¤×•×Ÿ *</label>
                        <input type="tel" id="newSubscriberPhone" style="width: 100%; padding: 12px; border: 2px solid rgba(246, 152, 152, 0.3); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white;" placeholder="050-1234567" required>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color);">×ª×—×•××™ ×¢× ×™×™×Ÿ *</label>
                <div style="max-height: 200px; overflow-y: auto; border: 2px solid rgba(246, 152, 152, 0.3); border-radius: 8px; padding: 10px; background: rgba(255, 255, 255, 0.05);">
                    <div id="newSubscriberCategories" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">
                        <!-- ×§×˜×’×•×¨×™×•×ª ×™×ª×•×•×¡×¤×• ×›××Ÿ ×“×™× ××™×ª -->
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color);">××–×•×¨×™ ×¢× ×™×™×Ÿ *</label>
                <div style="max-height: 150px; overflow-y: auto; border: 2px solid rgba(246, 152, 152, 0.3); border-radius: 8px; padding: 10px; background: rgba(255, 255, 255, 0.05);">
                    <div id="newSubscriberAreas" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">
                        <!-- ××–×•×¨×™× ×™×ª×•×•×¡×¤×• ×›××Ÿ ×“×™× ××™×ª -->
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="addNewSubscriber()">
                    <i class="fas fa-user-plus"></i> ×”×•×¡×£ ×× ×•×™ ×—×“×©
                </button>
                <button class="btn btn-outline" onclick="resetNewSubscriberForm()">
                    <i class="fas fa-undo"></i> × ×§×” ×˜×•×¤×¡
                </button>
            </div>
        </div>

        <!-- ×©×œ×™×—×” ×××•×§×“×ª ×œ×¤×™ ××¡×¤×¨ ××©×¨×” -->
        <div class="admin-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-search-plus"></i> ×©×œ×™×—×” ×××•×§×“×ª ×œ×¤×™ ××¡×¤×¨ ××©×¨×”</h2>
            </div>
            
            <div class="form-group">
                <label for="jobSearchInput">××¡×¤×¨ ××©×¨×” (×œ××©×œ: A-25821)</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="jobSearchInput" placeholder="×”×›× ×¡ ××¡×¤×¨ ××©×¨×” ×œ×—×™×¤×•×©..." style="flex: 1;">
                    <button class="btn" onclick="searchJobAndSend()">
                        <i class="fas fa-search"></i> ×—×¤×© ×•×©×œ×—
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label>××• ×”×›× ×¡ ×¤×¨×˜×™ ××©×¨×” ×™×“× ×™×ª:</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <input type="text" id="manualJobTitle" placeholder="×›×•×ª×¨×ª ×”××©×¨×”">
                    <select id="manualArea">
                        <option value="">×‘×—×¨ ××–×•×¨</option>
                        <!-- ××–×•×¨×™× ×™×ª×•×•×¡×¤×• ×“×™× ××™×ª -->
                    </select>
                    <select id="manualCategory">
                        <option value="">×‘×—×¨ ×§×˜×’×•×¨×™×”</option>
                        <!-- ×§×˜×’×•×¨×™×•×ª ×™×ª×•×•×¡×¤×• ×“×™× ××™×ª -->
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="sendManualJob()">
                    <i class="fas fa-paper-plane"></i> ×©×œ×— ××©×¨×” ×™×“× ×™×ª
                </button>
            </div>

            <div id="jobSearchResults" style="margin-top: 20px;"></div>
        </div>

        <!-- ×©×œ×™×—×” ×™×©×™×¨×” ×œ×× ×•×™ ×¡×¤×¦×™×¤×™ -->
        <div class="admin-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-user-plus"></i> ×©×œ×™×—×” ×™×©×™×¨×” ×œ×× ×•×™ ×¡×¤×¦×™×¤×™</h2>
            </div>
            
            <div class="form-group">
                <label for="subscriberSelect">×‘×—×¨ ×× ×•×™:</label>
                <select id="subscriberSelect">
                    <option value="">×‘×—×¨ ×× ×•×™ ××”×¨×©×™××”...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="directMessage">×”×•×“×¢×” ××•×ª×××ª ××™×©×™×ª:</label>
                <textarea id="directMessage" rows="4" placeholder="×›×ª×•×‘ ×”×•×“×¢×” ××•×ª×××ª ××™×©×™×ª ×œ×× ×•×™..."></textarea>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="previewDirectMessage()">
                    <i class="fas fa-eye"></i> ×ª×¦×•×’×” ××§×“×™××”
                </button>
                <button class="btn btn-secondary" onclick="sendDirectMessage()">
                    <i class="fas fa-paper-plane"></i> ×©×œ×— ×”×•×“×¢×”
                </button>
            </div>
        </div>

        <!-- ×—×™×¤×•×© ×•×¡×™× ×•×Ÿ -->
        <div class="section">
            <h2><i class="fas fa-search"></i> ×¨×©×™××ª ×× ×•×™×™×</h2>
            
            <div class="search-filters">
                <div class="filter-group">
                    <label class="filter-label">×—×™×¤×•×©:</label>
                    <input type="text" class="filter-control" id="searchInput" placeholder="×—×¤×© ×œ×¤×™ ×©× ××• ×˜×œ×¤×•×Ÿ...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">×§×˜×’×•×¨×™×”:</label>
                    <select class="filter-control" id="filterCategory">
                        <option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">××–×•×¨:</label>
                    <select class="filter-control" id="filterArea">
                        <option value="">×›×œ ×”××–×•×¨×™×</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">×ª××¨×™×š ×”×¨×©××”:</label>
                    <select class="filter-control" id="filterDate">
                        <option value="">×›×œ ×”×ª××¨×™×›×™×</option>
                        <option value="today">×”×™×•×</option>
                        <option value="week">×”×©×‘×•×¢</option>
                        <option value="month">×”×—×•×“×©</option>
                    </select>
                </div>
            </div>

            <div id="subscribersCount" style="margin-bottom: 20px; padding: 10px; background: rgba(246, 152, 152, 0.1); border-radius: 5px;">
                <i class="fas fa-users"></i>
                <span>×¡×”"×› ×× ×•×™×™×: <strong id="totalCount">0</strong></span>
                <span>××•×¦×’×™×: <strong id="visibleCount">0</strong></span>
            </div>

            <div id="subscribersList"></div>
        </div>

        <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª -->
        <div class="section">
            <h2><i class="fas fa-chart-bar"></i> ×¡×˜×˜×™×¡×˜×™×§×•×ª</h2>
            <div id="statsContainer" class="stats-grid">
                <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª ×™×•×¦×’×• ×›××Ÿ -->
            </div>
        </div>
    </div>

    <script>
        // ××—×œ×§×” ×œ× ×™×”×•×œ ××©×¨×•×ª ×¢× × ×ª×•× ×™× ××•×‘× ×™×
        class JobsManager {
            constructor() {
                this.jobs = [];
                this.lastUpdate = null;
                this.loading = false;
                
                // ×˜×¢×™× ×” ×¨××©×•× ×™×ª
                this.loadJobs();
            }

            async loadJobs() {
                if (this.loading) return;
                
                this.loading = true;
                try {
                    console.log('ğŸ”„ ×˜×•×¢×Ÿ ××©×¨×•×ª...');
                    
// × ×™×¡×™×•×Ÿ ×˜×¢×™× ×” ××§×•×‘×¥ ×”××©×¨×•×ª
                    try {
const response = await fetch('data/jobs.json?t=' + Date.now());
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            if (Array.isArray(data) && data.length > 0) {
                                this.jobs = data;
                                this.lastUpdate = new Date();
console.log(`âœ… × ×˜×¢× ×• ${this.jobs.length} ××©×¨×•×ª ××§×•×‘×¥ ×”××©×¨×•×ª ×‘×”×¦×œ×—×”`);
                                this.updateDynamicOptions();
                                return;
                            }
                        }
                    } catch (error) {
console.log('âš ï¸ ×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ ××§×•×‘×¥ ×”××©×¨×•×ª, ×¢×•×‘×¨ ×œ× ×ª×•× ×™× ××•×‘× ×™×...');
                    }
                    
                    // ×˜×¢×™× ×ª × ×ª×•× ×™× ××•×‘× ×™×
                    this.loadBuiltInJobs();
                    
                } finally {
                    this.loading = false;
                }
            }

            loadBuiltInJobs() {
                console.log('ğŸ“‹ ×˜×•×¢×Ÿ × ×ª×•× ×™× ××•×‘× ×™×...');
                
                this.jobs = [
                    {
                        jobNumber: "A-25821",
                        title: "× ×”×’/×ª ××©××™×ª ×× ×•×£ ××¢×œ 15 ×˜×•×Ÿ",
                        category: "×œ×•×’×™×¡×˜×™×§×”, ××—×¡× ×™×, ×©×™×œ×•×— ×•×¨×›×©",
                        region: "×“×¨×•×",
                        city: "××©×“×•×“",
                        status: "×¤×¢×™×œ",
                        id: "A-25821"
                    },
                    {
                        jobNumber: "B-12345",
                        title: "××¤×ª×—/×ª Full Stack",
                        category: "×¤×™×ª×•×— ×•×ª×•×›× ×”",
                        region: "××¨×›×–",
                        city: "×ª×œ ××‘×™×‘",
                        status: "×¤×¢×™×œ",
                        id: "B-12345"
                    },
                    {
                        jobNumber: "C-67890",
                        title: "××•×¨×”/××—× ×š ×œ×—×™× ×•×š ××™×•×—×“",
                        category: "×—×™× ×•×š ×•×”×•×¨××”",
                        region: "×¦×¤×•×Ÿ",
                        city: "×—×™×¤×”",
                        status: "×¤×¢×™×œ",
                        id: "C-67890"
                    },
                    {
                        jobNumber: "D-11111",
                        title: "××•×›×¨/×ª ×‘×—× ×•×ª ×‘×’×“×™×",
                        category: "××›×™×¨×•×ª ×•×©×™×•×•×§",
                        region: "××¨×›×–",
                        city: "×¨××ª ×’×Ÿ",
                        status: "×¤×¢×™×œ",
                        id: "D-11111"
                    },
                    {
                        jobNumber: "E-22222",
                        title: "××˜×¤×œ/×ª ×¡×™×¢×•×“×™",
                        category: "×‘×¨×™××•×ª ×•×¨×¤×•××”",
                        region: "×™×¨×•×©×œ×™×",
                        city: "×™×¨×•×©×œ×™×",
                        status: "×¤×¢×™×œ",
                        id: "E-22222"
                    },
                    {
                        jobNumber: "F-33333",
                        title: "×˜×‘×—/×™×ª ×‘××¡×¢×“×” ×™×•×§×¨×ª×™×ª",
                        category: "××–×•×Ÿ ×•××©×§××•×ª",
                        region: "××¨×›×–",
                        city: "×ª×œ ××‘×™×‘",
                        status: "×¤×¢×™×œ",
                        id: "F-33333"
                    },
                    {
                        jobNumber: "G-44444",
                        title: "×©×•××¨/×ª ××‘×˜×—×” ×‘××¨×›×– ×§× ×™×•×ª",
                        category: "×©××™×¨×” ×•××‘×˜×—×”",
                        region: "×“×¨×•×",
                        city: "×‘××¨ ×©×‘×¢",
                        status: "×¤×¢×™×œ",
                        id: "G-44444"
                    },
                    {
                        jobNumber: "H-55555",
                        title: "×× ×”×œ/×ª ×¤×¨×•×™×§×˜×™×",
                        category: "× ×™×”×•×œ ×•×ª×™××•×",
                        region: "××¨×›×–",
                        city: "×¤×ª×— ×ª×§×•×•×”",
                        status: "×¤×¢×™×œ",
                        id: "H-55555"
                    },
                    {
                        jobNumber: "I-66666",
                        title: "× ×¦×™×’/×ª ×©×™×¨×•×ª ×œ×§×•×—×•×ª",
                        category: "×©×™×¨×•×ª ×œ×§×•×—×•×ª",
                        region: "×›×œ ×”××¨×¥",
                        city: "×¢×‘×•×“×” ××”×‘×™×ª",
                        status: "×¤×¢×™×œ",
                        id: "I-66666"
                    },
                    {
                        jobNumber: "J-77777",
                        title: "×¢×•×‘×“/×ª ×™×™×¦×•×¨ ×‘××¤×¢×œ",
                        category: "×™×™×¦×•×¨ ×•×ª×¢×©×™×™×”",
                        region: "×¦×¤×•×Ÿ",
                        city: "× ×”×¨×™×”",
                        status: "×¤×¢×™×œ",
                        id: "J-77777"
                    }
                ];
                
                this.lastUpdate = new Date();
                console.log(`âœ… × ×˜×¢× ×• ${this.jobs.length} ××©×¨×•×ª ××•×‘× ×•×ª`);
                
                // ×¢×“×›×•×Ÿ ×§×˜×’×•×¨×™×•×ª ×•××–×•×¨×™×
                this.updateDynamicOptions();
            }

            updateDynamicOptions() {
                if (!this.jobs || this.jobs.length === 0) return;
                
                // ×—×™×œ×•×¥ ×§×˜×’×•×¨×™×•×ª ×•××–×•×¨×™× ××”××©×¨×•×ª
                const categories = new Set();
                const areas = new Set();
                
                this.jobs.forEach(job => {
                    if (job.category) categories.add(job.category);
                    if (job.region) areas.add(job.region);
                    if (job.area) areas.add(job.area);
                });
                
                this.categories = Array.from(categories);
                this.areas = Array.from(areas);
                
                console.log(`ğŸ“Š × ××¦××• ${this.categories.length} ×§×˜×’×•×¨×™×•×ª ×•-${this.areas.length} ××–×•×¨×™×`);
            }

            getCategories() {
                return this.categories && this.categories.length > 0 ? this.categories : [
                    "×œ×•×’×™×¡×˜×™×§×”, ××—×¡× ×™×, ×©×™×œ×•×— ×•×¨×›×©",
                    "×¤×™×ª×•×— ×•×ª×•×›× ×”",
                    "××›×™×¨×•×ª ×•×©×™×•×•×§",
                    "×—×™× ×•×š ×•×”×•×¨××”",
                    "××–×•×Ÿ ×•××©×§××•×ª",
                    "×‘×¨×™××•×ª ×•×¨×¤×•××”",
                    "×©××™×¨×” ×•××‘×˜×—×”",
                    "× ×™×”×•×œ ×•×ª×™××•×",
                    "×©×™×¨×•×ª ×œ×§×•×—×•×ª",
                    "×™×™×¦×•×¨ ×•×ª×¢×©×™×™×”",
                    "××—×¨"
                ];
            }

            getAreas() {
                return this.areas && this.areas.length > 0 ? this.areas : [
                    "××¨×›×–",
                    "×¦×¤×•×Ÿ",
                    "×“×¨×•×",
                    "×™×¨×•×©×œ×™×",
                    "×›×œ ×”××¨×¥",
                    "××—×¨"
                ];
            }

            findJobById(jobId) {
                if (!jobId || !this.jobs) return null;

                const cleanJobId = jobId.toString().trim();
                
                const job = this.jobs.find(job => {
                    if (!job) return false;
                    
                    if (job.jobNumber && job.jobNumber.toString().trim() === cleanJobId) {
                        return true;
                    }
                    
                    if (job.id && job.id.toString().trim() === cleanJobId) {
                        return true;
                    }
                    
                    if (cleanJobId.length > 3) {
                        if (job.title && job.title.includes(cleanJobId)) return true;
                    }
                    
                    return false;
                });

                if (job) {
                    console.log(`âœ… × ××¦××” ××©×¨×”: ${job.jobNumber} - ${job.title}`);
                } else {
                    console.log(`âŒ ×œ× × ××¦××” ××©×¨×” ×¢× ×”××¡×¤×¨: ${cleanJobId}`);
                }

                return job;
            }

            normalizeJob(job) {
                if (!job) return null;

                return {
                    id: job.jobNumber || job.id || 'unknown',
                    jobNumber: job.jobNumber || job.id || 'unknown', 
                    title: job.title || '×œ×œ× ×›×•×ª×¨×ª',
                    area: job.region || job.area || '×œ× ×¦×•×™×Ÿ',
                    region: job.region || job.area || '×œ× ×¦×•×™×Ÿ',
                    city: job.city || '×œ× ×¦×•×™×Ÿ',
                    category: job.category || '××—×¨',
                    description: job.description || '',
                    requirements: job.requirements || '',
                    salary: job.salary || '×œ×¤×™ × ×™×¡×™×•×Ÿ',
                    status: job.status || 'unknown',
                    featured: job.featured || false,
                    createdAt: job.createdAt || new Date().toISOString()
                };
            }

            findMatchingSubscribers(job, subscribers) {
                if (!job || !subscribers) return [];

                return subscribers.filter(subscriber => {
                    const categoryMatch = this.matchCategory(job.category, subscriber.categories);
                    const areaMatch = this.matchArea(job.region || job.area, subscriber.areas);
                    
                    return categoryMatch && areaMatch;
                });
            }

            matchCategory(jobCategory, subscriberCategories) {
                if (!jobCategory || !subscriberCategories) return false;
                
                const jobCat = jobCategory.toLowerCase();
                
                return subscriberCategories.some(subCat => {
                    const subCatLower = subCat.toLowerCase();
                    
                    // ×”×ª×××” ××“×•×™×§×ª
                    if (jobCat === subCatLower) return true;
                    
                    // ×”×ª×××” ×—×œ×§×™×ª
                    if (jobCat.includes(subCatLower) || subCatLower.includes(jobCat)) return true;
                    
                    // ×”×ª×××” ×œ×¤×™ ××™×œ×•×ª ××¤×ª×—
                    if (this.matchByKeywords(jobCat, subCatLower)) return true;
                    
                    // ×˜×™×¤×•×œ ×‘××§×¨×™× ×©×œ ×–×›×¨/× ×§×‘×” ×¢× ×¡×œ××© (/)
                    if (jobCat.includes('/')) {
                        const parts = jobCat.split('/');
                        return parts.some(part => {
                            const cleanPart = part.trim();
                            return subCatLower.includes(cleanPart) || 
                                   cleanPart.includes(subCatLower) ||
                                   this.matchByKeywords(cleanPart, subCatLower);
                        });
                    }
                    
                    // ×× ×”×× ×•×™ ××—×¤×© ××©×”×• ×¢× ×¡×œ××© - × ×‘×“×•×§ ×’× ×œ×œ× ×”×¡×œ××©
                    if (subCatLower.includes('/')) {
                        const parts = subCatLower.split('/');
                        return parts.some(part => {
                            const cleanPart = part.trim();
                            return jobCat.includes(cleanPart) || 
                                   cleanPart.includes(jobCat) ||
                                   this.matchByKeywords(jobCat, cleanPart);
                        });
                    }
                    
                    return false;
                });
            }

            matchByKeywords(jobCategory, subscriberCategory) {
                const keywordMap = {
                    '×œ×•×’×™×¡×˜×™×§×”': ['× ×”×’', '× ×”×™×’×”', '××©××™×ª', '×× ×•×£', '×”×•×‘×œ×”', '××—×¡×Ÿ', '×©×™×œ×•×—', '×“×¨×™×™×‘×¨'],
                    '× ×”×™×’×”': ['×œ×•×’×™×¡×˜×™×§×”', '××©××™×ª', '×× ×•×£', '×”×•×‘×œ×”', '×ª×—×‘×•×¨×”', '×“×¨×™×™×‘×¨', '× ×”×’'],
                    '×¤×™×ª×•×—': ['××¤×ª×—', '×ª×›× ×•×ª', '×ª×•×›× ×”', 'programmer', 'developer', '×§×•×“', '××¤×œ×™×§×¦×™×”'],
                    '××›×™×¨×•×ª': ['×©×™×•×•×§', 'marketing', 'sales', '××•×›×¨', '×¡×™×™×œ', '×™×™×¢×•×¥'],
                    '×—×™× ×•×š': ['××•×¨×”', '×”×•×¨××”', '××—× ×š', '×’× × ×ª', '×—×™× ×•×›×™×ª', '××—× ×›×ª'],
                    '×‘×¨×™××•×ª': ['×¨×¤×•××”', '×¨×¤×•××™', '×¨×•×¤×', '××—×•×ª', '×¤×™×–×™×•×ª×¨×¤×™×”', '×˜×™×¤×•×œ'],
                    '××–×•×Ÿ': ['××¡×¢×“×”', '×‘×™×©×•×œ', '×˜×‘×—', '×©×£', '××˜×‘×—', '×§×™×™×˜×¨×™× ×’'],
                    '××‘×˜×—×”': ['×©××™×¨×”', '×‘×™×˜×—×•×Ÿ', '×©×•××¨', '×××‘×˜×—'],
                    '×©×™×¨×•×ª': ['×œ×§×•×—×•×ª', '×§×¨×™××•×ª', '×ª××™×›×”', '××•×§×“'],
                    '× ×™×”×•×œ': ['×× ×”×œ', '×× ×”×œ×ª', '×¨×™×›×•×–', '×‘×™×¦×•×¢', '×ª×™××•×']
                };

                // ×—×™×¤×•×© ×“×•-×›×™×•×•× ×™
                for (const [key, keywords] of Object.entries(keywordMap)) {
                    // ×× ×”×§×˜×’×•×¨×™×” ×©×œ ×”××©×¨×” ××›×™×œ×” ××™×œ×” ××¤×ª×—
                    if (jobCategory.includes(key)) {
                        if (keywords.some(k => subscriberCategory.includes(k))) {
                            return true;
                        }
                    }
                    
                    // ×× ×”×§×˜×’×•×¨×™×” ×©×œ ×”×× ×•×™ ××›×™×œ×” ××™×œ×” ××¤×ª×—
                    if (subscriberCategory.includes(key)) {
                        if (keywords.some(k => jobCategory.includes(k))) {
                            return true;
                        }
                    }
                    
                    // ×—×™×¤×•×© ×‘××™×œ×•×ª ×”××¤×ª×— ×¢×¦××Ÿ
                    keywords.forEach(keyword => {
                        if (jobCategory.includes(keyword) && subscriberCategory.includes(key)) {
                            return true;
                        }
                        if (subscriberCategory.includes(keyword) && jobCategory.includes(key)) {
                            return true;
                        }
                    });
                }

                return false;
            }

            matchArea(jobArea, subscriberAreas) {
                if (!jobArea || !subscriberAreas) return false;
                
                const jobAreaLower = jobArea.toLowerCase();
                
                return subscriberAreas.some(subArea => {
                    const subAreaLower = subArea.toLowerCase();
                    
                    // ×”×ª×××” ××“×•×™×§×ª ××• ×—×œ×§×™×ª
                    if (jobAreaLower === subAreaLower || 
                        jobAreaLower.includes(subAreaLower) || 
                        subAreaLower.includes(jobAreaLower)) {
                        return true;
                    }
                    
                    // ×”×ª×××” ×œ××™×•×—×“×™×
                    if (subAreaLower === '×›×œ ×”××¨×¥' || 
                        subAreaLower === '××—×¨' || 
                        jobAreaLower === '×›×œ ×”××¨×¥') {
                        return true;
                    }
                    
                    // ×”×ª×××•×ª ×œ××–×•×¨×™× ×’×™××•×’×¨×¤×™×™× ×¨×—×‘×™×
                    if (subAreaLower === '××¨×›×–' && 
                        (jobAreaLower.includes('×ª×œ ××‘×™×‘') || 
                         jobAreaLower.includes('×¨××ª ×’×Ÿ') || 
                         jobAreaLower.includes('×’×•×© ×“×Ÿ'))) {
                        return true;
                    }
                    
                    return false;
                });
            }

            getAllJobs() {
                return this.jobs || [];
            }

            async reloadJobs() {
                console.log('ğŸ”„ ××¨×¢× ×Ÿ ××©×¨×•×ª...');
                this.jobs = [];
                await this.loadJobs();
                return this.jobs.length;
            }
        }

        // ×™×¦×™×¨×ª ×× ×”×œ ×”××©×¨×•×ª
        const correctJobsManager = new JobsManager();

        // ×¨×¢× ×•×Ÿ × ×ª×•× ×™ ××©×¨×•×ª
        async function refreshJobsData() {
            try {
                const count = await correctJobsManager.reloadJobs();
                
                // ×¢×“×›×•×Ÿ ×˜×¤×¡×™×
                setTimeout(() => {
                    createNewSubscriberForm();
                    adminPanel?.loadSubscriberSelect?.();
                }, 500);
                
                adminPanel?.showAlert(`âœ… ×¨×¢× ×•×Ÿ ×”×•×©×œ× - × ×˜×¢× ×• ${count} ××©×¨×•×ª`, 'success');
            } catch (error) {
                adminPanel?.showAlert('âŒ ×©×’×™××” ×‘×¨×¢× ×•×Ÿ × ×ª×•× ×™ ××©×¨×•×ª', 'error');
                console.error('×©×’×™××” ×‘×¨×¢× ×•×Ÿ:', error);
            }
        }

        // ××¢×¨×›×ª × ×™×”×•×œ ×× ×•×™×™× ××¢×•×“×›× ×ª
        class AdminPanel {
            constructor() {
                this.whatsappAlerts = null;
                this.currentFilter = {
                    category: '',
                    area: '',
                    date: '',
                    search: ''
                };
                this.init();
            }

            async init() {
                // ×™×¦×™×¨×ª ××¢×¨×›×ª WhatsApp Alerts ×¢× × ×ª×•× ×™× ×‘×¡×™×¡×™×™×
                this.whatsappAlerts = {
                    subscribers: JSON.parse(localStorage.getItem('whatsapp_alerts_subscribers') || '[]'),
                    options: {
                        adminPhone: "972555504633", // ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×”××¢×•×“×›×Ÿ ×©×œ×š
categories: correctJobsManager.getCategories(),
areas: correctJobsManager.getAreas()
                    },
                    getSubscribers: () => this.whatsappAlerts.subscribers,
                    addSubscriber: (subscriber) => {
                        this.whatsappAlerts.subscribers.push(subscriber);
                        this.saveSubscribers();
                    },
                    removeSubscriber: (phone) => {
                        this.whatsappAlerts.subscribers = this.whatsappAlerts.subscribers.filter(s => s.phone !== phone);
                        this.saveSubscribers();
                    },
                    sendDirectAlert: (subscriberData) => {
                        const phoneNumber = this.whatsappAlerts.options.adminPhone;
                        
                        const message = encodeURIComponent(
                            `×× ×•×™ ×—×“×© × ×¨×©× ×œ×”×ª×¨××•×ª ××©×¨×•×ª!\n\n` +
                            `×©×: ${subscriberData.name}\n` +
                            `×˜×œ×¤×•×Ÿ: ${subscriberData.phone}\n` +
                            `×ª×—×•××™ ×¢× ×™×™×Ÿ: ${subscriberData.categories.join(', ')}\n` +
                            `××–×•×¨×™×: ${subscriberData.areas.join(', ')}\n` +
                            `××§×•×¨: ${subscriberData.source || '××ª×¨'}\n` +
                            `×ª××¨×™×š: ${new Date().toLocaleString('he-IL')}`
                        );
                        
                        const whatsappUrl = `https://wa.me/${phoneNumber}?text=${message}`;
                        window.open(whatsappUrl, '_blank');
                        
                        return true;
                    }
                };
                
                this.loadFilters();
                this.renderSubscribers();
                this.updateStats();
                this.attachEvents();
                
                // ×˜×¢×™× ×ª ×¨×©×™××ª ×× ×•×™×™× ×œ×©×œ×™×—×” ×™×©×™×¨×”
                this.loadSubscriberSelect();
                
                // ×˜×¢×™× ×ª ×ª×‘× ×™×•×ª ×‘×—×™×¨×” ×©×œ ××©×¨×•×ª ×™×“× ×™×•×ª
                this.loadManualJobSelectors();
                
                console.log('ğŸ”§ ×¤×× ×œ × ×™×”×•×œ ×”×•×¤×¢×œ');
            }

            saveSubscribers() {
                if (this.whatsappAlerts && this.whatsappAlerts.subscribers) {
                    localStorage.setItem('whatsapp_alerts_subscribers', JSON.stringify(this.whatsappAlerts.subscribers));
                }
            }

            loadFilters() {
                const categoryFilter = document.getElementById('filterCategory');
                const areaFilter = document.getElementById('filterArea');
                
                // ×˜×¢×™× ×ª ×§×˜×’×•×¨×™×•×ª
                categoryFilter.innerHTML = '<option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>';
correctJobsManager.getCategories().forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                });

                // ×˜×¢×™× ×ª ××–×•×¨×™×
                areaFilter.innerHTML = '<option value="">×›×œ ×”××–×•×¨×™×</option>';
correctJobsManager.getAreas().forEach(area => {
                    const option = document.createElement('option');
                    option.value = area;
                    option.textContent = area;
                    areaFilter.appendChild(option);
                });
            }

            loadSubscriberSelect() {
                const select = document.getElementById('subscriberSelect');
                if (!select) return;
                
                const subscribers = this.whatsappAlerts ? this.whatsappAlerts.getSubscribers() : [];
                
                select.innerHTML = '<option value="">×‘×—×¨ ×× ×•×™ ××”×¨×©×™××”...</option>';
                
                if (subscribers.length === 0) {
                    select.innerHTML += '<option value="" disabled>××™×Ÿ ×× ×•×™×™× ×¢×“×™×™×Ÿ</option>';
                    return;
                }
                
                subscribers.forEach((subscriber, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${subscriber.phone} - ${subscriber.name || '×œ×œ× ×©×'}`;
                    select.appendChild(option);
                });
            }

            loadManualJobSelectors() {
                const categorySelect = document.getElementById('manualCategory');
                const areaSelect = document.getElementById('manualArea');
                
                if (categorySelect) {
                    categorySelect.innerHTML = '<option value="">×‘×—×¨ ×§×˜×’×•×¨×™×”</option>';
correctJobsManager.getCategories().forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                }
                
                if (areaSelect) {
                    areaSelect.innerHTML = '<option value="">×‘×—×¨ ××–×•×¨</option>';
correctJobsManager.getAreas().forEach(area => {
                        const option = document.createElement('option');
                        option.value = area;
                        option.textContent = area;
                        areaSelect.appendChild(option);
                    });
                }
            }

            attachEvents() {
                // ×—×™×¤×•×© ×•×¡×™× ×•×Ÿ
                const searchInput = document.getElementById('searchInput');
                const filterCategory = document.getElementById('filterCategory');
                const filterArea = document.getElementById('filterArea');
                const filterDate = document.getElementById('filterDate');

                if (searchInput) searchInput.addEventListener('input', () => this.filterSubscribers());
                if (filterCategory) filterCategory.addEventListener('change', () => this.filterSubscribers());
                if (filterArea) filterArea.addEventListener('change', () => this.filterSubscribers());
                if (filterDate) filterDate.addEventListener('change', () => this.filterSubscribers());

                // ××§×œ×“×ª
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeAllModals();
                    }
                });
            }

            renderSubscribers() {
                const subscribers = this.getFilteredSubscribers();
                const container = document.getElementById('subscribersList');
                
                if (!subscribers || subscribers.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-users" style="font-size: 3em; margin-bottom: 20px; opacity: 0.3; color: var(--primary-color);"></i>
                            <h3>××™×Ÿ ×× ×•×™×™× ×œ×”×¦×’×”</h3>
                            <p>×¢×“×™×™×Ÿ ×œ× × ×¨×©××• ×× ×•×™×™× ×‘××¢×¨×›×ª ××• ×©×”×¡×™× ×•×Ÿ ××¡×ª×™×¨ ××ª ×›×•×œ×</p>
                            <button class="btn" onclick="addTestSubscribers()" style="margin-top: 15px;">
                                <i class="fas fa-users-plus"></i> ×”×•×¡×£ ×× ×•×™×™× ×œ×‘×“×™×§×”
                            </button>
                        </div>
                    `;
                    this.updateCounts(0, 0);
                    return;
                }

                const html = subscribers.map(subscriber => `
                    <div style="background: rgba(246, 152, 152, 0.1); border: 1px solid rgba(246, 152, 152, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: bold; color: var(--primary-color);">${subscriber.name || '×œ×œ× ×©×'}</div>
                                <div style="font-family: monospace; background: rgba(246, 152, 152, 0.2); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 5px;">${subscriber.phone}</div>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn btn-small btn-secondary" onclick="contactSubscriber('${subscriber.phone}')" title="×©×œ×— ×”×•×“×¢×”">
                                    <i class="fab fa-whatsapp"></i>
                                </button>
                                <button class="btn btn-small btn-danger" onclick="removeSubscriber('${subscriber.phone}')" title="×”×¡×¨ ×× ×•×™">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div>
                                <strong style="color: var(--primary-color);">×§×˜×’×•×¨×™×•×ª:</strong><br>
                                <div style="display: flex; flex-wrap: wrap; gap: 3px; margin-top: 3px;">
                                    ${subscriber.categories ? subscriber.categories.map(cat => `<span style="background: rgba(37, 211, 102, 0.2); color: #25D366; padding: 2px 6px; border-radius: 10px; font-size: 0.8em;">${cat}</span>`).join('') : '×œ× ×¦×•×™×Ÿ'}
                                </div>
                            </div>
                            <div>
                                <strong style="color: var(--primary-color);">××–×•×¨×™×:</strong><br>
                                <div style="display: flex; flex-wrap: wrap; gap: 3px; margin-top: 3px;">
                                    ${subscriber.areas ? subscriber.areas.map(area => `<span style="background: rgba(246, 152, 152, 0.2); color: var(--primary-color); padding: 2px 6px; border-radius: 10px; font-size: 0.8em;">${area}</span>`).join('') : '×œ× ×¦×•×™×Ÿ'}
                                </div>
                            </div>
                        </div>
                        
                        <div style="font-size: 0.9em; color: #999;">
                            ×ª××¨×™×š ×”×¨×©××”: ${subscriber.registrationDate ? new Date(subscriber.registrationDate).toLocaleDateString('he-IL') : '×œ× ×™×“×•×¢'}
                        </div>
                    </div>
                `).join('');

                container.innerHTML = html;
                
                // ×¢×“×›×•×Ÿ ××•× ×™×
                const totalSubscribers = this.whatsappAlerts ? this.whatsappAlerts.getSubscribers().length : 0;
                this.updateCounts(totalSubscribers, subscribers.length);
            }

            updateCounts(total, visible) {
                const totalCount = document.getElementById('totalCount');
                const visibleCount = document.getElementById('visibleCount');
                
                if (totalCount) totalCount.textContent = total;
                if (visibleCount) visibleCount.textContent = visible;
            }

            getFilteredSubscribers() {
                let subscribers = this.whatsappAlerts ? this.whatsappAlerts.getSubscribers() : [];
                
                // ×¡×™× ×•×Ÿ ×œ×¤×™ ×§×˜×’×•×¨×™×”
                const categoryFilter = document.getElementById('filterCategory');
                if (categoryFilter && categoryFilter.value) {
                    subscribers = subscribers.filter(sub => 
                        sub.categories && sub.categories.includes(categoryFilter.value)
                    );
                }

                // ×¡×™× ×•×Ÿ ×œ×¤×™ ××–×•×¨
                const areaFilter = document.getElementById('filterArea');
                if (areaFilter && areaFilter.value) {
                    subscribers = subscribers.filter(sub => 
                        sub.areas && sub.areas.includes(areaFilter.value)
                    );
                }

                // ×¡×™× ×•×Ÿ ×œ×¤×™ ×ª××¨×™×š
                const dateFilter = document.getElementById('filterDate');
                if (dateFilter && dateFilter.value) {
                    const now = new Date();
                    let filterDate;
                    
                    switch (dateFilter.value) {
                        case 'today':
                            filterDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                            break;
                        case 'week':
                            filterDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            break;
                        case 'month':
                            filterDate = new Date(now.getFullYear(), now.getMonth(), 1);
                            break;
                    }
                    
                    if (filterDate) {
                        subscribers = subscribers.filter(sub => 
                            sub.registrationDate && new Date(sub.registrationDate) >= filterDate
                        );
                    }
                }

                // ×¡×™× ×•×Ÿ ×œ×¤×™ ×—×™×¤×•×© ×˜×§×¡×˜
                const searchInput = document.getElementById('searchInput');
                if (searchInput && searchInput.value) {
                    const searchTerm = searchInput.value.toLowerCase();
                    subscribers = subscribers.filter(sub => 
                        (sub.name && sub.name.toLowerCase().includes(searchTerm)) ||
                        (sub.phone && sub.phone.includes(searchTerm)) ||
                        (sub.categories && sub.categories.some(cat => cat.toLowerCase().includes(searchTerm))) ||
                        (sub.areas && sub.areas.some(area => area.toLowerCase().includes(searchTerm)))
                    );
                }

                return subscribers;
            }

            filterSubscribers() {
                this.renderSubscribers();
            }

            updateStats() {
                const subscribers = this.whatsappAlerts ? this.whatsappAlerts.getSubscribers() : [];
                const container = document.getElementById('statsContainer');
                
                if (subscribers.length === 0) {
                    container.innerHTML = `
                        <div class="stat-card">
                            <span class="stat-number">0</span>
                            <div class="stat-label">×¡×”"×› ×× ×•×™×™×</div>
                        </div>
                    `;
                    
                    // ×¢×“×›×•×Ÿ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª ×”×¢×œ×™×•× ×•×ª
                    const totalSubscribersEl = document.getElementById('totalSubscribers');
                    const totalAlertsEl = document.getElementById('totalAlerts');
                    const newThisWeekEl = document.getElementById('newThisWeek');
                    const categoriesCountEl = document.getElementById('categoriesCount');
                    
                    if (totalSubscribersEl) totalSubscribersEl.textContent = '0';
                    if (totalAlertsEl) totalAlertsEl.textContent = '0';
                    if (newThisWeekEl) newThisWeekEl.textContent = '0';
                    if (categoriesCountEl        ) categoriesCountEl.textContent = '0';
                    
                    return;
                }

                // ×—×™×©×•×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª
                const stats = {
                    total: subscribers.length,
                    active: subscribers.filter(s => s.active !== false).length,
                    categories: {},
                    areas: {},
                    recent: 0
                };

                const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);

                subscribers.forEach(subscriber => {
                    // ×§×˜×’×•×¨×™×•×ª ×¤×•×¤×•×œ×¨×™×•×ª
                    if (subscriber.categories) {
                        subscriber.categories.forEach(cat => {
                            stats.categories[cat] = (stats.categories[cat] || 0) + 1;
                        });
                    }
                    
                    // ××–×•×¨×™×
                    if (subscriber.areas) {
                        subscriber.areas.forEach(area => {
                            stats.areas[area] = (stats.areas[area] || 0) + 1;
                        });
                    }
                    
                    // ×× ×•×™×™× ×—×“×©×™× ×”×©×‘×•×¢
                    if (subscriber.registrationDate) {
                        const regDate = new Date(subscriber.registrationDate);
                        if (regDate >= oneWeekAgo) {
                            stats.recent++;
                        }
                    }
                });

                // ××¦×™××ª ×”×§×˜×’×•×¨×™×•×ª ×•×”××–×•×¨×™× ×”×¤×•×¤×•×œ×¨×™×™× ×‘×™×•×ª×¨
                const topCategories = Object.entries(stats.categories)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);

                const html = `
                    <div class="stat-card">
                        <span class="stat-number">${stats.total}</span>
                        <div class="stat-label">×× ×•×™×™× ×¤×¢×™×œ×™×</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${stats.active}</span>
                        <div class="stat-label">×× ×•×™×™× ×¨×©×•××™×</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${stats.recent}</span>
                        <div class="stat-label">×× ×•×™×™× ×”×©×‘×•×¢</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${Object.keys(stats.categories).length}</span>
                        <div class="stat-label">×§×˜×’×•×¨×™×•×ª ×¤×¢×™×œ×•×ª</div>
                    </div>
                    
                    ${topCategories.length > 0 ? `
                        <div style="grid-column: 1 / -1; margin-top: 20px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-chart-bar"></i> ×§×˜×’×•×¨×™×•×ª ×¤×•×¤×•×œ×¨×™×•×ª
                            </h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                ${topCategories.map(([category, count]) => `
                                    <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(246, 152, 152, 0.3);">
                                        <div style="font-weight: bold; color: var(--primary-color);">${category}</div>
                                        <div style="font-size: 1.5em; font-weight: bold; margin-top: 5px;">${count}</div>
                                        <div style="font-size: 0.9em; color: #666;">×× ×•×™×™×</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                `;

                container.innerHTML = html;
                
                // ×¢×“×›×•×Ÿ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª ×”×¢×œ×™×•× ×•×ª
                const totalSubscribersEl = document.getElementById('totalSubscribers');
                const totalAlertsEl = document.getElementById('totalAlerts');
                const newThisWeekEl = document.getElementById('newThisWeek');
                const categoriesCountEl = document.getElementById('categoriesCount');
                
                if (totalSubscribersEl) totalSubscribersEl.textContent = stats.total;
                if (totalAlertsEl) totalAlertsEl.textContent = localStorage.getItem('whatsapp_total_alerts') || '0';
                if (newThisWeekEl) newThisWeekEl.textContent = stats.recent;
                if (categoriesCountEl) categoriesCountEl.textContent = Object.keys(stats.categories).length;
            }

            // ×¤×•× ×§×¦×™×•×ª ×¢×–×¨
            showAlert(message, type = 'info') {
                console.log(`${type.toUpperCase()}: ${message}`);
                
                // ×™×¦×™×¨×ª ×”×ª×¨××” ×•×™×–×•××œ×™×ª
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                alert.style.display = 'block';
                alert.style.position = 'fixed';
                alert.style.top = '20px';
                alert.style.right = '20px';
                alert.style.zIndex = '9999';
                alert.style.maxWidth = '400px';
                
                document.body.appendChild(alert);
                
                setTimeout(() => {
                    alert.remove();
                }, 5000);
            }

            closeAllModals() {
                document.querySelectorAll('.modal, .preview-modal').forEach(modal => {
                    modal.remove();
                });
            }
        }

        // ×¤×•× ×§×¦×™×•×ª ×’×œ×•×‘×œ×™×•×ª ×œ×˜×™×¤×•×œ ×‘×× ×•×™×™×
        function addTestSubscribers() {
            if (!adminPanel || !adminPanel.whatsappAlerts) {
                alert('×”××¢×¨×›×ª ×œ× ××•×›× ×” ×¢×“×™×™×Ÿ');
                return;
            }

const categories = correctJobsManager.getCategories();
const areas = correctJobsManager.getAreas();

            const testSubscribers = [
                {
                    id: Date.now() + 1,
                    name: '×™×•×¡×™ ×›×”×Ÿ',
                    phone: '+972501234567',
                    categories: [categories[0], categories[1]],
                    areas: [areas[0], areas[1]],
                    registrationDate: new Date().toISOString(),
                    active: true
                },
                {
                    id: Date.now() + 2,
                    name: '×©×¨×” ×œ×•×™',
                    phone: '+972527654321',
                    categories: [categories[2], categories[3]],
                    areas: [areas[2], areas[3]],
                    registrationDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    active: true
                },
                {
                    id: Date.now() + 3,
                    name: '×“×•×“ ××‘×¨×”×',
                    phone: '+972549876543',
                    categories: [categories[0], categories[4]],
                    areas: [areas[4], areas[5]],
                    registrationDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    active: true
                }
            ];

            testSubscribers.forEach(subscriber => {
                adminPanel.whatsappAlerts.addSubscriber(subscriber);
            });

            adminPanel.renderSubscribers();
            adminPanel.updateStats();
            adminPanel.loadSubscriberSelect();
            
            adminPanel.showAlert('× ×•×¡×¤×• 3 ×× ×•×™×™× ×œ×‘×“×™×§×”!', 'success');
        }

        function contactSubscriber(phone) {
            const message = '×©×œ×•×! ×× ×™ ×™×•×¦×¨/×ª ××™×ª×š ×§×©×¨ ×××¢×¨×›×ª ×”×ª×¨××•×ª ×”××©×¨×•×ª ×©×œ "××” ×™×© ×¤×”?". ××™×š ×× ×™ ×™×›×•×œ/×” ×œ×¢×–×•×¨?';
            const phoneNumber = phone.replace(/^0/, '972').replace(/\D/g, '');
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function removeSubscriber(phone) {
            if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×¡×™×¨ ××ª ×”×× ×•×™ ${phone}?`)) {
                adminPanel.whatsappAlerts.removeSubscriber(phone);
                adminPanel.renderSubscribers();
                adminPanel.updateStats();
                adminPanel.loadSubscriberSelect();
                adminPanel.showAlert('×”×× ×•×™ ×”×•×¡×¨ ×‘×”×¦×œ×—×”', 'success');
            }
        }

        // ×¤×•× ×§×¦×™×•×ª ×œ××©×¨×•×ª
        function searchJobAndSend() {
            const jobNumber = document.getElementById('jobSearchInput').value.trim();
            const resultsDiv = document.getElementById('jobSearchResults');
            
            if (!jobNumber) {
                resultsDiv.innerHTML = '<div class="error">×× × ×”×›× ×¡ ××¡×¤×¨ ××©×¨×”</div>';
                return;
            }

            resultsDiv.innerHTML = '<div class="loading">××—×¤×© ××©×¨×”...</div>';

            // ×—×™×¤×•×© ×”××©×¨×”
            const job = correctJobsManager.findJobById(jobNumber);
            
            if (!job) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        ×œ× × ××¦××” ××©×¨×” ×¢× ×”××¡×¤×¨: ${jobNumber}
                        <br><small>×‘×“×•×§ ×©×”××¡×¤×¨ × ×›×•×Ÿ ××• × ×¡×” ×—×™×¤×•×© ×—×œ×§×™</small>
                    </div>
                `;
                return;
            }

            // × ×¨××•×œ ×”××©×¨×”
            const normalizedJob = correctJobsManager.normalizeJob(job);

            // ×—×™×¤×•×© ×× ×•×™×™× ××ª××™××™×
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            const matchingSubscribers = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);

            // ×”×¦×’×ª ×ª×•×¦××•×ª
            resultsDiv.innerHTML = `
                <div class="success">
                    <h4><i class="fas fa-briefcase"></i> × ××¦××” ××©×¨×”!</h4>
                    <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0; border: 1px solid rgba(246, 152, 152, 0.3);">
                        <strong>${normalizedJob.title}</strong><br>
                        <small>××–×•×¨: ${normalizedJob.region}</small><br>
                        <small>×§×˜×’×•×¨×™×”: ${normalizedJob.category}</small>
                    </div>
                    <p><i class="fas fa-users"></i> × ××¦××• ${matchingSubscribers.length} ×× ×•×™×™× ××ª××™××™×</p>
                    ${matchingSubscribers.length > 0 ? 
                        `<button class="btn" onclick="sendToMatchingSubscribers('${normalizedJob.id}')">
                            <i class="fas fa-paper-plane"></i> ×©×œ×— ×œ-${matchingSubscribers.length} ×× ×•×™×™×
                        </button>` : 
                        '<p style="color: var(--primary-color);">××™×Ÿ ×× ×•×™×™× ××ª××™××™× ×œ×¤×™ ×”×§×˜×’×•×¨×™×” ×•×”××–×•×¨</p>'
                    }
                </div>
            `;
        }

        function sendToMatchingSubscribers(jobId) {
            const job = correctJobsManager.findJobById(jobId);
            if (!job) return;

            const normalizedJob = correctJobsManager.normalizeJob(job);
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            const matchingSubscribers = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);

            if (matchingSubscribers.length === 0) {
                alert('××™×Ÿ ×× ×•×™×™× ××ª××™××™×');
                return;
            }

            // ×™×¦×™×¨×ª ×”×•×“×¢×”
            const message = `ğŸ”¥ ××©×¨×” ×—×“×©×”!
ğŸ“‹ ${normalizedJob.title}
ğŸ“ ${normalizedJob.region}
ğŸ¯ ${normalizedJob.category}

×œ×¤×¨×˜×™× × ×•×¡×¤×™×: https://www.mayeshpo.co.il

×‘×”×¦×œ×—×”! ğŸ’ª`;

            // ×”×¦×’×ª ×ª×¦×•×’×” ××§×“×™××”
            showPreview(message, matchingSubscribers, normalizedJob);
        }

        function showPreview(message, subscribers, job) {
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content">
                    <h3><i class="fas fa-eye"></i> ×ª×¦×•×’×” ××§×“×™××”</h3>
                    
                    <div style="margin: 15px 0;">
                        <strong>××©×¨×”:</strong> ${job.title}<br>
                        <strong>× ××¢× ×™×:</strong> ${subscribers.length} ×× ×•×™×™×
                    </div>
                    
                    <h4>×”×•×“×¢×” ×©×ª×™×©×œ×—:</h4>
                    <div class="whatsapp-message">
                        ${message.replace(/\n/g, '<br>')}
                    </div>
                    
                    <h4>×¨×©×™××ª × ××¢× ×™×:</h4>
                    <div style="max-height: 200px; overflow-y: auto; background: rgba(246, 152, 152, 0.1); padding: 10px; border-radius: 5px;">
                        ${subscribers.map(sub => 
                            `<div>ğŸ“± ${sub.phone} - ${sub.name || '×œ×œ× ×©×'}</div>`
                        ).join('')}
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <button class="btn" onclick="confirmSendToAll('${job.id}')">
                            <i class="fas fa-paper-plane"></i> ×©×œ×— ×œ×›×œ ×”×× ×•×™×™× (${subscribers.length})
                        </button>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i> ×¡×’×•×¨
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function confirmSendToAll(jobId) {
            // ×¡×™××•×œ×¦×™×” ×©×œ ×©×œ×™×—×”
            console.log(`ğŸ“± ×©×•×œ×— ×”×•×“×¢×” ×œ×›×œ ×”×× ×•×™×™× ×”××ª××™××™× ×œ××©×¨×” ${jobId}`);
            
            // ×¡×’×™×¨×ª ×”××•×“×œ
            document.querySelector('.preview-modal')?.remove();
            
            // ×”×•×“×¢×ª ×”×¦×œ×—×”
            const resultsDiv = document.getElementById('jobSearchResults');
            resultsDiv.innerHTML = `
                <div class="success">
                    <i class="fas fa-check-circle"></i>
                    ×”×”×•×“×¢×•×ª × ×©×œ×—×• ×‘×”×¦×œ×—×” ×œ×›×œ ×”×× ×•×™×™× ×”××ª××™××™×!
                </div>
            `;

            // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
            const currentAlerts = parseInt(localStorage.getItem('whatsapp_total_alerts') || '0');
            localStorage.setItem('whatsapp_total_alerts', (currentAlerts + 1).toString());
            adminPanel.updateStats();
        }

        function sendManualJob() {
            const title = document.getElementById('manualJobTitle').value.trim();
            const area = document.getElementById('manualArea').value;
            const category = document.getElementById('manualCategory').value;
            
            if (!title || !area || !category) {
                alert('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª');
                return;
            }

            // ×™×¦×™×¨×ª ××©×¨×” ×™×“× ×™×ª
            const manualJob = {
                id: 'manual-' + Date.now(),
                jobNumber: 'MANUAL-' + Date.now(),
                title: title,
                area: area,
                region: area,
                category: category,
                description: '××©×¨×” ×©×”×•×›× ×¡×” ×™×“× ×™×ª',
                status: '×¤×¢×™×œ'
            };

            const normalizedJob = correctJobsManager.normalizeJob(manualJob);
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            const matchingSubscribers = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);

            // ×”×¦×’×ª ×ª×•×¦××•×ª
            const resultsDiv = document.getElementById('jobSearchResults');
            resultsDiv.innerHTML = `
                <div class="success">
                    <h4><i class="fas fa-plus-circle"></i> ××©×¨×” ×™×“× ×™×ª × ×•×¦×¨×”!</h4>
                    <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0; border: 1px solid rgba(246, 152, 152, 0.3);">
                        <strong>${normalizedJob.title}</strong><br>
                        <small>××–×•×¨: ${normalizedJob.region}</small><br>
                        <small>×§×˜×’×•×¨×™×”: ${normalizedJob.category}</small>
                    </div>
                    <p><i class="fas fa-users"></i> × ××¦××• ${matchingSubscribers.length} ×× ×•×™×™× ××ª××™××™×</p>
                    ${matchingSubscribers.length > 0 ? 
                        `<button class="btn" onclick="sendManualJobToSubscribers('${encodeURIComponent(JSON.stringify(normalizedJob))}')">
                            <i class="fas fa-paper-plane"></i> ×©×œ×— ×œ-${matchingSubscribers.length} ×× ×•×™×™×
                        </button>` : 
                        '<p style="color: var(--primary-color);">××™×Ÿ ×× ×•×™×™× ××ª××™××™× ×œ×¤×™ ×”×§×˜×’×•×¨×™×” ×•×”××–×•×¨</p>'
                    }
                </div>
            `;

            // × ×™×§×•×™ ×”×˜×•×¤×¡
            document.getElementById('manualJobTitle').value = '';
            document.getElementById('manualArea').value = '';
            document.getElementById('manualCategory').value = '';
        }

        function sendManualJobToSubscribers(jobJson) {
            const job = JSON.parse(decodeURIComponent(jobJson));
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            const matchingSubscribers = correctJobsManager.findMatchingSubscribers(job, subscribers);

            const message = `ğŸ”¥ ××©×¨×” ×—×“×©×”!
ğŸ“‹ ${job.title}
ğŸ“ ${job.region}
ğŸ¯ ${job.category}

×œ×¤×¨×˜×™× × ×•×¡×¤×™×: https://www.mayeshpo.co.il

×‘×”×¦×œ×—×”! ğŸ’ª`;

            showPreview(message, matchingSubscribers, job);
        }

        // ×¤×•× ×§×¦×™×•×ª ×œ×©×œ×™×—×” ×™×©×™×¨×”
        function previewDirectMessage() {
            const subscriberIndex = document.getElementById('subscriberSelect').value;
            const message = document.getElementById('directMessage').value;
            
            if (!subscriberIndex || !message) {
                alert('×× × ×‘×—×¨ ×× ×•×™ ×•×”×›× ×¡ ×”×•×“×¢×”');
                return;
            }

            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            const subscriber = subscribers[subscriberIndex];
            
            if (!subscriber) {
                alert('×× ×•×™ ×œ× × ××¦×');
                return;
            }

            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content">
                    <h3><i class="fas fa-eye"></i> ×ª×¦×•×’×” ××§×“×™××” - ×”×•×“×¢×” ×™×©×™×¨×”</h3>
                    
                    <div style="margin: 15px 0;">
                        <strong>× ××¢×Ÿ:</strong> ${subscriber.phone} - ${subscriber.name || '×œ×œ× ×©×'}
                    </div>
                    
                    <div class="whatsapp-message">
                        ${message.replace(/\n/g, '<br>')}
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <button class="btn" onclick="confirmDirectSend(${subscriberIndex}, '${message.replace(/'/g, "\\'")}')">
                            <i class="fas fa-paper-plane"></i> ×©×œ×— ×”×•×“×¢×”
                        </button>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i> ×¡×’×•×¨
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function confirmDirectSend(subscriberIndex, message) {
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            const subscriber = subscribers[subscriberIndex];
            
            if (!subscriber) {
                alert('×©×’×™××”: ×× ×•×™ ×œ× × ××¦×');
                return;
            }

            // ×©×œ×™×—×” ×œ×•×•××˜×¡××¤
            const phoneNumber = subscriber.phone.replace(/^0/, '972').replace(/\D/g, '');
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            // ×¡×’×™×¨×ª ×”××•×“×œ
            document.querySelector('.preview-modal')?.remove();
            
            // ×”×•×“×¢×ª ×”×¦×œ×—×”
            adminPanel?.showAlert(`×”×•×“×¢×” × ×©×œ×—×” ×‘×”×¦×œ×—×” ×œ-${subscriber.phone}`, 'success');
            
            // × ×™×§×•×™ ×”×˜×•×¤×¡
            document.getElementById('subscriberSelect').value = '';
            document.getElementById('directMessage').value = '';

            // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
            const currentAlerts = parseInt(localStorage.getItem('whatsapp_total_alerts') || '0');
            localStorage.setItem('whatsapp_total_alerts', (currentAlerts + 1).toString());
            adminPanel.updateStats();
        }

        function sendDirectMessage() {
            const subscriberIndex = document.getElementById('subscriberSelect').value;
            const message = document.getElementById('directMessage').value;
            
            if (!subscriberIndex || !message) {
                alert('×× × ×‘×—×¨ ×× ×•×™ ×•×”×›× ×¡ ×”×•×“×¢×”');
                return;
            }

            confirmDirectSend(subscriberIndex, message);
        }

        // ×¤×•× ×§×¦×™×•×ª ×›×œ×œ×™×•×ª
        function exportSubscribers() {
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            
            if (subscribers.length === 0) {
                alert('××™×Ÿ ×× ×•×™×™× ×œ×™×™×¦×•×');
                return;
            }

            // ×™×¦×™×¨×ª × ×ª×•× ×™ JSON
            const dataStr = JSON.stringify(subscribers, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `whatsapp_subscribers_${new Date().toISOString().split('T')[0]}.json`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            adminPanel?.showAlert(`×™×™×¦×•× ${subscribers.length} ×× ×•×™×™× ×”×•×©×œ×!`, 'success');
        }

        function importSubscribers(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedData)) {
                        throw new Error('×§×•×‘×¥ JSON ×—×™×™×‘ ×œ×”×›×™×œ ××¢×¨×š ×©×œ ×× ×•×™×™×');
                    }

                    let imported = 0;
                    let skipped = 0;
                    
                    const existingSubscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
                    
                    importedData.forEach(subscriber => {
                        // ×‘×“×™×§×” ×©×”×× ×•×™ ×ª×§×™×Ÿ
                        if (subscriber.phone && subscriber.name) {
                            // ×‘×“×™×§×” ×©×”××¡×¤×¨ ×œ× ×§×™×™×
                            if (!existingSubscribers.find(sub => sub.phone === subscriber.phone)) {
                                // ×”×•×¡×¤×ª ×©×“×•×ª ×—×¡×¨×™×
                                subscriber.id = subscriber.id || Date.now() + Math.random();
                                subscriber.registrationDate = subscriber.registrationDate || new Date().toISOString();
                                subscriber.categories = subscriber.categories || ['××—×¨'];
                                subscriber.areas = subscriber.areas || ['×›×œ ×”××¨×¥'];
                                subscriber.active = subscriber.active !== false;
                                
                                adminPanel.whatsappAlerts.addSubscriber(subscriber);
                                imported++;
                            } else {
                                skipped++;
                            }
                        }
                    });

                    adminPanel.renderSubscribers();
                    adminPanel.updateStats();
                    adminPanel.loadSubscriberSelect();

                    adminPanel?.showAlert(`×™×•×‘××• ${imported} ×× ×•×™×™× ×—×“×©×™×. ${skipped} ×× ×•×™×™× ×§×™×™××™× ×“×•×œ×’×•.`, 'success');
                } catch (error) {
                    adminPanel?.showAlert('×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥: ' + error.message, 'error');
                }
            };
            
            reader.readAsText(file);
            event.target.value = ''; // × ×™×§×•×™ ×”×©×“×”
        }

        function clearAllData() {
            const message = '×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×›×œ ×”× ×ª×•× ×™×?\n\nâ€¢ ×›×œ ×”×× ×•×™×™× ×™×™××—×§×•\nâ€¢ ×›×œ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª ×™××•×¤×¡×•\n\n×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!';
            
            if (confirm(message)) {
                if (confirm('×–×•×”×™ ××–×”×¨×” ××—×¨×•× ×”! ×”×× ××ª×” ×‘×˜×•×— ×œ×’××¨×™?')) {
                    // ××—×™×§×ª × ×ª×•× ×™×
                    localStorage.removeItem('whatsapp_alerts_subscribers');
                    localStorage.removeItem('whatsapp_total_alerts');
                    localStorage.removeItem('subscribers_backup');
                    
                    // ××™×¤×•×¡ ×”××¢×¨×›×ª
                    if (adminPanel?.whatsappAlerts) {
                        adminPanel.whatsappAlerts.subscribers = [];
                    }
                    
                    // ×¢×“×›×•×Ÿ ×ª×¦×•×’×”
                    adminPanel?.renderSubscribers();
                    adminPanel?.updateStats();
                    adminPanel?.loadSubscriberSelect();
                    
                    adminPanel?.showAlert('×›×œ ×”× ×ª×•× ×™× × ××—×§×• ×‘×”×¦×œ×—×”', 'success');
                }
            }
        }

        function generateReport() {
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            
            if (subscribers.length === 0) {
                alert('××™×Ÿ × ×ª×•× ×™× ×œ×™×¦×™×¨×ª ×“×•×—');
                return;
            }

            // ×—×™×©×•×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª
            const categoryStats = {};
            const areaStats = {};
            const monthlyStats = {};

            subscribers.forEach(subscriber => {
                // ×¡×˜×˜×™×¡×˜×™×§×•×ª ×§×˜×’×•×¨×™×•×ª
                if (subscriber.categories) {
                    subscriber.categories.forEach(cat => {
                        categoryStats[cat] = (categoryStats[cat] || 0) + 1;
                    });
                }
                
                // ×¡×˜×˜×™×¡×˜×™×§×•×ª ××–×•×¨×™×
                if (subscriber.areas) {
                    subscriber.areas.forEach(area => {
                        areaStats[area] = (areaStats[area] || 0) + 1;
                    });
                }
                
                // ×¡×˜×˜×™×¡×˜×™×§×•×ª ×—×•×“×©×™×•×ª
                if (subscriber.registrationDate) {
                    const month = new Date(subscriber.registrationDate).toISOString().slice(0, 7);
                    monthlyStats[month] = (monthlyStats[month] || 0) + 1;
                }
            });

            // ×™×¦×™×¨×ª ×”×“×•×—
            const now = new Date();
            const totalAlerts = localStorage.getItem('whatsapp_total_alerts') || '0';
            
            let report = `×“×•×— ××¤×•×¨×˜ - ××¢×¨×›×ª ×”×ª×¨××•×ª WhatsApp "××” ×™×© ×¤×”?"\n`;
            report += `×ª××¨×™×š ×™×¦×™×¨×ª ×”×“×•×—: ${now.toLocaleDateString('he-IL')} ${now.toLocaleTimeString('he-IL')}\n`;
            report += `${'='.repeat(60)}\n\n`;
            
            // ×¡×˜×˜×™×¡×˜×™×§×•×ª ×›×œ×œ×™×•×ª
            report += `ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ×›×œ×œ×™×•×ª:\n`;
            report += `â€¢ ×¡×”"×› ×× ×•×™×™× ×¤×¢×™×œ×™×: ${subscribers.length}\n`;
            report += `â€¢ ×¡×”"×› ×”×ª×¨××•×ª × ×©×œ×—×•: ${totalAlerts}\n`;
            report += `â€¢ ×××•×¦×¢ ×”×ª×¨××•×ª ×œ×× ×•×™: ${(parseInt(totalAlerts) / Math.max(subscribers.length, 1)).toFixed(1)}\n\n`;
            
            // ×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×•×ª
            report += `ğŸ“ˆ ×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×•×ª:\n`;
            Object.entries(categoryStats)
                .sort((a, b) => b[1] - a[1])
                .forEach(([cat, count]) => {
                    const percentage = ((count / subscribers.length) * 100).toFixed(1);
                    report += `â€¢ ${cat}: ${count} ×× ×•×™×™× (${percentage}%)\n`;
                });
            
            // ×”×ª×¤×œ×’×•×ª ×œ×¤×™ ××–×•×¨×™×
            report += `\nğŸ—ºï¸ ×”×ª×¤×œ×’×•×ª ×œ×¤×™ ××–×•×¨×™×:\n`;
            Object.entries(areaStats)
                .sort((a, b) => b[1] - a[1])
                .forEach(([area, count]) => {
                    const percentage = ((count / subscribers.length) * 100).toFixed(1);
                    report += `â€¢ ${area}: ${count} ×× ×•×™×™× (${percentage}%)\n`;
                });
            
            // ×”×ª×¤×œ×’×•×ª ×—×•×“×©×™×ª
            report += `\nğŸ“… ×”×ª×¤×œ×’×•×ª ×”×¨×©××•×ª ×œ×¤×™ ×—×•×“×©×™×:\n`;
            Object.entries(monthlyStats)
                .sort((a, b) => b[0].localeCompare(a[0]))
                .slice(0, 6) // 6 ×—×•×“×©×™× ××—×¨×•× ×™×
                .forEach(([month, count]) => {
                    const monthName = new Date(month + '-01').toLocaleDateString('he-IL', { year: 'numeric', month: 'long' });
                    report += `â€¢ ${monthName}: ${count} ×”×¨×©××•×ª\n`;
                });

            // ×”×¦×’×ª ×”×“×•×—
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content" style="max-width: 700px;">
                    <h3><i class="fas fa-chart-bar"></i> ×“×•×— ×¡×˜×˜×™×¡×˜×™×§×•×ª ××¤×•×¨×˜</h3>
                    
                    <div style="margin: 20px 0;">
                        <pre style="color: white; white-space: pre-wrap; line-height: 1.6; background: rgba(246, 152, 152, 0.1); padding: 20px; border-radius: 8px; max-height: 400px; overflow-y: auto; border: 1px solid rgba(246, 152, 152, 0.3);">${report}</pre>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                        <button onclick="navigator.clipboard.writeText(\`${report.replace(/`/g, '\\`')}\`).then(() => alert('×“×•×— ×”×•×¢×ª×§ ×œ×œ×•×—!'))" class="btn">
                            <i class="fas fa-copy"></i> ×”×¢×ª×§ ×“×•×—
                        </button>
                        <button onclick="this.closest('.preview-modal').remove()" class="close-btn">
                            <i class="fas fa-times"></i> ×¡×’×•×¨
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function refreshSubscribersList() {
            console.log('ğŸ”„ ××¨×¢× ×Ÿ ×¨×©×™××ª ×× ×•×™×™×...');
            
            // ×¢×“×›×•×Ÿ ×”×˜×‘×œ×”
            if (adminPanel) {
                adminPanel.renderSubscribers();
                adminPanel.updateStats();
                adminPanel.loadSubscriberSelect();
            }
            
            adminPanel?.showAlert('âœ… ×¨×©×™××ª ×”×× ×•×™×™× ×¨×•×¢× × ×”!', 'success');
        }

        // ×¤×•× ×§×¦×™×•×ª ×œ×›×œ×™ ×‘×“×™×§×” ×•×”×ª×××•×ª
        function analyzeJobsStructure() {
            const jobs = correctJobsManager.getAllJobs();
            
            if (!jobs || jobs.length === 0) {
                alert('âŒ ××™×Ÿ ××©×¨×•×ª ×œ× ×™×ª×•×—. ×•×•×“× ×©×§×•×‘×¥ ×”××©×¨×•×ª × ×˜×¢×Ÿ.');
                return;
            }

            console.log(`ğŸ” × ×™×ª×•×— ××‘× ×” ×©×œ ${jobs.length} ××©×¨×•×ª:`);
            
            // × ×™×ª×•×— ×”×©×“×•×ª ×”×§×™×™××™×
            const fieldAnalysis = {};
            const sampleJob = jobs[0];
            
            Object.keys(sampleJob).forEach(field => {
                const valuesSet = new Set();
                jobs.slice(0, 10).forEach(job => {
                    if (job[field]) valuesSet.add(job[field]);
                });
                
                fieldAnalysis[field] = {
                    type: typeof sampleJob[field],
                    sampleValues: Array.from(valuesSet).slice(0, 3),
                    totalFound: jobs.filter(job => job[field]).length
                };
            });

            console.table(fieldAnalysis);
            
            // ×“×•×’××ª ××©×¨×” ××œ××”
            console.log('ğŸ“ ×“×•×’××ª ××©×¨×” ××œ××”:');
            console.log(JSON.stringify(sampleJob, null, 2));
            
            // ×‘×“×™×§×ª ××™×›×•×ª × ×ª×•× ×™×
            const qualityReport = {
                totalJobs: jobs.length,
                withJobNumber: jobs.filter(j => j.jobNumber).length,
                withTitle: jobs.filter(j => j.title).length,
                withCategory: jobs.filter(j => j.category).length,
                withRegion: jobs.filter(j => j.region || j.area).length,
                activeJobs: jobs.filter(j => j.status === '×¤×¢×™×œ').length,
                titlesWithSlash: jobs.filter(j => j.title && j.title.includes('/')).length
            };
            
            console.log('ğŸ“Š ×“×•×— ××™×›×•×ª × ×ª×•× ×™×:');
            console.table(qualityReport);

            // ×‘×“×™×§×ª ×˜×™×¤×•×œ ×‘×–×›×¨/× ×§×‘×”
            console.log('ğŸ” ×‘×“×™×§×ª ×˜×™×¤×•×œ ×‘×–×›×¨/× ×§×‘×”:');
            const slashExamples = jobs.filter(j => j.title && j.title.includes('/')).slice(0, 5);
            slashExamples.forEach(job => {
                console.log(`- ${job.title}`);
            });
            
            // ×”×¦×’×ª ×”×ª×•×¦××•×ª ×‘××•×“×œ
            showAnalysisModal(fieldAnalysis, qualityReport, slashExamples);
            
            return qualityReport;
        }

        function showAnalysisModal(fieldAnalysis, qualityReport, slashExamples) {
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content" style="max-width: 800px;">
                    <h3><i class="fas fa-microscope"></i> × ×™×ª×•×— ××‘× ×” ××©×¨×•×ª</h3>
                    
                    <div style="margin: 20px 0;">
                        <h4 style="color: var(--primary-color);">ğŸ“Š ×“×•×— ××™×›×•×ª × ×ª×•× ×™×:</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                            <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px;">
                                <strong>×¡×”"×› ××©×¨×•×ª:</strong> ${qualityReport.totalJobs}
                            </div>
                            <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px;">
                                <strong>×¢× ××¡×¤×¨ ××©×¨×”:</strong> ${qualityReport.withJobNumber}
                            </div>
                            <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px;">
                                <strong>×¢× ×§×˜×’×•×¨×™×”:</strong> ${qualityReport.withCategory}
                            </div>
                            <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px;">
                                <strong>×¢× ××–×•×¨:</strong> ${qualityReport.withRegion}
                            </div>
                            <div style="background: rgba(37, 211, 102, 0.1); padding: 15px; border-radius: 8px;">
                                <strong>××©×¨×•×ª ×¤×¢×™×œ×•×ª:</strong> ${qualityReport.activeJobs}
                            </div>
                            <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px;">
                                <strong>×›×•×ª×¨×•×ª ×¢× "/":</strong> ${qualityReport.titlesWithSlash}
                            </div>
                        </div>
                        
                        <h4 style="color: var(--primary-color);">ğŸ” ×“×•×’×××•×ª ×–×›×¨/× ×§×‘×”:</h4>
                        <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                            ${slashExamples.length > 0 ? 
                                slashExamples.map(job => `<div>â€¢ ${job.title}</div>`).join('') :
                                '<div>×œ× × ××¦××• ×›×•×ª×¨×•×ª ×¢× ×¡×œ××©</div>'
                            }
                        </div>
                        
                        <h4 style="color: var(--primary-color);">ğŸ—ï¸ ×©×“×•×ª ×‘××‘× ×”:</h4>
                        <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                            ${Object.entries(fieldAnalysis).map(([field, info]) => 
                                `<div style="margin-bottom: 10px;">
                                    <strong>${field}:</strong> ${info.type} 
                                    (${info.totalFound}/${qualityReport.totalJobs} ××©×¨×•×ª)
                                    <br><small>×“×•×’×××•×ª: ${info.sampleValues.join(', ')}</small>
                                </div>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <button class="close-btn" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i> ×¡×’×•×¨
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function testJobSearchDemo() {
            console.log('ğŸ§ª ×”×ª×—×œ×ª ×‘×“×™×§×ª ××¢×¨×›×ª ×”×—×™×¤×•×©...');
            
            const testCases = ['A-25821', '12345', '××©××™×ª', 'Full Stack', '× ×”×’'];
            const results = [];
            
            testCases.forEach(testCase => {
                console.log(`\n--- ×‘×“×™×§×”: ${testCase} ---`);
                const job = correctJobsManager.findJobById(testCase);
                
                if (job) {
                    console.log('âœ… ××©×¨×” × ××¦××”:');
                    console.log(`   ××¡×¤×¨: ${job.jobNumber}`);
                    console.log(`   ×›×•×ª×¨×ª: ${job.title}`);
                    console.log(`   ×§×˜×’×•×¨×™×”: ${job.category}`);
                    console.log(`   ××–×•×¨: ${job.region || job.area}`);
                    console.log(`   ×¡×˜×˜×•×¡: ${job.status}`);
                    
                    results.push({
                        search: testCase,
                        found: true,
                        job: job
                    });
                } else {
                    console.log('âŒ ××©×¨×” ×œ× × ××¦××”');
                    results.push({
                        search: testCase,
                        found: false
                    });
                }
            });
            
            // ×”×¦×’×ª ×ª×•×¦××•×ª ×‘××•×“×œ
            showSearchResultsModal(results);
            
            console.log('\nâœ… ×‘×“×™×§×ª ×”×—×™×¤×•×© ×”×•×©×œ××” - ×¨××” ×ª×•×¦××•×ª ×‘×§×•× ×¡×•×œ');
        }

        function showSearchResultsModal(results) {
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content">
                    <h3><i class="fas fa-search"></i> ×ª×•×¦××•×ª ×‘×“×™×§×ª ×—×™×¤×•×©</h3>
                    
                    <div style="margin: 20px 0;">
                        ${results.map(result => `
                            <div style="background: ${result.found ? 'rgba(37, 211, 102, 0.1)' : 'rgba(255, 71, 87, 0.1)'}; 
                                        padding: 15px; margin: 10px 0; border-radius: 8px; 
                                        border: 1px solid ${result.found ? 'rgba(37, 211, 102, 0.3)' : 'rgba(255, 71, 87, 0.3)'};">
                                <div><strong>×—×™×¤×•×©:</strong> "${result.search}" 
                                    ${result.found ? 'âœ…' : 'âŒ'}
                                </div>
                                ${result.found ? `
                                    <div style="margin-top: 8px; font-size: 0.9em;">
                                        <div><strong>××¡×¤×¨:</strong> ${result.job.jobNumber}</div>
                                        <div><strong>×›×•×ª×¨×ª:</strong> ${result.job.title}</div>
                                        <div><strong>×§×˜×’×•×¨×™×”:</strong> ${result.job.category}</div>
                                        <div><strong>××–×•×¨:</strong> ${result.job.region || result.job.area}</div>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    <button class="close-btn" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i> ×¡×’×•×¨
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function testMatchingDemo() {
            const jobs = correctJobsManager.getAllJobs();
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            
            if (jobs.length === 0 || subscribers.length === 0) {
                alert('×¦×¨×™×š ××©×¨×•×ª ×•×× ×•×™×™× ×›×“×™ ×œ×‘×“×•×§ ×”×ª×××”. ×”×•×¡×£ ×× ×•×™×™× ×œ×‘×“×™×§×” ×•×•×•×“× ×©×”××©×¨×•×ª × ×˜×¢× ×•×ª.');
                return;
            }

            // ×‘×—×™×¨×ª ××©×¨×” ×œ×‘×“×™×§×”
            const testJob = jobs[0];
            const normalizedJob = correctJobsManager.normalizeJob(testJob);
            const matches = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);

            // × ×™×ª×•×— ××¤×•×¨×˜ ×©×œ ×”×”×ª×××•×ª
            const matchDetails = subscribers.map(subscriber => {
                const categoryMatch = correctJobsManager.matchCategory(normalizedJob.category, subscriber.categories);
                const areaMatch = correctJobsManager.matchArea(normalizedJob.region, subscriber.areas);
                const overallMatch = categoryMatch && areaMatch;
                
                return {
                    subscriber,
                    categoryMatch,
                    areaMatch,
                    overallMatch
                };
            });

            showMatchingAnalysisModal(normalizedJob, matchDetails);
        }

        function showMatchingAnalysisModal(job, matchDetails) {
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content" style="max-width: 900px;">
                    <h3><i class="fas fa-users"></i> × ×™×ª×•×— ×”×ª×××ª ×× ×•×™×™×</h3>
                    
                    <div style="margin: 20px 0;">
                        <h4 style="color: var(--primary-color);">ğŸ“‹ ××©×¨×” ×œ×‘×“×™×§×”:</h4>
                        <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <strong>${job.title}</strong><br>
                            <small>×§×˜×’×•×¨×™×”: ${job.category}</small><br>
                            <small>××–×•×¨: ${job.region}</small><br>
                            <small>××¡×¤×¨: ${job.jobNumber}</small>
                        </div>

                        <h4 style="color: var(--primary-color);">ğŸ‘¥ × ×™×ª×•×— ×”×ª×××•×ª (${matchDetails.filter(m => m.overallMatch).length}/${matchDetails.length} ××ª××™××™×):</h4>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${matchDetails.map(detail => `
                                <div style="background: ${detail.overallMatch ? 'rgba(37, 211, 102, 0.1)' : 'rgba(255, 71, 87, 0.1)'}; 
                                            padding: 15px; margin: 5px 0; border-radius: 8px; 
                                            border: 1px solid ${detail.overallMatch ? 'rgba(37, 211, 102, 0.3)' : 'rgba(255, 71, 87, 0.3)'};">
                                    <div style="font-weight: bold;">
                                        ğŸ“± ${detail.subscriber.phone} - ${detail.subscriber.name || '×œ×œ× ×©×'}
                                        ${detail.overallMatch ? 'âœ…' : 'âŒ'}
                                    </div>
                                    <div style="margin-top: 8px; font-size: 0.9em;">
                                        <div>ğŸ¯ ×§×˜×’×•×¨×™×•×ª ×× ×•×™: ${detail.subscriber.categories.join(', ')} 
                                            ${detail.categoryMatch ? 'âœ…' : 'âŒ'}
                                        </div>
                                        <div>ğŸ“ ××–×•×¨×™ ×× ×•×™: ${detail.subscriber.areas.join(', ')} 
                                            ${detail.areaMatch ? 'âœ…' : 'âŒ'}
                                        </div>
                                        ${!detail.overallMatch ? `
                                            <div style="color: #ff6b6b; margin-top: 5px; font-size: 0.8em;">
                                                ${!detail.categoryMatch ? 'â€¢ ×œ× ×”×ª×××” ×‘×§×˜×’×•×¨×™×”' : ''}
                                                ${!detail.areaMatch ? 'â€¢ ×œ× ×”×ª×××” ×‘××–×•×¨' : ''}
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <h4 style="color: var(--primary-color);">ğŸ“Š ×¡×™×›×•×:</h4>
                        <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px;">
                            <div>××ª×•×š ${matchDetails.length} ×× ×•×™×™× ×‘××¢×¨×›×ª:</div>
                            <div>â€¢ ${matchDetails.filter(m => m.overallMatch).length} ××ª××™××™× ×œ××©×¨×” ×–×•</div>
                            <div>â€¢ ${matchDetails.filter(m => m.categoryMatch).length} ××ª××™××™× ×‘×§×˜×’×•×¨×™×”</div>
                            <div>â€¢ ${matchDetails.filter(m => m.areaMatch).length} ××ª××™××™× ×‘××–×•×¨</div>
                        </div>
                    </div>
                    
                    <button class="close-btn" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i> ×¡×’×•×¨
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function testCategoryMatching() {
            const testCases = [
                {
                    jobCategory: '×œ×•×’×™×¡×˜×™×§×”, ××—×¡× ×™×, ×©×™×œ×•×— ×•×¨×›×©',
                    subscriberCategories: ['×œ×•×’×™×¡×˜×™×§×”'],
                    expected: true,
                    note: '×”×ª×××” ×—×œ×§×™×ª - ×§×˜×’×•×¨×™×” ××•×›×œ×ª'
                },
                {
                    jobCategory: '×œ×•×’×™×¡×˜×™×§×”, ××—×¡× ×™×, ×©×™×œ×•×— ×•×¨×›×©',
                    subscriberCategories: ['× ×”×™×’×”'],
                    expected: true,
                    note: '×”×ª×××” ×œ×¤×™ ××™×œ×•×ª ××¤×ª×—'
                },
                {
                    jobCategory: '×¤×™×ª×•×— ×•×ª×•×›× ×”',
                    subscriberCategories: ['××¤×ª×—'],
                    expected: true,
                    note: '×”×ª×××” ×œ×¤×™ ××™×œ×•×ª ××¤×ª×—'
                },
                {
                    jobCategory: '× ×”×’/×ª ××©××™×ª',
                    subscriberCategories: ['×œ×•×’×™×¡×˜×™×§×”'],
                    expected: true,
                    note: '×˜×™×¤×•×œ ×‘×¡×œ××© ×œ×–×›×¨/× ×§×‘×”'
                },
                {
                    jobCategory: '××•×¨×”/××—× ×š ×œ×—×™× ×•×š ××™×•×—×“',
                    subscriberCategories: ['×—×™× ×•×š ×•×”×•×¨××”'],
                    expected: true,
                    note: '×˜×™×¤×•×œ ×‘×¡×œ××© ×¢× ×ª×—×•××™× ×©×•× ×™×'
                },
                {
                    jobCategory: '××¤×ª×—/×ª Full Stack',
                    subscriberCategories: ['×¤×™×ª×•×— ×•×ª×•×›× ×”'],
                    expected: true,
                    note: '×–×›×¨/× ×§×‘×” ×¢× ×˜×›× ×•×œ×•×’×™×”'
                },
                {
                    jobCategory: '××›×™×¨×•×ª ×•×©×™×•×•×§',
                    subscriberCategories: ['×—×™× ×•×š ×•×”×•×¨××”'],
                    expected: false,
                    note: '××™×Ÿ ×”×ª×××” - ×ª×—×•××™× ×©×•× ×™×'
                }
            ];
            
            console.log('ğŸ§ª ×‘×“×™×§×ª ××¢×¨×›×ª ×”×ª×××ª ×§×˜×’×•×¨×™×•×ª:');
            const results = [];
            
            testCases.forEach((test, index) => {
                const result = correctJobsManager.matchCategory(test.jobCategory, test.subscriberCategories);
                const status = result === test.expected ? 'âœ…' : 'âŒ';
                
                console.log(`${status} ×‘×“×™×§×” ${index + 1}:`);
                console.log(`  ××©×¨×”: ${test.jobCategory}`);
                console.log(`  ×× ×•×™: ${test.subscriberCategories.join(', ')}`);
                console.log(`  ×ª×•×¦××”: ${result} (×¦×¤×•×™: ${test.expected})`);
                if (test.note) {
                    console.log(`  ×”×¢×¨×”: ${test.note}`);
                }
                
                results.push({
                    ...test,
                    result,
                    success: result === test.expected,
                    index: index + 1
                });
            });

            // ×”×¦×’×ª ×ª×•×¦××•×ª ×‘××•×“×œ
            showCategoryTestModal(results);
        }

        function showCategoryTestModal(results) {
            const successCount = results.filter(r => r.success).length;
            
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content" style="max-width: 800px;">
                    <h3><i class="fas fa-vial"></i> ×ª×•×¦××•×ª ×‘×“×™×§×ª ×”×ª×××ª ×§×˜×’×•×¨×™×•×ª</h3>
                    
                    <div style="margin: 20px 0;">
                        <div style="background: ${successCount === results.length ? 'rgba(37, 211, 102, 0.1)' : 'rgba(255, 193, 7, 0.1)'}; 
                                    padding: 15px; border-radius: 8px; margin-bottom: 20px; 
                                    border: 1px solid ${successCount === results.length ? 'rgba(37, 211, 102, 0.3)' : 'rgba(255, 193, 7, 0.3)'};">
                            <strong>×ª×•×¦××” ×›×œ×œ×™×ª: ${successCount}/${results.length} ×‘×“×™×§×•×ª ×¢×‘×¨×• ×‘×”×¦×œ×—×”</strong>
                        </div>
                        
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${results.map(test => `
                                <div style="background: ${test.success ? 'rgba(37, 211, 102, 0.1)' : 'rgba(255, 71, 87, 0.1)'}; 
                                            padding: 15px; margin: 10px 0; border-radius: 8px; 
                                            border: 1px solid ${test.success ? 'rgba(37, 211, 102, 0.3)' : 'rgba(255, 71, 87, 0.3)'};">
                                    <div><strong>×‘×“×™×§×” ${test.index}:</strong> ${test.success ? 'âœ… ×”×¦×œ×™×—' : 'âŒ × ×›×©×œ'}</div>
                                    <div style="margin-top: 8px; font-size: 0.9em;">
                                        <div><strong>×§×˜×’×•×¨×™×™×ª ××©×¨×”:</strong> ${test.jobCategory}</div>
                                        <div><strong>×§×˜×’×•×¨×™×•×ª ×× ×•×™:</strong> ${test.subscriberCategories.join(', ')}</div>
                                        <div><strong>×ª×•×¦××”:</strong> ${test.result ? '×”×ª×××”' : '××™×Ÿ ×”×ª×××”'} 
                                            (×¦×¤×•×™: ${test.expected ? '×”×ª×××”' : '××™×Ÿ ×”×ª×××”'})</div>
                                        <div style="margin-top: 5px; font-style: italic; color: #999;">${test.note}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <button class="close-btn" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i> ×¡×’×•×¨
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function testGenderMatching() {
            const genderTestCases = [
                {
                    jobTitle: '× ×”×’/×ª ××©××™×ª ×× ×•×£',
                    subscriberCategories: ['×œ×•×’×™×¡×˜×™×§×”, ××—×¡× ×™×, ×©×™×œ×•×— ×•×¨×›×©'],
                    note: '×–×›×¨/× ×§×‘×” ×¢× ×”×ª×××” ×œ×§×˜×’×•×¨×™×”'
                },
                {
                    jobTitle: '××¤×ª×—/×ª Full Stack',
                    subscriberCategories: ['×¤×™×ª×•×— ×•×ª×•×›× ×”'],
                    note: '×–×›×¨/× ×§×‘×” ×‘×ª×—×•× ×”×˜×›× ×•×œ×•×’×™×”'
                },
                {
                    jobTitle: '××•×¨×”/××—× ×š ×œ×—×™× ×•×š ××™×•×—×“',
                    subscriberCategories: ['×—×™× ×•×š ×•×”×•×¨××”'],
                    note: '×©× ×™ ×ª×¤×§×™×“×™× ×©×•× ×™× ×¢× ×¡×œ××©'
                },
                {
                    jobTitle: '××•×›×¨/×ª ×‘×—× ×•×ª ×‘×’×“×™×',
                    subscriberCategories: ['××›×™×¨×•×ª ×•×©×™×•×•×§'],
                    note: '××›×™×¨×•×ª ×¢× ×–×›×¨/× ×§×‘×”'
                },
                {
                    jobTitle: '××˜×¤×œ/×ª ×¡×™×¢×•×“×™',
                    subscriberCategories: ['×‘×¨×™××•×ª ×•×¨×¤×•××”'],
                    note: '×ª×¤×§×™×“ ×˜×™×¤×•×œ×™ ×¢× ×–×›×¨/× ×§×‘×”'
                }
            ];
            
            console.log('ğŸ§ª ×‘×“×™×§×ª ×”×ª×××” ×œ×–×›×¨/× ×§×‘×”:');
            const results = [];
            
            genderTestCases.forEach((test, index) => {
                const result = correctJobsManager.matchCategory(test.jobTitle, test.subscriberCategories);
                
                console.log(`ğŸ” ×‘×“×™×§×” ${index + 1}:`);
                console.log(`  ×›×•×ª×¨×ª ××©×¨×”: ${test.jobTitle}`);
                console.log(`  ×§×˜×’×•×¨×™×•×ª ×× ×•×™: ${test.subscriberCategories.join(', ')}`);
                console.log(`  ×ª×•×¦××”: ${result ? 'âœ… ×”×ª×××”' : 'âŒ ××™×Ÿ ×”×ª×××”'}`);
                console.log(`  ×”×¢×¨×”: ${test.note}`);
                
                results.push({
                    ...test,
                    result,
                    index: index + 1
                });
            });

            showGenderTestModal(results);
        }

        function showGenderTestModal(results) {
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content" style="max-width: 800px;">
                    <h3><i class="fas fa-venus-mars"></i> ×‘×“×™×§×ª ×”×ª×××” ×œ×–×›×¨/× ×§×‘×”</h3>
                    
                    <div style="margin: 20px 0;">
                        <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid rgba(255, 193, 7, 0.3);">
                            <strong>×”××¢×¨×›×ª ××–×”×” ×•××ª××™××” ××©×¨×•×ª ×¢× ×¡×œ××© (/) ×”××¦×™×™× ×•×ª ×–×›×¨/× ×§×‘×”</strong>
                        </div>
                        
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${results.map(test => `
                                <div style="background: ${test.result ? 'rgba(37, 211, 102, 0.1)' : 'rgba(255, 71, 87, 0.1)'}; 
                                            padding: 15px; margin: 10px 0; border-radius: 8px; 
                                            border: 1px solid ${test.result ? 'rgba(37, 211, 102, 0.3)' : 'rgba(255, 71, 87, 0.3)'};">
                                    <div><strong>×‘×“×™×§×” ${test.index}:</strong> ${test.result ? 'âœ… ×”×ª×××”' : 'âŒ ××™×Ÿ ×”×ª×××”'}</div>
                                    <div style="margin-top: 8px; font-size: 0.9em;">
                                        <div><strong>×›×•×ª×¨×ª ××©×¨×”:</strong> ${test.jobTitle}</div>
                                        <div><strong>×§×˜×’×•×¨×™×•×ª ×× ×•×™:</strong> ${test.subscriberCategories.join(', ')}</div>
                                        <div style="margin-top: 5px; font-style: italic; color: #999;">${test.note}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                                    </div>
                    
                    <button class="close-btn" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i> ×¡×’×•×¨
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function showMatchingRules() {
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content" style="max-width: 800px;">
                    <h3><i class="fas fa-book"></i> ×—×•×§×™ ×”×ª×××” ×©×œ ×”××¢×¨×›×ª</h3>
                    
                    <div style="margin: 20px 0; max-height: 500px; overflow-y: auto;">
                        <h4 style="color: var(--primary-color);">ğŸ¯ ×”×ª×××ª ×§×˜×’×•×¨×™×•×ª:</h4>
                        <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <div><strong>1. ×”×ª×××” ××“×•×™×§×ª:</strong> ×”×©×•×•××” ×–×”×” ×‘×™×Ÿ ×§×˜×’×•×¨×™×™×ª ×”××©×¨×” ×œ×× ×•×™</div>
                            <div><strong>2. ×”×ª×××” ×—×œ×§×™×ª:</strong> ×§×˜×’×•×¨×™×” ××—×ª ××•×›×œ×ª ×‘×©× ×™×™×”</div>
                            <div><strong>3. ××™×œ×•×ª ××¤×ª×—:</strong> ×”×ª×××” ×œ×¤×™ ××™×œ×•×ª ××¤×ª×— ×¨×œ×•×•× ×˜×™×•×ª</div>
                            <div><strong>4. ×–×›×¨/× ×§×‘×”:</strong> ×˜×™×¤×•×œ ×‘×¡×œ××© (/) ×œ×–×™×”×•×™ ×ª×¤×§×™×“×™×</div>
                        </div>
                        
                        <h4 style="color: var(--primary-color);">ğŸ—ºï¸ ×”×ª×××ª ××–×•×¨×™×:</h4>
                        <div style="background: rgba(37, 211, 102, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <div><strong>1. ×”×ª×××” ××“×•×™×§×ª:</strong> ××–×•×¨ ×–×”×”</div>
                            <div><strong>2. ×”×ª×××” ×—×œ×§×™×ª:</strong> ××–×•×¨ ××•×›×œ ×‘××–×•×¨ ××—×¨</div>
                            <div><strong>3. "×›×œ ×”××¨×¥":</strong> ×ª××™×“ ××ª××™×</div>
                            <div><strong>4. ××–×•×¨×™× ×’×™××•×’×¨×¤×™×™×:</strong> ×”×ª×××•×ª ×’××™×©×•×ª (××¨×›×– â† ×ª×œ ××‘×™×‘)</div>
                        </div>

                        <h4 style="color: var(--primary-color);">ğŸ”§ ××™×œ×•×ª ××¤×ª×—:</h4>
                        <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <div><strong>×œ×•×’×™×¡×˜×™×§×” â†â†’</strong> × ×”×’, × ×”×™×’×”, ××©××™×ª, ×× ×•×£, ×”×•×‘×œ×”</div>
                            <div><strong>×¤×™×ª×•×— â†â†’</strong> ××¤×ª×—, ×ª×›× ×•×ª, ×ª×•×›× ×”, programmer</div>
                            <div><strong>××›×™×¨×•×ª â†â†’</strong> ×©×™×•×•×§, marketing, sales, ××•×›×¨</div>
                            <div><strong>×—×™× ×•×š â†â†’</strong> ××•×¨×”, ×”×•×¨××”, ××—× ×š, ×’× × ×ª</div>
                            <div><strong>×‘×¨×™××•×ª â†â†’</strong> ×¨×¤×•××”, ×¨×•×¤×, ××—×•×ª, ×˜×™×¤×•×œ</div>
                        </div>

                        <h4 style="color: var(--primary-color);">âš–ï¸ ×˜×™×¤×•×œ ×‘×–×›×¨/× ×§×‘×”:</h4>
                        <div style="background: rgba(156, 39, 176, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <div><strong>×–×™×”×•×™ ×¡×œ××©:</strong> "× ×”×’/×ª", "××¤×ª×—/×ª", "××•×¨×”/××—× ×š"</div>
                            <div><strong>×¤×™×¦×•×œ ×•×—×™×¤×•×©:</strong> ×‘×“×™×§×ª ×›×œ ×—×œ×§ ×‘× ×¤×¨×“</div>
                            <div><strong>×¡×™×•××•×ª × ×§×‘×”:</strong> ×”×ª×××” ×©×œ "×™×ª", "×ª", "×”"</div>
                            <div><strong>×“×•-×›×™×•×•× ×™:</strong> ×¢×•×‘×“ ×’× ×›×©×”×× ×•×™ ×›×ª×‘ ×¢× ×¡×œ××©</div>
                        </div>

                        <h4 style="color: var(--primary-color);">ğŸ“ ×“×•×’×××•×ª ×”×ª×××”:</h4>
                        <div style="background: rgba(3, 169, 244, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <div>âœ… "× ×”×’/×ª ××©××™×ª" â† ×× ×•×™: "×œ×•×’×™×¡×˜×™×§×”"</div>
                            <div>âœ… "××¤×ª×—/×ª Full Stack" â† ×× ×•×™: "×¤×™×ª×•×— ×•×ª×•×›× ×”"</div>
                            <div>âœ… "××•×¨×”/××—× ×š" â† ×× ×•×™: "×—×™× ×•×š ×•×”×•×¨××”"</div>
                            <div>âœ… "×¢×‘×•×“×” ××”×‘×™×ª" â† ×× ×•×™: "×›×œ ×”××¨×¥"</div>
                            <div>âŒ "××›×™×¨×•×ª" â† ×× ×•×™: "×‘×¨×™××•×ª ×•×¨×¤×•××”"</div>
                        </div>
                    </div>
                    
                    <button class="close-btn" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i> ×¡×’×•×¨
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function testRealTimeMatching() {
            const jobCategory = document.getElementById('testJobCategory').value.trim();
            const subscriberCategoriesText = document.getElementById('testSubscriberCategories').value.trim();
            
            if (!jobCategory || !subscriberCategoriesText) {
                alert('×× × ×”×›× ×¡ ×§×˜×’×•×¨×™×™×ª ××©×¨×” ×•×§×˜×’×•×¨×™×•×ª ×× ×•×™');
                return;
            }
            
            // ×¤×™×¦×•×œ ×§×˜×’×•×¨×™×•×ª ×”×× ×•×™
            const subscriberCategories = subscriberCategoriesText.split(',').map(cat => cat.trim());
            
            // ×‘×“×™×§×ª ×”×ª×××”
            const result = correctJobsManager.matchCategory(jobCategory, subscriberCategories);
            
            // ×”×¦×’×ª ×ª×•×¦××•×ª
            const resultsDiv = document.getElementById('realTimeResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <div style="background: ${result ? 'rgba(37, 211, 102, 0.1)' : 'rgba(255, 71, 87, 0.1)'}; 
                            padding: 15px; border-radius: 8px; 
                            border: 1px solid ${result ? 'rgba(37, 211, 102, 0.3)' : 'rgba(255, 71, 87, 0.3)'};">
                    <h4 style="color: ${result ? '#25D366' : '#ff4757'};">
                        ${result ? 'âœ… ×™×© ×”×ª×××”!' : 'âŒ ××™×Ÿ ×”×ª×××”'}
                    </h4>
                    <div style="margin-top: 10px; font-size: 0.9em;">
                        <div><strong>×§×˜×’×•×¨×™×™×ª ××©×¨×”:</strong> "${jobCategory}"</div>
                        <div><strong>×§×˜×’×•×¨×™×•×ª ×× ×•×™:</strong> ${subscriberCategories.map(cat => `"${cat}"`).join(', ')}</div>
                        <div style="margin-top: 10px;">
                            <strong>×”×¡×‘×¨:</strong> 
                            ${result ? 
                                '×”××¢×¨×›×ª ××¦××” ×”×ª×××” ×‘×™×Ÿ ×§×˜×’×•×¨×™×™×ª ×”××©×¨×” ×œ×§×˜×’×•×¨×™×•×ª ×”×× ×•×™ ×¢×œ ×¤×™ ×—×•×§×™ ×”×”×ª×××”' : 
                                '×œ× × ××¦××” ×”×ª×××” ×‘×™×Ÿ ×§×˜×’×•×¨×™×™×ª ×”××©×¨×” ×œ×§×˜×’×•×¨×™×•×ª ×”×× ×•×™'
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        function clearTestInputs() {
            document.getElementById('testJobCategory').value = '';
            document.getElementById('testSubscriberCategories').value = '';
            document.getElementById('realTimeResults').style.display = 'none';
        }

        // × ×™×ª×•×— ××¤×•×¨×˜ ×©×œ ×”×ª×××ª ××©×¨×” ×œ×× ×•×™×™×
        function analyzeJobMatching() {
            const jobNumber = document.getElementById('detailedJobSearch').value.trim();
            const resultsDiv = document.getElementById('detailedAnalysisResults');
            
            if (!jobNumber) {
                resultsDiv.innerHTML = '<div class="error">×× × ×”×›× ×¡ ××¡×¤×¨ ××©×¨×”</div>';
                resultsDiv.style.display = 'block';
                return;
            }

            resultsDiv.innerHTML = '<div class="loading">×× ×ª×— ×”×ª×××•×ª...</div>';
            resultsDiv.style.display = 'block';

            // ×—×™×¤×•×© ×”××©×¨×”
            const job = correctJobsManager.findJobById(jobNumber);
            
            if (!job) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        ×œ× × ××¦××” ××©×¨×” ×¢× ×”××¡×¤×¨: ${jobNumber}
                    </div>
                `;
                return;
            }

            // × ×¨××•×œ ×”××©×¨×”
            const normalizedJob = correctJobsManager.normalizeJob(job);
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];

            if (subscribers.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <i class="fas fa-users-slash"></i>
                        ××™×Ÿ ×× ×•×™×™× ×‘××¢×¨×›×ª. ×”×•×¡×£ ×× ×•×™×™× ×œ×‘×“×™×§×” ×›×“×™ ×œ×¨××•×ª ××ª ×”×”×ª×××•×ª.
                    </div>
                `;
                return;
            }

            // × ×™×ª×•×— ××¤×•×¨×˜ ×œ×›×œ ×× ×•×™
            const detailedAnalysis = subscribers.map(subscriber => {
                const categoryMatch = correctJobsManager.matchCategory(normalizedJob.category, subscriber.categories);
                const areaMatch = correctJobsManager.matchArea(normalizedJob.region, subscriber.areas);
                const overallMatch = categoryMatch && areaMatch;

                // × ×™×ª×•×— ××¤×•×¨×˜ ×©×œ ×”×ª×××ª ×§×˜×’×•×¨×™×•×ª
                const categoryAnalysis = analyzeCategoryMatch(normalizedJob.category, subscriber.categories);
                
                // × ×™×ª×•×— ××¤×•×¨×˜ ×©×œ ×”×ª×××ª ××–×•×¨×™×
                const areaAnalysis = analyzeAreaMatch(normalizedJob.region, subscriber.areas);

                return {
                    subscriber,
                    categoryMatch,
                    areaMatch,
                    overallMatch,
                    categoryAnalysis,
                    areaAnalysis
                };
            });

            // ×”×¦×’×ª ×”×ª×•×¦××•×ª
            showDetailedAnalysis(normalizedJob, detailedAnalysis);
        }

        function analyzeCategoryMatch(jobCategory, subscriberCategories) {
            const analysis = {
                jobCategory: jobCategory,
                subscriberCategories: subscriberCategories,
                matchFound: false,
                matchType: '',
                matchingWords: [],
                explanation: ''
            };

            if (!jobCategory || !subscriberCategories) {
                analysis.explanation = '×—×¡×¨×™× × ×ª×•× ×™ ×§×˜×’×•×¨×™×”';
                return analysis;
            }

            const jobCat = jobCategory.toLowerCase();

            for (const subCat of subscriberCategories) {
                const subCatLower = subCat.toLowerCase();

                // ×‘×“×™×§×ª ×”×ª×××” ××“×•×™×§×ª
                if (jobCat === subCatLower) {
                    analysis.matchFound = true;
                    analysis.matchType = '×”×ª×××” ××“×•×™×§×ª';
                    analysis.matchingWords = [subCat];
                    analysis.explanation = `×§×˜×’×•×¨×™×™×ª ×”××©×¨×” "${jobCategory}" ×–×”×” ×œ×§×˜×’×•×¨×™×™×ª ×”×× ×•×™ "${subCat}"`;
                    break;
                }

                // ×‘×“×™×§×ª ×”×ª×××” ×—×œ×§×™×ª
                if (jobCat.includes(subCatLower)) {
                    analysis.matchFound = true;
                    analysis.matchType = '×”×ª×××” ×—×œ×§×™×ª (×§×˜×’×•×¨×™×™×ª ×× ×•×™ ××•×›×œ×ª ×‘××©×¨×”)';
                    analysis.matchingWords = [subCat];
                    analysis.explanation = `×§×˜×’×•×¨×™×™×ª ×”×× ×•×™ "${subCat}" ××•×›×œ×ª ×‘×§×˜×’×•×¨×™×™×ª ×”××©×¨×” "${jobCategory}"`;
                    break;
                }

                if (subCatLower.includes(jobCat)) {
                    analysis.matchFound = true;
                    analysis.matchType = '×”×ª×××” ×—×œ×§×™×ª (×§×˜×’×•×¨×™×™×ª ××©×¨×” ××•×›×œ×ª ×‘×× ×•×™)';
                    analysis.matchingWords = [subCat];
                    analysis.explanation = `×§×˜×’×•×¨×™×™×ª ×”××©×¨×” "${jobCategory}" ××•×›×œ×ª ×‘×§×˜×’×•×¨×™×™×ª ×”×× ×•×™ "${subCat}"`;
                    break;
                }

                // ×‘×“×™×§×ª ×–×›×¨/× ×§×‘×” ×¢× ×¡×œ××©
                if (jobCat.includes('/')) {
                    const parts = jobCat.split('/');
                    for (const part of parts) {
                        const cleanPart = part.trim();
                        if (subCatLower.includes(cleanPart) || cleanPart.includes(subCatLower)) {
                            analysis.matchFound = true;
                            analysis.matchType = '×”×ª×××” ×–×›×¨/× ×§×‘×” (×¢× ×¡×œ××©)';
                            analysis.matchingWords = [subCat, cleanPart];
                            analysis.explanation = `× ××¦××” ×”×ª×××” ×‘×™×Ÿ "${cleanPart}" (××ª×•×š "${jobCategory}") ×œ×§×˜×’×•×¨×™×™×ª ×”×× ×•×™ "${subCat}"`;
                            break;
                        }
                    }
                    if (analysis.matchFound) break;
                }

                // ×‘×“×™×§×ª ××™×œ×•×ª ××¤×ª×—
                const keywordMatch = checkKeywordMatch(jobCat, subCatLower);
                if (keywordMatch.found) {
                    analysis.matchFound = true;
                    analysis.matchType = '×”×ª×××” ×œ×¤×™ ××™×œ×•×ª ××¤×ª×—';
                    analysis.matchingWords = keywordMatch.keywords;
                    analysis.explanation = `× ××¦××” ×”×ª×××” ×œ×¤×™ ××™×œ×•×ª ×”××¤×ª×—: ${keywordMatch.keywords.join(', ')}`;
                    break;
                }
            }

            if (!analysis.matchFound) {
                analysis.explanation = `×œ× × ××¦××” ×”×ª×××” ×‘×™×Ÿ ×§×˜×’×•×¨×™×™×ª ×”××©×¨×” "${jobCategory}" ×œ×§×˜×’×•×¨×™×•×ª ×”×× ×•×™: ${subscriberCategories.join(', ')}`;
            }

            return analysis;
        }

        function analyzeAreaMatch(jobArea, subscriberAreas) {
            const analysis = {
                jobArea: jobArea,
                subscriberAreas: subscriberAreas,
                matchFound: false,
                matchType: '',
                matchingAreas: [],
                explanation: ''
            };

            if (!jobArea || !subscriberAreas) {
                analysis.explanation = '×—×¡×¨×™× × ×ª×•× ×™ ××–×•×¨';
                return analysis;
            }

            const jobAreaLower = jobArea.toLowerCase();

            for (const subArea of subscriberAreas) {
                const subAreaLower = subArea.toLowerCase();

                // ×‘×“×™×§×ª ×”×ª×××” ××“×•×™×§×ª
                if (jobAreaLower === subAreaLower) {
                    analysis.matchFound = true;
                    analysis.matchType = '×”×ª×××” ××“×•×™×§×ª';
                    analysis.matchingAreas = [subArea];
                    analysis.explanation = `××–×•×¨ ×”××©×¨×” "${jobArea}" ×–×”×” ×œ××–×•×¨ ×”×× ×•×™ "${subArea}"`;
                    break;
                }

                // ×‘×“×™×§×ª ×”×ª×××” ×—×œ×§×™×ª
                if (jobAreaLower.includes(subAreaLower)) {
                    analysis.matchFound = true;
                    analysis.matchType = '×”×ª×××” ×—×œ×§×™×ª (××–×•×¨ ×× ×•×™ ××•×›×œ ×‘××©×¨×”)';
                    analysis.matchingAreas = [subArea];
                    analysis.explanation = `××–×•×¨ ×”×× ×•×™ "${subArea}" ××•×›×œ ×‘××–×•×¨ ×”××©×¨×” "${jobArea}"`;
                    break;
                }

                if (subAreaLower.includes(jobAreaLower)) {
                    analysis.matchFound = true;
                    analysis.matchType = '×”×ª×××” ×—×œ×§×™×ª (××–×•×¨ ××©×¨×” ××•×›×œ ×‘×× ×•×™)';
                    analysis.matchingAreas = [subArea];
                    analysis.explanation = `××–×•×¨ ×”××©×¨×” "${jobArea}" ××•×›×œ ×‘××–×•×¨ ×”×× ×•×™ "${subArea}"`;
                    break;
                }

                // ×‘×“×™×§×ª "×›×œ ×”××¨×¥"
                if (subAreaLower === '×›×œ ×”××¨×¥' || subAreaLower === '××—×¨') {
                    analysis.matchFound = true;
                    analysis.matchType = '×”×ª×××” ×›×œ×œ×™×ª';
                    analysis.matchingAreas = [subArea];
                    analysis.explanation = `×”×× ×•×™ ××¢×•× ×™×™×Ÿ ×‘"${subArea}" - ××ª××™× ×œ×›×œ ×”××©×¨×•×ª`;
                    break;
                }

                // ×”×ª×××•×ª ×’×™××•×’×¨×¤×™×•×ª ××™×•×—×“×•×ª
                if (subAreaLower === '××¨×›×–' && 
                    (jobAreaLower.includes('×ª×œ ××‘×™×‘') || jobAreaLower.includes('×¨××ª ×’×Ÿ') || jobAreaLower.includes('×’×•×© ×“×Ÿ'))) {
                    analysis.matchFound = true;
                    analysis.matchType = '×”×ª×××” ×’×™××•×’×¨×¤×™×ª';
                    analysis.matchingAreas = [subArea];
                    analysis.explanation = `××–×•×¨ ×”××©×¨×” "${jobArea}" × ××¦× ×‘××–×•×¨ "${subArea}" ×”×’×™××•×’×¨×¤×™`;
                    break;
                }
            }

            if (!analysis.matchFound) {
                analysis.explanation = `×œ× × ××¦××” ×”×ª×××” ×‘×™×Ÿ ××–×•×¨ ×”××©×¨×” "${jobArea}" ×œ××–×•×¨×™ ×”×× ×•×™: ${subscriberAreas.join(', ')}`;
            }

            return analysis;
        }

        function checkKeywordMatch(jobCategory, subscriberCategory) {
            const keywordMap = {
                '×œ×•×’×™×¡×˜×™×§×”': ['× ×”×’', '× ×”×™×’×”', '××©××™×ª', '×× ×•×£', '×”×•×‘×œ×”', '××—×¡×Ÿ', '×©×™×œ×•×—', '×“×¨×™×™×‘×¨'],
                '× ×”×™×’×”': ['×œ×•×’×™×¡×˜×™×§×”', '××©××™×ª', '×× ×•×£', '×”×•×‘×œ×”', '×ª×—×‘×•×¨×”', '×“×¨×™×™×‘×¨', '× ×”×’'],
                '×¤×™×ª×•×—': ['××¤×ª×—', '×ª×›× ×•×ª', '×ª×•×›× ×”', 'programmer', 'developer', '×§×•×“', '××¤×œ×™×§×¦×™×”'],
                '××›×™×¨×•×ª': ['×©×™×•×•×§', 'marketing', 'sales', '××•×›×¨', '×¡×™×™×œ', '×™×™×¢×•×¥'],
                '×—×™× ×•×š': ['××•×¨×”', '×”×•×¨××”', '××—× ×š', '×’× × ×ª', '×—×™× ×•×›×™×ª', '××—× ×›×ª'],
                '×‘×¨×™××•×ª': ['×¨×¤×•××”', '×¨×¤×•××™', '×¨×•×¤×', '××—×•×ª', '×¤×™×–×™×•×ª×¨×¤×™×”', '×˜×™×¤×•×œ'],
                '××–×•×Ÿ': ['××¡×¢×“×”', '×‘×™×©×•×œ', '×˜×‘×—', '×©×£', '××˜×‘×—', '×§×™×™×˜×¨×™× ×’'],
                '××‘×˜×—×”': ['×©××™×¨×”', '×‘×™×˜×—×•×Ÿ', '×©×•××¨', '×××‘×˜×—'],
                '×©×™×¨×•×ª': ['×œ×§×•×—×•×ª', '×§×¨×™××•×ª', '×ª××™×›×”', '××•×§×“'],
                '× ×™×”×•×œ': ['×× ×”×œ', '×× ×”×œ×ª', '×¨×™×›×•×–', '×‘×™×¦×•×¢', '×ª×™××•×']
            };

            const result = { found: false, keywords: [] };

            // ×—×™×¤×•×© ×“×•-×›×™×•×•× ×™
            for (const [key, keywords] of Object.entries(keywordMap)) {
                // ×× ×”×§×˜×’×•×¨×™×” ×©×œ ×”××©×¨×” ××›×™×œ×” ××™×œ×” ××¤×ª×—
                if (jobCategory.includes(key)) {
                    const matchingKeywords = keywords.filter(k => subscriberCategory.includes(k));
                    if (matchingKeywords.length > 0) {
                        result.found = true;
                        result.keywords = [key, ...matchingKeywords];
                        return result;
                    }
                }
                
                // ×× ×”×§×˜×’×•×¨×™×” ×©×œ ×”×× ×•×™ ××›×™×œ×” ××™×œ×” ××¤×ª×—
                if (subscriberCategory.includes(key)) {
                    const matchingKeywords = keywords.filter(k => jobCategory.includes(k));
                    if (matchingKeywords.length > 0) {
                        result.found = true;
                        result.keywords = [key, ...matchingKeywords];
                        return result;
                    }
                }
                
                // ×—×™×¤×•×© ×‘××™×œ×•×ª ×”××¤×ª×— ×¢×¦××Ÿ
                for (const keyword of keywords) {
                    if (jobCategory.includes(keyword) && subscriberCategory.includes(key)) {
                        result.found = true;
                        result.keywords = [keyword, key];
                        return result;
                    }
                    if (subscriberCategory.includes(keyword) && jobCategory.includes(key)) {
                        result.found = true;
                        result.keywords = [keyword, key];
                        return result;
                    }
                }
            }

            return result;
        }

        function showDetailedAnalysis(job, analysisResults) {
            const resultsDiv = document.getElementById('detailedAnalysisResults');
            
            const matchingSubscribers = analysisResults.filter(result => result.overallMatch);
            const nonMatchingSubscribers = analysisResults.filter(result => !result.overallMatch);

            resultsDiv.innerHTML = `
                <div style="background: rgba(246, 152, 152, 0.1); border: 1px solid rgba(246, 152, 152, 0.3); border-radius: 10px; padding: 20px;">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;">
                        <i class="fas fa-brain"></i> × ×™×ª×•×— ××¤×•×¨×˜ - ××©×¨×” ${job.jobNumber}
                    </h3>
                    
                    <!-- ×¤×¨×˜×™ ×”××©×¨×” -->
                    <div style="background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 10px;">ğŸ“‹ ×¤×¨×˜×™ ×”××©×¨×”:</h4>
                        <div><strong>×›×•×ª×¨×ª:</strong> ${job.title}</div>
                        <div><strong>×§×˜×’×•×¨×™×”:</strong> ${job.category}</div>
                        <div><strong>××–×•×¨:</strong> ${job.region}</div>
                        <div><strong>××¡×¤×¨:</strong> ${job.jobNumber}</div>
                    </div>

                    <!-- ×¡×™×›×•× ×”×ª×××•×ª -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(37, 211, 102, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(37, 211, 102, 0.3);">
                            <div style="font-size: 2em; font-weight: bold; color: #25D366; text-align: center;">${matchingSubscribers.length}</div>
                            <div style="text-align: center; color: #25D366;">×× ×•×™×™× ××ª××™××™×</div>
                        </div>
                        <div style="background: rgba(255, 71, 87, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(255, 71, 87, 0.3);">
                            <div style="font-size: 2em; font-weight: bold; color: #ff4757; text-align: center;">${nonMatchingSubscribers.length}</div>
                            <div style="text-align: center; color: #ff4757;">×× ×•×™×™× ×œ× ××ª××™××™×</div>
                        </div>
                    </div>

                    ${matchingSubscribers.length > 0 ? `
                        <!-- ×× ×•×™×™× ××ª××™××™× -->
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #25D366; margin-bottom: 15px;">
                                âœ… ×× ×•×™×™× ×©×™×§×‘×œ×• ×”×ª×¨××” (${matchingSubscribers.length})
                            </h4>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${matchingSubscribers.map(result => `
                                    <div style="background: rgba(37, 211, 102, 0.1); padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid rgba(37, 211, 102, 0.3);">
                                        <div style="font-weight: bold; color: #25D366; margin-bottom: 8px;">
                                            ğŸ“± ${result.subscriber.phone} - ${result.subscriber.name || '×œ×œ× ×©×'}
                                        </div>
                                        
                                        <div style="margin-bottom: 8px;">
                                            <strong>ğŸ¯ ×”×ª×××ª ×§×˜×’×•×¨×™×”:</strong> ${result.categoryAnalysis.matchType}
                                            <div style="font-size: 0.9em; color: #666; margin-top: 3px;">
                                                ${result.categoryAnalysis.explanation}
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <strong>ğŸ“ ×”×ª×××ª ××–×•×¨:</strong> ${result.areaAnalysis.matchType}
                                            <div style="font-size: 0.9em; color: #666; margin-top: 3px;">
                                                ${result.areaAnalysis.explanation}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    ${nonMatchingSubscribers.length > 0 ? `
                        <!-- ×× ×•×™×™× ×œ× ××ª××™××™× -->
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #ff4757; margin-bottom: 15px;">
                                âŒ ×× ×•×™×™× ×©×œ× ×™×§×‘×œ×• ×”×ª×¨××” (${nonMatchingSubscribers.length})
                            </h4>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${nonMatchingSubscribers.map(result => `
                                    <div style="background: rgba(255, 71, 87, 0.1); padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid rgba(255, 71, 87, 0.3);">
                                        <div style="font-weight: bold; color: #ff4757; margin-bottom: 8px;">
                                            ğŸ“± ${result.subscriber.phone} - ${result.subscriber.name || '×œ×œ× ×©×'}
                                        </div>
                                        
                                        <div style="margin-bottom: 8px;">
                                            <strong>ğŸ¯ ×§×˜×’×•×¨×™×”:</strong> ${result.categoryMatch ? 'âœ…' : 'âŒ'}
                                            <div style="font-size: 0.9em; color: #666; margin-top: 3px;">
                                                ${result.categoryAnalysis.explanation}
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <strong>ğŸ“ ××–×•×¨:</strong> ${result.areaMatch ? 'âœ…' : 'âŒ'}
                                            <div style="font-size: 0.9em; color: #666; margin-top: 3px;">
                                                ${result.areaAnalysis.explanation}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” -->
                    <div style="margin-top: 20px; text-align: center;">
                        ${matchingSubscribers.length > 0 ? `
                            <button class="btn" onclick="sendToAnalyzedSubscribers('${job.id}')">
                                <i class="fas fa-paper-plane"></i> ×©×œ×— ×œ-${matchingSubscribers.length} ×× ×•×™×™× ××ª××™××™×
                            </button>
                        ` : `
                            <div style="color: #999; font-style: italic;">
                                ××™×Ÿ ×× ×•×™×™× ××ª××™××™× ×œ×©×œ×™×—×”
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function sendToAnalyzedSubscribers(jobId) {
            const job = correctJobsManager.findJobById(jobId);
            if (!job) return;

            const normalizedJob = correctJobsManager.normalizeJob(job);
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            const matchingSubscribers = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);

            if (matchingSubscribers.length === 0) {
                alert('××™×Ÿ ×× ×•×™×™× ××ª××™××™×');
                return;
            }

            // ×™×¦×™×¨×ª ×”×•×“×¢×”
            const message = `ğŸ”¥ ××©×¨×” ×—×“×©×”!
ğŸ“‹ ${normalizedJob.title}
ğŸ“ ${normalizedJob.region}
ğŸ¯ ${normalizedJob.category}

×œ×¤×¨×˜×™× × ×•×¡×¤×™×: https://www.mayeshpo.co.il

×‘×”×¦×œ×—×”! ğŸ’ª`;

            // ×”×¦×’×ª ×ª×¦×•×’×” ××§×“×™××” ××¤×•×¨×˜×ª
            showDetailedPreview(message, matchingSubscribers, normalizedJob);
        }

        function showDetailedPreview(message, subscribers, job) {
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.innerHTML = `
                <div class="preview-content" style="max-width: 700px;">
                    <h3><i class="fas fa-paper-plane"></i> ×ª×¦×•×’×” ××§×“×™××” ××¤×•×¨×˜×ª</h3>
                    
                    <div style="margin: 15px 0;">
                        <strong>××©×¨×”:</strong> ${job.title}<br>
                        <strong>× ××¢× ×™×:</strong> ${subscribers.length} ×× ×•×™×™× ×©×¢×‘×¨×• ××ª ××¢×¨×›×ª ×”×”×ª×××”
                    </div>
                    
                    <h4>×”×•×“×¢×” ×©×ª×™×©×œ×—:</h4>
                    <div class="whatsapp-message">
                        ${message.replace(/\n/g, '<br>')}
                    </div>
                    
                    <h4>×¨×©×™××ª × ××¢× ×™× ××¤×•×¨×˜×ª:</h4>
                    <div style="max-height: 250px; overflow-y: auto; background: rgba(246, 152, 152, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(246, 152, 152, 0.3);">
                        ${subscribers.map((sub, index) => `
                            <div style="display: flex; align-items: center; padding: 8px; border-bottom: 1px solid rgba(246, 152, 152, 0.2); ${index === subscribers.length - 1 ? 'border-bottom: none;' : ''}">
                                <input type="checkbox" id="subscriber_${index}" checked style="margin-left: 10px;">
                                <label for="subscriber_${index}" style="flex: 1; cursor: pointer;">
                                    ğŸ“± ${sub.phone} - ${sub.name || '×œ×œ× ×©×'}
                                    <div style="font-size: 0.8em; color: #999; margin-top: 2px;">
                                        ×§×˜×’×•×¨×™×•×ª: ${sub.categories.join(', ')} | ××–×•×¨×™×: ${sub.areas.join(', ')}
                                    </div>
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin: 15px 0; padding: 10px; background: rgba(255, 193, 7, 0.1); border-radius: 5px; border: 1px solid rgba(255, 193, 7, 0.3);">
                        <small>ğŸ’¡ × ×™×ª×Ÿ ×œ×‘×˜×œ ×‘×—×™×¨×ª ×× ×•×™×™× ×¡×¤×¦×™×¤×™×™× ×œ×¤× ×™ ×”×©×œ×™×—×”</small>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                        <button class="btn" onclick="confirmSelectedSend('${job.id}')">
                            <i class="fas fa-paper-plane"></i> ×©×œ×— ×œ× ×‘×—×¨×™×
                        </button>
                        <button class="btn" onclick="selectAllSubscribers(true)">
                            <i class="fas fa-check-double"></i> ×‘×—×¨ ×”×›×œ
                        </button>
                        <button class="btn" onclick="selectAllSubscribers(false)">
                            <i class="fas fa-times"></i> ×‘×˜×œ ×”×›×œ
                        </button>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i> ×¡×’×•×¨
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function selectAllSubscribers(selectAll) {
            const checkboxes = document.querySelectorAll('input[id^="subscriber_"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll;
            });
        }

        function confirmSelectedSend(jobId) {
            const checkboxes = document.querySelectorAll('input[id^="subscriber_"]:checked');
            const selectedCount = checkboxes.length;
            
            if (selectedCount === 0) {
                alert('×× × ×‘×—×¨ ×œ×¤×—×•×ª ×× ×•×™ ××—×“ ×œ×©×œ×™×—×”');
                return;
            }

            if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×©×œ×•×— ×œ-${selectedCount} ×× ×•×™×™× × ×‘×—×¨×™×?`)) {
                // ×›××Ÿ ×™×”×™×” ×”×§×•×“ ×œ×©×œ×™×—×” ×‘×¤×•×¢×œ
                console.log(`ğŸ“± ×©×•×œ×— ×”×•×“×¢×” ×œ-${selectedCount} ×× ×•×™×™× × ×‘×—×¨×™× ×œ××©×¨×” ${jobId}`);
                
                // ×¡×’×™×¨×ª ×”××•×“×œ
                document.querySelector('.preview-modal')?.remove();
                
                // ×”×•×“×¢×ª ×”×¦×œ×—×”
                const resultsDiv = document.getElementById('detailedAnalysisResults');
                resultsDiv.innerHTML += `
                    <div style="background: rgba(37, 211, 102, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px; border: 1px solid rgba(37, 211, 102, 0.3);">
                        <i class="fas fa-check-circle"></i>
                        ×”×”×•×“×¢×•×ª × ×©×œ×—×• ×‘×”×¦×œ×—×” ×œ-${selectedCount} ×× ×•×™×™× × ×‘×—×¨×™×!
                    </div>
                `;

                // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
                const currentAlerts = parseInt(localStorage.getItem('whatsapp_total_alerts') || '0');
                localStorage.setItem('whatsapp_total_alerts', (currentAlerts + selectedCount).toString());
                adminPanel.updateStats();
            }
        }

        // ×™×¦×™×¨×ª ×˜×•×¤×¡ ×”×•×¡×¤×ª ×× ×•×™ ×—×“×©
        function createNewSubscriberForm() {
            // ×˜×¢×™× ×ª ×§×˜×’×•×¨×™×•×ª
            const categoriesContainer = document.getElementById('newSubscriberCategories');
            if (categoriesContainer) {
const categories = correctJobsManager.getCategories();
                categoriesContainer.innerHTML = '';
                
                categories.forEach(category => {
                    const label = document.createElement('label');
                    label.style.display = 'block';
                    label.style.margin = '5px';
                    label.style.cursor = 'pointer';
                    label.style.padding = '5px';
                    label.style.borderRadius = '5px';
                    label.style.transition = 'background-color 0.2s';
                    label.style.color = 'white';
                    
                    label.onmouseover = function() { this.style.backgroundColor = 'rgba(246, 152, 152, 0.1)'; };
                    label.onmouseout = function() { this.style.backgroundColor = 'transparent'; };
                    
                    label.innerHTML = `
                        <input type="checkbox" name="newCategories" value="${category}" style="margin-left: 8px;">
                        ${category}
                    `;
                    
                    categoriesContainer.appendChild(label);
                });
            }
            
            // ×˜×¢×™× ×ª ××–×•×¨×™×
            const areasContainer = document.getElementById('newSubscriberAreas');
            if (areasContainer) {
const areas = correctJobsManager.getAreas();
                areasContainer.innerHTML = '';
                
                areas.forEach(area => {
                    const label = document.createElement('label');
                    label.style.display = 'block';
                    label.style.margin = '5px';
                    label.style.cursor = 'pointer';
                    label.style.padding = '5px';
                    label.style.borderRadius = '5px';
                    label.style.transition = 'background-color 0.2s';
                    label.style.color = 'white';
                    
                    label.onmouseover = function() { this.style.backgroundColor = 'rgba(246, 152, 152, 0.1)'; };
                    label.onmouseout = function() { this.style.backgroundColor = 'transparent'; };
                    
                    label.innerHTML = `
                        <input type="checkbox" name="newAreas" value="${area}" style="margin-left: 8px;">
                        ${area}
                    `;
                    
                    areasContainer.appendChild(label);
                });
            }
            
            // ×”×’×‘×œ×ª ×‘×—×™×¨×ª ×§×˜×’×•×¨×™×•×ª ×•××–×•×¨×™×
            limitCheckboxesSelection('newCategories', 3);
            limitCheckboxesSelection('newAreas', 3);
        }

        // ×”×’×‘×œ×ª ×‘×—×™×¨×ª ×¦'×§×‘×•×§×¡×™×
        function limitCheckboxesSelection(name, max) {
            const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    const checked = document.querySelectorAll(`input[name="${name}"]:checked`);
                    if (checked.length >= max) {
                        checkboxes.forEach(cb => {
                            if (!cb.checked) cb.disabled = true;
                        });
                    } else {
                        checkboxes.forEach(cb => cb.disabled = false);
                    }
                });
            });
        }

        // ×”×•×¡×¤×ª ×× ×•×™ ×—×“×©
        function addNewSubscriber() {
            const name = document.getElementById('newSubscriberName').value.trim();
            const phone = document.getElementById('newSubscriberPhone').value.trim();
            const categories = Array.from(document.querySelectorAll('input[name="newCategories"]:checked')).map(cb => cb.value);
            const areas = Array.from(document.querySelectorAll('input[name="newAreas"]:checked')).map(cb => cb.value);
            
            // ×•×œ×™×“×¦×™×”
            if (!name) {
                adminPanel?.showAlert('×× × ×”×›× ×¡ ×©× ××œ×', 'error');
                return;
            }
            
            if (!phone) {
                adminPanel?.showAlert('×× × ×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ', 'error');
                return;
            }
            
            if (categories.length === 0) {
                adminPanel?.showAlert('×× × ×‘×—×¨ ×œ×¤×—×•×ª ×ª×—×•× ×¢× ×™×™×Ÿ ××—×“', 'error');
                return;
            }
            
            if (areas.length === 0) {
                adminPanel?.showAlert('×× × ×‘×—×¨ ×œ×¤×—×•×ª ××–×•×¨ ××—×“', 'error');
                return;
            }
            
            // × ×™×§×•×™ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ
            let cleanPhone = phone.replace(/[^\d+]/g, '');
            if (cleanPhone.startsWith('0')) {
                cleanPhone = '+972' + cleanPhone.substring(1);
            }
            if (!cleanPhone.startsWith('+')) {
                cleanPhone = '+972' + cleanPhone;
            }
            
            // ×™×¦×™×¨×ª ××•×‘×™×™×§×˜ ×× ×•×™ ×—×“×©
            const newSubscriber = {
                id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: name,
                phone: cleanPhone,
                categories: categories,
                areas: areas,
                registrationDate: new Date().toISOString(),
                active: true,
                source: 'admin_panel'
            };
            
            // ×‘×“×™×§×” ×× ×”×× ×•×™ ×›×‘×¨ ×§×™×™×
            const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
            const exists = subscribers.some(sub => sub.phone === cleanPhone);
            
            if (exists) {
                if (!confirm(`×× ×•×™ ×¢× ××¡×¤×¨ ${cleanPhone} ×›×‘×¨ ×§×™×™× ×‘××¢×¨×›×ª. ×”×× ×œ×¢×“×›×Ÿ ××ª ×”×¤×¨×˜×™×?`)) {
                    return;
                }
                
                // ×¢×“×›×•×Ÿ ×× ×•×™ ×§×™×™×
                const index = subscribers.findIndex(sub => sub.phone === cleanPhone);
                if (index !== -1) {
                    subscribers[index] = {
                        ...subscribers[index],
                        name: name,
                        categories: categories,
                        areas: areas,
                        updatedAt: new Date().toISOString()
                    };
                    
                    // ×©××™×¨×ª ×”×¢×“×›×•×Ÿ
                    adminPanel.whatsappAlerts.subscribers = subscribers;
                    adminPanel.saveSubscribers();
                    
                    adminPanel?.showAlert(`×”×× ×•×™ ${name} ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!`, 'success');
                }
            } else {
                // ×”×•×¡×¤×ª ×× ×•×™ ×—×“×©
                adminPanel.whatsappAlerts.addSubscriber(newSubscriber);
                
                // ×©×œ×™×—×ª ×”×ª×¨××” ×™×©×™×¨×” ×œ×‘×¢×œ ×”××ª×¨
                adminPanel.whatsappAlerts.sendDirectAlert(newSubscriber);
                
                adminPanel?.showAlert(`×”×× ×•×™ ${name} × ×•×¡×£ ×‘×”×¦×œ×—×”!`, 'success');
            }
            
            // ×¨×¢× ×•×Ÿ ×”×ª×¦×•×’×”
            adminPanel.renderSubscribers();
            adminPanel.updateStats();
            adminPanel.loadSubscriberSelect();
            
            // × ×™×§×•×™ ×”×˜×•×¤×¡
            resetNewSubscriberForm();
        }

        // × ×™×§×•×™ ×˜×•×¤×¡ ×”×•×¡×¤×ª ×× ×•×™
        function resetNewSubscriberForm() {
            document.getElementById('newSubscriberName').value = '';
            document.getElementById('newSubscriberPhone').value = '';
            
            // ××™×¤×•×¡ ×ª×™×‘×•×ª ×”×¡×™××•×Ÿ
            document.querySelectorAll('input[name="newCategories"]').forEach(cb => {
                cb.checked = false;
                cb.disabled = false;
            });
            
            document.querySelectorAll('input[name="newAreas"]').forEach(cb => {
                cb.checked = false;
                cb.disabled = false;
            });
        }

        // ××ª×—×•×œ ×”×¤×× ×œ
        let adminPanel;
        document.addEventListener('DOMContentLoaded', function() {
            // ×”××ª×Ÿ ×§×¦×ª ×œ×˜×¢×™× ×” ××œ××”
            setTimeout(() => {
                adminPanel = new AdminPanel();
                
                console.log('ğŸš€ ×¤×× ×œ × ×™×”×•×œ ×× ×•×™×™× ×”×•×¤×¢×œ ×‘×”×¦×œ×—×”!');
                console.log('ğŸ“± ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×”××¢×•×“×›×Ÿ: 0555504633');
                console.log('ğŸ¯ ×”×ª×××” ××©×•×¤×¨×ª ×œ×–×›×¨/× ×§×‘×” ×¢× ×¡×œ××© (/)');
                console.log('ğŸ“Š ×§×˜×’×•×¨×™×•×ª ×•××–×•×¨×™× × ×˜×¢× ×™× ×“×™× ××™×ª');
            }, 1000);
            
            // ×™×¦×™×¨×ª ×˜×•×¤×¡ ×”×•×¡×¤×ª ×× ×•×™
            setTimeout(() => {
                createNewSubscriberForm();
            }, 1500);
            
            // ×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ×›×œ 30 ×©× ×™×•×ª
            setInterval(() => {
                if (adminPanel) {
                    adminPanel.updateStats();
                }
            }, 30000);
        });

        // ×¡×’×™×¨×ª ××•×“×œ×™× ×‘×œ×—×™×¦×” ×¢×œ ×”×¨×§×¢
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('preview-modal')) {
                e.target.remove();
            }
     });

            // ×¤×•× ×§×¦×™×•×ª ×¡×¨×™×§×ª ××©×¨×•×ª ×•×”×ª×××” ×œ×× ×•×™×™×
function scanAllJobsForAllSubscribers() {
    const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
    const jobs = correctJobsManager.getAllJobs();
    const resultsDiv = document.getElementById('jobScanResults');
    
    if (subscribers.length === 0) {
        adminPanel?.showAlert('××™×Ÿ ×× ×•×™×™× ×‘××¢×¨×›×ª', 'error');
        return;
    }
    
    if (jobs.length === 0) {
        adminPanel?.showAlert('××™×Ÿ ××©×¨×•×ª ×‘××¢×¨×›×ª', 'error');
        return;
    }
    
    resultsDiv.style.display = 'block';
    resultsDiv.innerHTML = '<div class="loading">×¡×•×¨×§ ××©×¨×•×ª ×•××ª××™× ×œ×× ×•×™×™×...</div>';
    
    // × ×™×ª×•×— ×”×ª×××•×ª
    const matchResults = [];
    
    jobs.forEach(job => {
        const normalizedJob = correctJobsManager.normalizeJob(job);
        const matchingSubscribers = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);
        
        if (matchingSubscribers.length > 0) {
            matchResults.push({
                job: normalizedJob,
                matchingSubscribers: matchingSubscribers,
                matchCount: matchingSubscribers.length
            });
        }
    });
    
    // ×”×¦×’×ª ×ª×•×¦××•×ª
    displayJobScanResults(matchResults, jobs.length, subscribers.length);
}

function scanNewJobsOnly() {
    // ×¤×•× ×§×¦×™×” ×œ×¡×¨×™×§×ª ××©×¨×•×ª ×—×“×©×•×ª ×‘×œ×‘×“ (×œ×¤×™ ×ª××¨×™×š)
    const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
    const jobs = correctJobsManager.getAllJobs();
    const resultsDiv = document.getElementById('jobScanResults');
    
    if (subscribers.length === 0) {
        adminPanel?.showAlert('××™×Ÿ ×× ×•×™×™× ×‘××¢×¨×›×ª', 'error');
        return;
    }
    
    // ×¡×™× ×•×Ÿ ××©×¨×•×ª ×—×“×©×•×ª (××©×‘×•×¢ ×”××—×¨×•×Ÿ)
    const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
    const newJobs = jobs.filter(job => {
        const jobDate = job.createdAt ? new Date(job.createdAt) : new Date();
        return jobDate >= oneWeekAgo;
    });
    
    if (newJobs.length === 0) {
        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = `
            <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(255, 193, 7, 0.3);">
                <i class="fas fa-info-circle"></i>
                ×œ× × ××¦××• ××©×¨×•×ª ×—×“×©×•×ª ××”×©×‘×•×¢ ×”××—×¨×•×Ÿ
            </div>
        `;
        return;
    }
    
    resultsDiv.style.display = 'block';
    resultsDiv.innerHTML = '<div class="loading">×¡×•×¨×§ ××©×¨×•×ª ×—×“×©×•×ª...</div>';
    
    // × ×™×ª×•×— ×”×ª×××•×ª ×œ××©×¨×•×ª ×—×“×©×•×ª
    const matchResults = [];
    
    newJobs.forEach(job => {
        const normalizedJob = correctJobsManager.normalizeJob(job);
        const matchingSubscribers = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);
        
        if (matchingSubscribers.length > 0) {
            matchResults.push({
                job: normalizedJob,
                matchingSubscribers: matchingSubscribers,
                matchCount: matchingSubscribers.length
            });
        }
    });
    
    // ×”×¦×’×ª ×ª×•×¦××•×ª
    displayJobScanResults(matchResults, newJobs.length, subscribers.length, true);
}

function displayJobScanResults(matchResults, totalJobs, totalSubscribers, isNewJobsOnly = false) {
    const resultsDiv = document.getElementById('jobScanResults');
    const totalMatches = matchResults.reduce((sum, result) => sum + result.matchCount, 0);
    
    resultsDiv.innerHTML = `
        <div style="background: rgba(40, 167, 69, 0.1); border: 1px solid rgba(40, 167, 69, 0.3); border-radius: 10px; padding: 20px;">
            <h3 style="color: #28a745; margin-bottom: 15px;">
                <i class="fas fa-chart-bar"></i> ×ª×•×¦××•×ª ×¡×¨×™×§×ª ××©×¨×•×ª ${isNewJobsOnly ? '(×—×“×©×•×ª ×‘×œ×‘×“)' : ''}
            </h3>
            
            <!-- ×¡×™×›×•× ×›×œ×œ×™ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: bold; color: #28a745;">${totalJobs}</div>
                    <div style="color: #cccccc;">××©×¨×•×ª × ×¡×¨×§×•</div>
                </div>
                <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: bold; color: #28a745;">${matchResults.length}</div>
                    <div style="color: #cccccc;">××©×¨×•×ª ×¢× ×”×ª×××•×ª</div>
                </div>
                <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: bold; color: #28a745;">${totalMatches}</div>
                    <div style="color: #cccccc;">×¡×”"×› ×”×ª×¨××•×ª</div>
                </div>
                <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: bold; color: #28a745;">${totalSubscribers}</div>
                    <div style="color: #cccccc;">×× ×•×™×™× ×‘××¢×¨×›×ª</div>
                </div>
            </div>

            ${matchResults.length > 0 ? `
                <!-- ×¨×©×™××ª ××©×¨×•×ª ×¢× ×”×ª×××•×ª -->
                <h4 style="color: #28a745; margin-bottom: 15px;">××©×¨×•×ª ×¢× ×”×ª×××•×ª ×œ×× ×•×™×™×:</h4>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${matchResults.map((result, index) => `
                        <div style="background: rgba(40, 167, 69, 0.05); padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid rgba(40, 167, 69, 0.2);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: bold; color: #28a745;">${result.job.title}</div>
                                    <div style="font-size: 0.9em; color: #cccccc;">
                                        ${result.job.jobNumber} | ${result.job.category} | ${result.job.region}
                                    </div>
                                </div>
                                <div style="background: #28a745; color: white; padding: 5px 10px; border-radius: 15px; font-weight: bold;">
                                    ${result.matchCount} ×× ×•×™×™×
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <strong>×× ×•×™×™× ××ª××™××™×:</strong>
                                ${result.matchingSubscribers.map(sub => 
                                    `<span style="background: rgba(40, 167, 69, 0.2); color: #28a745; padding: 2px 8px; border-radius: 10px; margin: 2px; display: inline-block; font-size: 0.8em;">
                                        ${sub.name} (${sub.phone})
                                    </span>`
                                ).join('')}
                            </div>
                            
                            <button class="btn btn-small" onclick="sendJobToMatchingSubscribers('${result.job.id}', ${index})" style="background: #28a745;">
                                <i class="fas fa-paper-plane"></i> ×©×œ×— ×œ-${result.matchCount} ×× ×•×™×™×
                            </button>
                        </div>
                    `).join('')}
                </div>
                
                <!-- ×›×¤×ª×•×¨ ×©×œ×™×—×” ×›×œ×œ×™×ª -->
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn" onclick="sendAllMatchingJobs()" style="background: linear-gradient(135deg, #28a745, #20c997); font-size: 18px; padding: 15px 30px;">
                        <i class="fas fa-broadcast-tower"></i> ×©×œ×— ×›×œ ×”×”×ª×¨××•×ª (${totalMatches} ×”×ª×¨××•×ª)
                    </button>
                </div>
            ` : `
                <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(255, 193, 7, 0.3); text-align: center;">
                    <i class="fas fa-info-circle"></i>
                    ×œ× × ××¦××• ×”×ª×××•×ª ×‘×™×Ÿ ×”××©×¨×•×ª ×œ×× ×•×™×™× ×‘××¢×¨×›×ª
                </div>
            `}
        </div>
    `;
}

function sendJobToMatchingSubscribers(jobId, resultIndex) {
    const job = correctJobsManager.findJobById(jobId);
    if (!job) return;

    const normalizedJob = correctJobsManager.normalizeJob(job);
    const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
    const matchingSubscribers = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);

    if (matchingSubscribers.length === 0) {
        alert('××™×Ÿ ×× ×•×™×™× ××ª××™××™×');
        return;
    }

    const message = `ğŸ”¥ ××©×¨×” ×—×“×©×” ××ª××™××” ×¢×‘×•×¨×š!

ğŸ“‹ ${normalizedJob.title}
ğŸ“ ${normalizedJob.region}
ğŸ¯ ${normalizedJob.category}
ğŸ†” ××¡×¤×¨ ××©×¨×”: ${normalizedJob.jobNumber}

×œ×¤×¨×˜×™× × ×•×¡×¤×™×: https://www.mayeshpo.co.il

×‘×”×¦×œ×—×”! ğŸ’ª`;

    showPreview(message, matchingSubscribers, normalizedJob);
}

function sendAllMatchingJobs() {
    const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
    const jobs = correctJobsManager.getAllJobs();
    
    if (subscribers.length === 0 || jobs.length === 0) {
        alert('××™×Ÿ ×× ×•×™×™× ××• ××©×¨×•×ª ×‘××¢×¨×›×ª');
        return;
    }
    
    let totalAlerts = 0;
    let processedJobs = 0;
    
    const modal = document.createElement('div');
    modal.className = 'preview-modal';
    modal.innerHTML = `
        <div class="preview-content">
            <h3><i class="fas fa-broadcast-tower"></i> ×©×œ×™×—×ª ×›×œ ×”×”×ª×¨××•×ª</h3>
            
            <div style="margin: 20px 0;">
                <div id="sendingProgress">××¢×‘×“ ××©×¨×•×ª...</div>
                <div style="background: #333; border-radius: 5px; overflow: hidden; margin-top: 10px;">
                    <div id="progressBar" style="background: #28a745; height: 20px; width: 0%; transition: width 0.3s;"></div>
                </div>
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i> ×¡×’×•×¨
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // ×¡×™××•×œ×¦×™×” ×©×œ ×©×œ×™×—×ª ×”×ª×¨××•×ª
    jobs.forEach((job, index) => {
        setTimeout(() => {
            const normalizedJob = correctJobsManager.normalizeJob(job);
            const matchingSubscribers = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);
            
            if (matchingSubscribers.length > 0) {
                totalAlerts += matchingSubscribers.length;
                console.log(`ğŸ“± ×©×•×œ×— ${matchingSubscribers.length} ×”×ª×¨××•×ª ×¢×‘×•×¨ ××©×¨×”: ${normalizedJob.title}`);
            }
            
            processedJobs++;
            const progress = (processedJobs / jobs.length) * 100;
            
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('sendingProgress');
            
            if (progressBar) progressBar.style.width = progress + '%';
            if (progressText) progressText.textContent = `××¢×‘×“ ××©×¨×” ${processedJobs}/${jobs.length}...`;
            
            // ×¡×™×•× ×”×ª×”×œ×™×š
            if (processedJobs === jobs.length) {
                setTimeout(() => {
                    if (progressText) {
                        progressText.innerHTML = `
                            <div style="color: #28a745; font-weight: bold;">
                                âœ… ×”×•×©×œ×! × ×©×œ×—×• ${totalAlerts} ×”×ª×¨××•×ª ×œ×× ×•×™×™×
                            </div>
                        `;
                    }
                    
                    // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
                    const currentAlerts = parseInt(localStorage.getItem('whatsapp_total_alerts') || '0');
                    localStorage.setItem('whatsapp_total_alerts', (currentAlerts + totalAlerts).toString());
                    adminPanel?.updateStats();
                    
                    // ×¡×’×™×¨×” ××•×˜×•××˜×™×ª
                    setTimeout(() => {
                        modal.remove();
                        adminPanel?.showAlert(`× ×©×œ×—×• ${totalAlerts} ×”×ª×¨××•×ª ×‘×”×¦×œ×—×”!`, 'success');
                    }, 2000);
                }, 500);
            }
        }, index * 100); // ×¢×™×›×•×‘ ×§×˜×Ÿ ×‘×™×Ÿ ××©×¨×•×ª
    });
}

function showJobMatchingReport() {
    const subscribers = adminPanel?.whatsappAlerts?.getSubscribers() || [];
    const jobs = correctJobsManager.getAllJobs();
    
    if (subscribers.length === 0 || jobs.length === 0) {
        adminPanel?.showAlert('××™×Ÿ ×× ×•×™×™× ××• ××©×¨×•×ª ×‘××¢×¨×›×ª', 'error');
        return;
    }
    
    // × ×™×ª×•×— ××¤×•×¨×˜
    const matchingStats = {
        totalJobs: jobs.length,
        totalSubscribers: subscribers.length,
        jobsWithMatches: 0,
        subscribersWithMatches: 0,
        totalPossibleAlerts: 0,
        categoryBreakdown: {},
        areaBreakdown: {}
    };
    
    subscribers.forEach(subscriber => {
        const matchingJobs = jobs.filter(job => {
            const normalizedJob = correctJobsManager.normalizeJob(job);
            return correctJobsManager.findMatchingSubscribers(normalizedJob, [subscriber]).length > 0;
        });
        
        if (matchingJobs.length > 0) {
            matchingStats.subscribersWithMatches++;
            matchingStats.totalPossibleAlerts += matchingJobs.length;
        }
        
        // × ×™×ª×•×— ×œ×¤×™ ×§×˜×’×•×¨×™×•×ª
        subscriber.categories.forEach(cat => {
            matchingStats.categoryBreakdown[cat] = (matchingStats.categoryBreakdown[cat] || 0) + matchingJobs.length;
        });
    });
    
    jobs.forEach(job => {
        const normalizedJob = correctJobsManager.normalizeJob(job);
        const matchingSubscribers = correctJobsManager.findMatchingSubscribers(normalizedJob, subscribers);
        
        if (matchingSubscribers.length > 0) {
            matchingStats.jobsWithMatches++;
        }
    });
    
    // ×”×¦×’×ª ×”×“×•×—
    const modal = document.createElement('div');
    modal.className = 'preview-modal';
    modal.innerHTML = `
        <div class="preview-content" style="max-width: 800px;">
            <h3><i class="fas fa-chart-line"></i> ×“×•×— ×”×ª×××•×ª ××¤×•×¨×˜</h3>
            
            <div style="margin: 20px 0;">
                <h4 style="color: var(--primary-color);">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ×›×œ×œ×™×•×ª:</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                    <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #28a745;">${matchingStats.totalJobs}</div>
                        <div style="color: #cccccc;">×¡×”"×› ××©×¨×•×ª</div>
                    </div>
                    <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #28a745;">${matchingStats.jobsWithMatches}</div>
                        <div style="color: #cccccc;">××©×¨×•×ª ×¢× ×”×ª×××•×ª</div>
                    </div>
                    <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #28a745;">${matchingStats.totalSubscribers}</div>
                        <div style="color: #cccccc;">×¡×”"×› ×× ×•×™×™×</div>
                    </div>
                    <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #28a745;">${matchingStats.subscribersWithMatches}</div>
                        <div style="color: #cccccc;">×× ×•×™×™× ×¢× ×”×ª×××•×ª</div>
                    </div>
                </div>
                
                <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4 style="color: #28a745;">×¡×”"×› ×”×ª×¨××•×ª ××¤×©×¨×™×•×ª: ${matchingStats.totalPossibleAlerts}</h4>
                    <div style="color: #cccccc;">×–×”×• ×”××¡×¤×¨ ×”×›×•×œ×œ ×©×œ ×”×ª×¨××•×ª ×©×™×™×©×œ×—×• ×× ×ª×¨×™×¥ ×¡×¨×™×§×” ××œ××”</div>
                </div>
            </div>
            
            <button class="close-btn" onclick="this.parentElement.parentElement.remove()">
                <i class="fas fa-times"></i> ×¡×’×•×¨
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);

});
    </script>
</body>
</html>
