<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מה יש פה? - מערכת ניהול GitHub</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚙️</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            line-height: 1.6;
            direction: rtl;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            padding: 1rem 0;
            border-bottom: 3px solid #F69898;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .header-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .text-logo {
            color: #F69898;
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 0 2px 5px rgba(246,152,152,0.3);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0,0,0,0.3);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        .sync-indicator.syncing {
            background: #ffc107;
            animation: spin 1s linear infinite;
        }

        .sync-indicator.error {
            background: #dc3545;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .main-nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .main-nav a {
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .main-nav a:hover,
        .main-nav a.active {
            background: linear-gradient(135deg, #F69898, #ff9e9e);
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(246,152,152,0.3);
        }

        /* Login Section */
        #adminLoginSection {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
        }

        .admin-login-box {
            background: linear-gradient(135deg, #333333 0%, #444444 100%);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 600px;
            text-align: center;
            border: 2px solid #F69898;
            position: relative;
            overflow: hidden;
        }

        .admin-login-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(246,152,152,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .admin-login-title {
            color: #F69898;
            font-size: 2.5rem;
            margin-bottom: 40px;
            font-weight: bold;
            text-shadow: 0 2px 10px rgba(246,152,152,0.3);
        }

        /* GitHub Config Box */
        .github-config {
            background: rgba(0,0,0,0.3);
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            border: 2px solid #F69898;
        }

        .github-config h4 {
            color: #F69898;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .github-url-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #555;
            border-radius: 8px;
            background: #2a2a2a;
            color: white;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .github-url-input:focus {
            border-color: #F69898;
            outline: none;
            box-shadow: 0 0 15px rgba(246,152,152,0.3);
        }

        .github-help {
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.5;
            text-align: right;
        }

        #adminContentSection {
            display: none;
            padding: 2rem 0;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* שאר כל הסטיילים */
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            color: #F69898;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .form-input, .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid #555;
            border-radius: 10px;
            background: linear-gradient(135deg, #2a2a2a 0%, #333333 100%);
            color: #ffffff;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-control:focus {
            outline: none;
            border-color: #F69898;
            box-shadow: 0 0 20px rgba(246, 152, 152, 0.3);
            transform: translateY(-2px);
        }

        .btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #F69898, #ff9e9e);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            box-shadow: 0 5px 15px rgba(246,152,152,0.3);
        }

        .btn:hover {
            background: linear-gradient(135deg, #e58080, #ff8a8a);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(246,152,152,0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #666, #777);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #777, #888);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .btn-view {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .btn-edit {
            background: linear-gradient(135deg, #ffc107, #ffcd39);
            color: #000;
        }

        .btn-delete {
            background: linear-gradient(135deg, #dc3545, #e74c3c);
        }

        .btn-featured {
            background: linear-gradient(135deg, #8B5CF6, #A855F7);
        }

        .page-title {
            text-align: center;
            color: #F69898;
            font-size: 3rem;
            margin-bottom: 3rem;
            text-shadow: 0 4px 15px rgba(246,152,152,0.3);
            position: relative;
        }

        .page-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(135deg, #F69898, #ff9e9e);
            border-radius: 2px;
        }

        /* GitHub Alert */
        .github-alert {
            background: linear-gradient(135deg, rgba(255,193,7,0.1), rgba(255,205,57,0.1));
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .github-alert h4 {
            color: #ffc107;
            margin-bottom: 15px;
        }

        .github-alert p {
            color: #fff;
            margin-bottom: 15px;
        }

        .admin-section {
            margin-bottom: 4rem;
        }

        .admin-title {
            color: #F69898;
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: linear-gradient(135deg, #333 0%, #444 100%);
            padding: 2.5rem;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .admin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(246,152,152,0.1), transparent);
            transition: left 0.5s;
        }

        .admin-card:hover::before {
            left: 100%;
        }

        .admin-card:hover {
            transform: translateY(-10px);
            border-color: #F69898;
            box-shadow: 0 20px 40px rgba(246, 152, 152, 0.3);
        }

        .admin-icon {
            font-size: 4rem;
            color: #F69898;
            margin-bottom: 1.5rem;
            text-shadow: 0 4px 15px rgba(246,152,152,0.3);
        }

        .admin-card-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #ffffff;
        }

        .admin-card-desc {
            color: #cccccc;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #444;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: #F69898;
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(246,152,152,0.2);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: #F69898;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(246,152,152,0.3);
        }

        .stat-label {
            color: #cccccc;
            font-size: 1.1rem;
        }

        .table-container {
            overflow-x: auto;
            background: linear-gradient(135deg, #333 0%, #444 100%);
            border-radius: 15px;
            margin-top: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .jobs-table {
            width: 100%;
            border-collapse: collapse;
        }

        .jobs-table th,
        .jobs-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #555;
        }

        .jobs-table th {
            background: linear-gradient(135deg, #F69898, #ff9e9e);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .jobs-table tr:hover {
            background: rgba(246,152,152,0.1);
            transform: scale(1.01);
            transition: all 0.3s ease;
        }

        .jobs-table tr.featured-row {
            background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(168,85,247,0.1));
            border-left: 4px solid #8B5CF6;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .status-active {
            color: #28a745;
            font-weight: bold;
            text-shadow: 0 2px 5px rgba(40,167,69,0.3);
        }

        .status-inactive {
            color: #dc3545;
            font-weight: bold;
            text-shadow: 0 2px 5px rgba(220,53,69,0.3);
        }

        .featured-badge {
            background: linear-gradient(135deg, #8B5CF6, #A855F7);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin-right: 8px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .search-filters {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .filter-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #333 0%, #444 100%);
            margin: 2% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            position: relative;
            max-height: 95vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 2px solid #F69898;
        }

        .modal-header {
            background: linear-gradient(135deg, #F69898, #ff9e9e);
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            margin: 0;
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .close {
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: all 0.3s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
        }

        .close:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            padding: 2rem;
        }

        .form-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            padding: 2rem;
            border-top: 2px solid #555;
        }

        .form-required {
            color: #F69898;
        }

        .form-help {
            font-size: 0.9rem;
            color: #aaa;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .featured-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(168,85,247,0.1));
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #8B5CF6;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #555;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #8B5CF6, #A855F7);
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .toggle-switch.active::before {
            left: 33px;
        }

        .import-section {
            padding: 2rem;
        }

        .file-upload {
            border: 3px dashed #F69898;
            border-radius: 15px;
            padding: 4rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin: 2rem 0;
            background: linear-gradient(135deg, rgba(246,152,152,0.05), rgba(246,152,152,0.1));
        }

        .file-upload:hover {
            background: linear-gradient(135deg, rgba(246,152,152,0.1), rgba(246,152,152,0.2));
            border-color: #ff9e9e;
            transform: translateY(-5px);
        }

        .file-upload-icon {
            font-size: 4rem;
            color: #F69898;
            margin-bottom: 1rem;
        }

        /* מערכת מיפוי שדות */
        .mapping-section {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border-radius: 15px;
            padding: 2rem;
            border: 2px solid #F69898;
            margin: 2rem 0;
        }

        .mapping-title {
            color: #F69898;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .mapping-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 2rem;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-label {
            color: #ccc;
        }

        .stat-value {
            color: #F69898;
            font-weight: bold;
        }

        .stat-value.complete {
            color: #28a745;
        }

        .stat-value.incomplete {
            color: #ffc107;
        }

        .mapping-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 2rem;
        }

        .mapping-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr 1fr;
            gap: 15px;
            align-items: center;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #555;
            transition: all 0.3s ease;
        }

        .mapping-row:hover {
            border-color: #F69898;
            background: rgba(246,152,152,0.05);
        }

        .target-field {
            background: linear-gradient(135deg, #F69898, #ff9e9e);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .target-field.required {
            background: linear-gradient(135deg, #ff6b6b, #ff8a8a);
        }

        .arrow {
            color: #F69898;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
        }

        .source-select-container {
            position: relative;
        }

        .source-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #555;
            border-radius: 8px;
            background: linear-gradient(135deg, #2a2a2a 0%, #333333 100%);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .source-select:focus {
            border-color: #F69898;
            outline: none;
            box-shadow: 0 0 15px rgba(246,152,152,0.3);
        }

        .preview-container {
            background: rgba(0,0,0,0.4);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #444;
        }

        .preview-value {
            color: #ccc;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            max-height: 60px;
            overflow-y: auto;
        }

        .mapping-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .btn-disabled {
            background: linear-gradient(135deg, #666, #777) !important;
            cursor: not-allowed !important;
            opacity: 0.6;
        }

        .btn-disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(40,167,69,0.3);
            z-index: 10000;
            display: none;
            animation: slideIn 0.5s ease-out;
            max-width: 400px;
        }

        .notification.error {
            background: linear-gradient(135deg, #dc3545, #e74c3c);
            box-shadow: 0 10px 30px rgba(220,53,69,0.3);
        }

        .notification.warning {
            background: linear-gradient(135deg, #ffc107, #ffcd39);
            color: #000;
            box-shadow: 0 10px 30px rgba(255,193,7,0.3);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 3rem;
        }

        .page-item {
            padding: 0.75rem 1.25rem;
            background: linear-gradient(135deg, #555, #666);
            color: white;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .page-item:hover,
        .page-item.active {
            background: linear-gradient(135deg, #F69898, #ff9e9e);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(246,152,152,0.3);
        }

        .sync-panel {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #444;
        }

        .sync-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .sync-item {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .sync-item-title {
            color: #F69898;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .sync-item-status {
            font-size: 0.9rem;
            color: #ccc;
        }

        .back-to-site {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
            transition:all 0.3s ease;
            z-index: 1000;
        }

        .back-to-site:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40,167,69,0.4);
        }

        .error-message {
            color: #ff6b6b;
            margin-top: 15px;
            display: none;
            background: rgba(255,107,107,0.1);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ff6b6b;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(246,152,152,0.3);
            border-top: 4px solid #F69898;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .footer {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            padding: 3rem 0;
            border-top: 3px solid #F69898;
            margin-top: 4rem;
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .footer-link {
            color: #ffffff;
            text-decoration: none;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .footer-link:hover {
            color: #F69898;
            background: rgba(246,152,152,0.1);
        }

        .copyright {
            text-align: center;
            color: #aaa;
            margin-top: 2rem;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .search-filters {
                grid-template-columns: 1fr;
            }
            
            .filter-buttons {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .sync-info {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 2rem;
            }

            .admin-login-box {
                padding: 30px;
            }

            .mapping-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .mapping-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- כפתור חזרה לאתר -->
    <a href="/" class="back-to-site" id="backToSite" style="display: none;">
        <i class="fas fa-arrow-right"></i> חזור לאתר
    </a>

    <!-- מסך כניסה למערכת הניהול -->
    <div id="adminLoginSection">
        <div class="admin-login-box">
            <div class="text-logo-container" style="margin: 0 0 40px 0; padding: 0;">
                <h2 class="text-logo" style="font-size: 2.5rem;">מה יש פה?</h2>
                <p style="font-size: 1.2rem; margin-bottom: 20px; color: #cccccc;">מערכת ניהול מסונכרנת עם GitHub</p>
            </div>
            
            <h2 class="admin-login-title">כניסה למערכת</h2>
            
            <div class="form-group">
                <label class="form-label">סיסמה</label>
                <input type="password" id="adminPassword" class="form-control" placeholder="הכנס סיסמה...">
            </div>
            
            <!-- הגדרת GitHub URL -->
            <div class="github-config">
                <h4><i class="fab fa-github"></i> הגדרת GitHub</h4>
                <input type="text" id="githubUrl" class="github-url-input" 
                       placeholder="https://raw.githubusercontent.com/USERNAME/REPO/main/jobs.json"
                       value="https://raw.githubusercontent.com/kerenraf/mahyeshpo-website/main/data/jobs.json">
                <div class="github-help">
                    <p><strong>כיצד למצוא את הכתובת הנכונה:</strong></p>
                    <p>1. היכנס ל-GitHub.com לקובץ המשרות שלך</p>
                    <p>2. לחץ על "Raw"</p>
                    <p>3. העתק את הכתובת והדבק כאן</p>
                </div>
            </div>
            
            <button class="btn" onclick="checkAdminPassword()">כניסה למערכת</button>
            
            <div id="adminErrorMessage" class="error-message">
                <i class="fas fa-exclamation-triangle"></i>
                סיסמה שגויה או שגיאה בטעינה מ-GitHub
            </div>
            
            <p style="margin-top: 40px; color: #cccccc;">
                <a href="/" style="color: #F69898; text-decoration: none; font-weight: bold;">
                    <i class="fas fa-arrow-right"></i> חזרה לדף הבית
                </a>
            </p>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">פעולה בוצעה בהצלחה</span>
    </div>

    <!-- תוכן ניהול המשרות -->
    <div id="adminContentSection">
        <!-- כותרת עליונה -->
        <header class="header">
            <div class="container">
                <div class="header-inner">
                    <div class="text-logo-container" style="margin: 0; padding: 0;">
                        <h2 class="text-logo">מה יש פה?</h2>
                    </div>
                    
                    <div class="header-actions">
                        <div class="sync-status" id="syncStatus">
                            <div class="sync-indicator" id="syncIndicator"></div>
                            <span id="syncText">מסונכרן</span>
                        </div>
                        
                        <nav class="main-nav" id="mainNav">
                            <ul>
                                <li><a href="/">דף הבית</a></li>
                                <li><a href="#" class="active">ניהול GitHub</a></li>
                                <li><a href="/#contact">צור קשר</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </header>

        <!-- תוכן ראשי -->
        <main class="container">
            <h1 class="page-title">
                <i class="fab fa-github"></i>
                מערכת ניהול מסונכרנת עם GitHub
            </h1>

            <!-- הודעת GitHub -->
            <div class="github-alert">
                <h4><i class="fab fa-github"></i> עבודה עם GitHub</h4>
                <p>המערכת מסונכרנת עם GitHub בלבד - כל שינוי שתעשה כאן ייוצא לקובץ JSON שתוכל להעלות ל-GitHub</p>
                <p><strong>כתובת GitHub הנוכחית:</strong> <span id="currentGitHubUrl"></span></p>
            </div>

            <!-- סטטיסטיקות -->
            <section class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalJobsCount">0</div>
                    <div class="stat-label">סה"כ משרות</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeJobsCount">0</div>
                    <div class="stat-label">משרות פעילות</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="featuredJobsCount">0</div>
                    <div class="stat-label">משרות מומלצות</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="categoriesCount">0</div>
                    <div class="stat-label">קטגוריות</div>
                </div>
            </section>

            <!-- פאנל סנכרון -->
            <section class="sync-panel">
                <h3 style="color: #F69898; margin-bottom: 15px;">
                    <i class="fab fa-github"></i>
                    סטטוס סנכרון GitHub
                </h3>
                <div class="sync-info">
                    <div class="sync-item">
                        <div class="sync-item-title">GitHub</div>
                        <div class="sync-item-status" id="githubSync">בודק...</div>
                    </div>
                    <div class="sync-item">
                        <div class="sync-item-title">טעינה אחרונה</div>
                        <div class="sync-item-status" id="lastLoad">טוען...</div>
                    </div>
                    <div class="sync-item">
                        <div class="sync-item-title">שינויים מקומיים</div>
                        <div class="sync-item-status" id="localChanges">אין</div>
                    </div>
                    <div class="sync-item">
                        <div class="sync-item-title">בדיקה אחרונה</div>
                        <div class="sync-item-status" id="lastCheck">טוען...</div>
                    </div>
                </div>
            </section>
            
            <!-- כלי ניהול -->
            <section class="admin-section">
                <h2 class="admin-title">
                    <i class="fas fa-tools"></i>
                    כלי ניהול GitHub
                </h2>
                <div class="admin-grid">
                    <div class="admin-card" onclick="syncFromGitHub()">
                        <div class="admin-icon"><i class="fab fa-github"></i></div>
                        <div class="admin-card-title">טען מ-GitHub</div>
                        <div class="admin-card-desc">טען את המשרות העדכניות מ-GitHub</div>
                    </div>
                    
                    <div class="admin-card" onclick="openAddJobModal()">
                        <div class="admin-icon"><i class="fas fa-plus-circle"></i></div>
                        <div class="admin-card-title">הוספת משרה</div>
                        <div class="admin-card-desc">הוסף משרה חדשה עם אפשרות להגדירה כמומלצת</div>
                    </div>
                    
                    <div class="admin-card" onclick="exportForGitHub()">
                        <div class="admin-icon"><i class="fas fa-download"></i></div>
                        <div class="admin-card-title">ייצוא ל-GitHub</div>
                        <div class="admin-card-desc">הורד קובץ JSON לעדכון ב-GitHub</div>
                    </div>

                    <div class="admin-card" onclick="openImportModal()">
                        <div class="admin-icon"><i class="fas fa-file-import"></i></div>
                        <div class="admin-card-title">החלפת משרות חכמה</div>
                        <div class="admin-card-desc">החלף את כל המשרות בקובץ JSON חדש עם מיפוי אוטומטי</div>
                    </div>
                    
                    <div class="admin-card" onclick="bulkActions()">
                        <div class="admin-icon"><i class="fas fa-list-check"></i></div>
                        <div class="admin-card-title">פעולות מרובות</div>
                        <div class="admin-card-desc">ביצוע פעולות על מספר משרות בו זמנית</div>
                    </div>
                    
                    <div class="admin-card" onclick="window.open('/', '_blank')">
                        <div class="admin-icon"><i class="fas fa-eye"></i></div>
                        <div class="admin-card-title">צפייה באתר</div>
                        <div class="admin-card-desc">עבור לדף הראשי לצפייה במשרות</div>
                    </div>
                </div>
            </section>
            
            <!-- רשימת משרות -->
            <section class="jobs-list-section">
                <h2 class="admin-title">
                    <i class="fas fa-briefcase"></i>
                    ניהול משרות
                </h2>
                
                <div class="search-filters">
                    <input type="text" class="form-control" id="searchJobsInput" placeholder="חיפוש חופשי...">
                    
                    <select class="form-control" id="categoryFilterAdmin">
                        <option value="">כל הקטגוריות</option>
                    </select>
                    
                    <select class="form-control" id="statusFilterAdmin">
                        <option value="">כל הסטטוסים</option>
                        <option value="פעיל">פעיל</option>
                        <option value="לא פעיל">לא פעיל</option>
                    </select>

                    <select class="form-control" id="featuredFilterAdmin">
                        <option value="">הכל</option>
                        <option value="true">מומלצות בלבד</option>
                        <option value="false">רגילות בלבד</option>
                    </select>
                </div>
                
                <div class="filter-buttons">
                    <button class="btn" onclick="filterJobsList()">
                        <i class="fas fa-search"></i> חיפוש
                    </button>
                    <button class="btn btn-secondary" onclick="clearJobsFilters()">
                        <i class="fas fa-eraser"></i> נקה
                    </button>
                    <button class="btn" onclick="openBulkModal()">
                        <i class="fas fa-check-square"></i> פעולות מרובות
                    </button>
                </div>
                
                <div class="table-container">
                    <table class="jobs-table" id="jobsTable">
                        <thead>
                            <tr>
                                <th style="width: 50px;">
                                    <input type="checkbox" id="selectAllJobs" onchange="toggleSelectAll()">
                                </th>
                                <th style="width: 80px;">מס' משרה</th>
                                <th>כותרת</th>
                                <th>קטגוריה</th>
                                <th>מיקום</th>
                                <th style="width: 80px;">סטטוס</th>
                                <th style="width: 80px;">מומלצת</th>
                                <th style="width: 220px;">פעולות</th>
                            </tr>
                        </thead>
                        <tbody id="jobsTableBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="jobsPagination">
                    <!-- Will be populated by JavaScript -->
                </div>
            </section>
        </main>

        <!-- מודל הוספת/עריכת משרה -->
        <div id="job-edit-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="edit-modal-title" class="modal-title">
                        <i class="fas fa-plus"></i>
                        הוספת משרה חדשה
                    </h3>
                    <span class="close" onclick="closeEditModal()">&times;</span>
                </div>
                
                <form id="job-edit-form" onsubmit="return saveJob(event)">
                    <input type="hidden" id="edit-job-id">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">מספר משרה</label>
                            <input type="text" id="edit-job-number" class="form-input" placeholder="יוגדר אוטומטי אם ריק">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">כותרת משרה <span class="form-required">*</span></label>
                            <input type="text" id="edit-job-title" class="form-input" required placeholder="למשל: מפתח/ת Full Stack">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">קטגוריה</label>
                            <select id="edit-job-category" class="form-input">
                                <option value="מזון ומסעדנות">מזון ומסעדנות</option>
                                <option value="חינוך והוראה">חינוך והוראה</option>
                                <option value="פיתוח ותוכנה">פיתוח ותוכנה</option>
                                <option value="לוגיסטיקה, מחסנים, שילוח ורכש">לוגיסטיקה ומחסנים</option>
                                <option value="שיווק ומכירות">שיווק ומכירות</option>
                                <option value="בריאות ורפואה">בריאות ורפואה</option>
                                <option value="מנהל ואדמיניסטרציה">מנהל ואדמיניסטרציה</option>
                                <option value="אחר">אחר</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">עיר <span class="form-required">*</span></label>
                            <input type="text" id="edit-job-city" class="form-input" required placeholder="עיר המשרה">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">אזור <span class="form-required">*</span></label>
                            <select id="edit-job-region" class="form-input" required>
                                <option value="מרכז">מרכז</option>
                                <option value="צפון">צפון</option>
                                <option value="חיפה קריות והצפון">חיפה קריות והצפון</option>
                                <option value="ירושלים והסביבה">ירושלים והסביבה</option>
                                <option value="דרום">דרום</option>
                                <option value="שרון">שרון</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">סטטוס</label>
                            <select id="edit-job-status" class="form-input">
                                <option value="פעיל">פעיל</option>
                                <option value="לא פעיל">לא פעיל</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- הגדרה כמשרה מומלצת -->
                    <div style="padding: 0 2rem;">
                        <div class="featured-toggle" id="featuredToggleContainer">
                            <div class="toggle-switch" id="featuredToggle" onclick="toggleFeatured()">
                            </div>
                            <div>
                                <strong style="color: #8B5CF6;">משרה מומלצת</strong>
                                <div style="font-size: 0.9rem; color: #ccc;">משרות מומלצות מופיעות ראשונות באתר עם סימון מיוחד</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 0 2rem;">
                        <div class="form-group">
                            <label class="form-label">תיאור המשרה</label>
                            <textarea id="edit-job-description" class="form-input" rows="4" placeholder="תאר את המשרה..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">דרישות התפקיד</label>
                            <textarea id="edit-job-requirements" class="form-input" rows="4" placeholder="רשום את הדרישות..."></textarea>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="button" class="btn btn-secondary" onclick="closeEditModal()">
                            <i class="fas fa-times"></i> ביטול
                        </button>
                        <button type="submit" class="btn">
                            <i class="fas fa-save"></i> שמור משרה
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- מודל ייבוא משרות עם מיפוי אוטומטי -->
        <div id="import-modal" class="modal">
            <div class="modal-content" style="max-width: 1200px;">
                <div class="modal-header">
                    <h3 class="modal-title">
                        <i class="fas fa-file-import"></i>
                        החלפת משרות עם מיפוי אוטומטי
                    </h3>
                    <span class="close" onclick="closeImportModal()">&times;</span>
                </div>
                
                <div class="import-section">
                    <div class="file-upload" onclick="document.getElementById('file-input').click()">
                        <div class="file-upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                        <h4>גרור קובץ JSON או לחץ להעלאה</h4>
                        <p>המערכת תחליף את כל המשרות הקיימות בנתונים החדשים</p>
                        <p style="color: #ffc107; font-weight: bold;">⚠️ פעולה זו תמחק את כל הנתונים הנוכחיים!</p>
                        <input type="file" id="file-input" accept=".json" style="display: none;" onchange="handleFileUpload(event)">
                    </div>
                    
                    <!-- אזור מיפוי השדות -->
                    <div id="mapping-section" class="mapping-section" style="display: none;">
                        <h3 class="mapping-title">
                            <i class="fas fa-exchange-alt"></i>
                            מיפוי שדות - התאמה בין הקובץ למערכת
                        </h3>
                        
                        <div class="mapping-stats" id="mapping-stats">
                            <!-- יעודכן על ידי JavaScript -->
                        </div>
                        
                        <div class="mapping-grid" id="mapping-container">
                            <!-- יעודכן על ידי JavaScript -->
                        </div>
                        
<button class="btn" style="background: linear-gradient(135deg, #17a2b8, #20c997);" onclick="toggleAutoSplit()">
    <i class="fas fa-cut" id="splitIcon"></i>
    <span id="splitText">פיצול תיאור לדרישות: מופעל</span>
</button>
                        
                        <div class="mapping-actions">
                            <button class="btn btn-secondary" onclick="resetMapping()">
                                <i class="fas fa-undo"></i> איפוס מיפוי
                            </button>
                            <button class="btn" id="execute-import-btn" onclick="executeImport()">
                                <i class="fas fa-sync-alt"></i> החלף כל המשרות
                            </button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="closeImportModal()">
                            <i class="fas fa-times"></i> סגור
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- מודל פעולות מרובות -->
        <div id="bulk-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">
                        <i class="fas fa-list-check"></i>
                        פעולות מרובות
                    </h3>
                    <span class="close" onclick="closeBulkModal()">&times;</span>
                </div>
                
                <div style="padding: 2rem;">
                    <p style="margin-bottom: 20px; font-size: 1.1rem;">
                        נבחרו <span id="selectedCount" style="color: #F69898; font-weight: bold;">0</span> משרות
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="btn" onclick="bulkAction('activate')">
                            <i class="fas fa-check-circle"></i>
                            הפעל הכל
                        </button>
                        <button class="btn btn-secondary" onclick="bulkAction('deactivate')">
                            <i class="fas fa-times-circle"></i>
                            השבת הכל
                        </button>
                        <button class="btn btn-featured" onclick="bulkAction('feature')">
                            <i class="fas fa-star"></i>
                            סמן כמומלצות
                        </button>
                        <button class="btn btn-secondary" onclick="bulkAction('unfeature')">
                            <i class="fas fa-star-o"></i>
                            בטל המלצה
                        </button>
                        <button class="btn btn-delete" onclick="bulkAction('delete')">
                            <i class="fas fa-trash"></i>
                            מחק הכל
                        </button>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-secondary" onclick="closeBulkModal()">
                            <i class="fas fa-times"></i> סגור
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 class="text-logo" style="font-size: 2.5rem;">מה יש פה?</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 15px; color: #cccccc;">מערכת ניהול מסונכרנת עם GitHub</p>
                </div>
                
                <div class="footer-links">
                    <a href="/" class="footer-link">דף הבית</a>
                    <a href="#" class="footer-link">ניהול GitHub</a>
                    <a href="/#search" class="footer-link">חיפוש משרות</a>
                    <a href="/#contact" class="footer-link">צור קשר</a>
                </div>
                
                <p class="copyright">© 2025 מה יש פה? - מערכת ניהול GitHub</p>
            </div>
        </footer>
    </div>

    <script>
        // משתנים גלובליים
        let autoSplitEnabled = true; // פיצול אוטומטי מופעל כברירת מחדל
        let jobs = [];
        let filteredJobs = [];
        let currentPage = 1;
        const jobsPerPage = 15;
        let isFiltered = false;
        let selectedJobs = new Set();
        let featuredJobId = null;
let githubUrl = '';
let hasLocalChanges = false;
let autoSplitEnabled = true; // פיצול אוטומטי מופעל כברירת מחדל
        // מערכת מיפוי שדות מתקדמת
        let importedData = null;
        let fieldMapping = {};
        
        // שדות המערכת הקבועים
        const systemFields = {
            'jobNumber': { label: 'מספר משרה', required: false, type: 'string' },
            'title': { label: 'כותרת המשרה', required: true, type: 'string' },
            'category': { label: 'קטגוריה', required: false, type: 'string' },
            'city': { label: 'עיר', required: true, type: 'string' },
            'region': { label: 'אזור', required: true, type: 'string' },
            'description': { label: 'תיאור המשרה', required: false, type: 'string' },
            'requirements': { label: 'דרישות התפקיד', required: false, type: 'string' },
            'status': { label: 'סטטוס', required: false, type: 'string' },
            'featured': { label: 'משרה מומלצת', required: false, type: 'boolean' }
        };

        

        // אתחול מיפוי אוטומטי חכם
        function initializeSmartMapping(sourceFields) {
            fieldMapping = {};
            
            // מיפוי חכם על בסיס דמיון בשמות
            const mappingRules = {
                'jobNumber': ['job_number', 'jobnum', 'job_id', 'מספר_משרה', 'מספר משרה', 'jobNumber', 'id', 'משרה_מספר'],
                'title': ['title', 'job_title', 'position', 'כותרת', 'תפקיד', 'position_title', 'job_name', 'שם_משרה'],
                'category': ['category', 'job_category', 'קטגוריה', 'סוג_משרה', 'department', 'field', 'תחום'],
                'city': ['city', 'location', 'עיר', 'מיקום', 'workplace', 'place', 'מקום_עבודה'],
                'region': ['region', 'area', 'אזור', 'מחוז', 'district', 'zone', 'איזור'],
                'description': ['description', 'job_description', 'תיאור', 'פרטים', 'details', 'about', 'info'],
                'requirements': ['requirements', 'job_requirements', 'דרישות', 'qualification', 'skills', 'כישורים'],
                'status': ['status', 'job_status', 'סטטוס', 'active', 'state', 'מצב', 'פעיל'],
                'featured': ['featured', 'highlighted', 'מומלצת', 'premium', 'featured_job', 'מומלץ', 'vip']
            };

            Object.keys(systemFields).forEach(systemField => {
                const rules = mappingRules[systemField];
                for (let sourceField of sourceFields) {
                    const normalizedSource = sourceField.toLowerCase().replace(/[_\s-]/g, '');
                    const foundMatch = rules.find(rule => 
                        normalizedSource.includes(rule.toLowerCase().replace(/[_\s-]/g, '')) ||
                        rule.toLowerCase().replace(/[_\s-]/g, '').includes(normalizedSource)
                    );
                    
                    if (foundMatch) {
                        fieldMapping[systemField] = sourceField;
                        break;
                    }
                }
            });
        }

        // פונקציות אתחול
        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            const correctPassword = "yarin080708";
            const gitUrl = document.getElementById('githubUrl').value.trim();
            
            if (password !== correctPassword) {
                showError('סיסמה שגויה');
                return;
            }
            
            if (!gitUrl) {
                showError('יש להזין כתובת GitHub');
                return;
            }
            
            githubUrl = gitUrl;
            localStorage.setItem('github_url', githubUrl);
            
            document.getElementById('adminLoginSection').style.display = 'none';
            document.getElementById('adminContentSection').style.display = 'block';
            document.getElementById('backToSite').style.display = 'block';
            
            initializeAdminSystem();
        }

        function showError(message) {
            const errorDiv = document.getElementById('adminErrorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 3000);
        }

        // אתחול מערכת הניהול
        function initializeAdminSystem() {
            document.getElementById('currentGitHubUrl').textContent = githubUrl;
            showNotification('טוען מ-GitHub...', 'warning');
            showLoading();
            
            syncFromGitHub()
                .then(() => {
                    updateStatistics();
                    showNotification('המערכת מוכנה לשימוש!', 'success');
                })
                .catch(error => {
                    console.error('שגיאה באתחול:', error);
                    showNotification('שגיאה בטעינה מ-GitHub', 'error');
                })
                .finally(() => {
                    hideLoading();
                });
        }

        // סנכרון עם GitHub
        async function syncFromGitHub() {
            try {
                showSyncStatus('syncing');
                const response = await fetch(githubUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!Array.isArray(data)) {
                    throw new Error('הקובץ מ-GitHub אינו מערך תקין');
                }
                
                jobs = data.map(job => ({
                    jobNumber: job.jobNumber || generateJobNumber(),
                    title: job.title || '',
                    category: job.category || 'אחר',
                    city: job.city || '',
                    region: job.region || 'מרכז',
                    description: job.description || '',
                    requirements: job.requirements || '',
                    status: job.status || 'פעיל',
                    featured: job.featured || false
                }));
                
                updateAllDisplays();
                updateSyncStatus('github', true);
                hasLocalChanges = false;
                updateLocalChangesStatus();
                
                console.log('✅ נטענו', jobs.length, 'משרות מ-GitHub');
                
            } catch (error) {
                console.error('❌ שגיאה בטעינה מ-GitHub:', error);
                updateSyncStatus('github', false);
                throw error;
            }
        }

        // ייבוא וייצוא עם מיפוי מתקדם
        function openImportModal() {
            document.getElementById('import-modal').style.display = 'block';
        }

        function closeImportModal() {
            document.getElementById('import-modal').style.display = 'none';
            document.getElementById('file-input').value = '';
            document.getElementById('mapping-section').style.display = 'none';
            importedData = null;
            fieldMapping = {};
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showLoading();
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (!file.name.endsWith('.json')) {
                        throw new Error('רק קבצי JSON נתמכים במערכת זו');
                    }
                    
                    importedData = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedData)) {
                        throw new Error('הקובץ חייב להכיל מערך של משרות');
                    }
                    
                    if (importedData.length === 0) {
                        throw new Error('הקובץ ריק - אין משרות לייבא');
                    }
                    
                    // זיהוי השדות בקובץ המקור
                    const sourceFields = Object.keys(importedData[0]);
                    
                    // יצירת מיפוי אוטומטי חכם
                    initializeSmartMapping(sourceFields);
                    
                    // הצגת ממשק המיפוי
                    showMappingInterface(sourceFields);
                    
                    hideLoading();
                    showNotification(`זוהו ${importedData.length} משרות עם ${sourceFields.length} שדות. המערכת תחליף את כל הנתונים הקיימים!`, 'warning');
                    
                } catch (error) {
                    hideLoading();
                    showNotification('שגיאה: ' + error.message, 'error');
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function showMappingInterface(sourceFields) {
            const mappingSection = document.getElementById('mapping-section');
            const mappingContainer = document.getElementById('mapping-container');
            
            mappingContainer.innerHTML = '';
            
            // יצירת שורות מיפוי
            Object.keys(systemFields).forEach(systemField => {
                const fieldInfo = systemFields[systemField];
                const row = document.createElement('div');
                row.className = 'mapping-row';
                
                row.innerHTML = `
                    <div class="target-field ${fieldInfo.required ? 'required' : ''}">
                        ${fieldInfo.label}
                        ${fieldInfo.required ? ' <span style="color: #ff6b6b;">*</span>' : ''}
                    </div>
                    <div class="arrow">←</div>
                    <div class="source-select-container">
                        <select class="source-select" onchange="updateMapping('${systemField}', this.value)">
                            <option value="">בחר שדה מקור...</option>
                            ${sourceFields.map(field => 
                                `<option value="${field}" ${fieldMapping[systemField] === field ? 'selected' : ''}>${field}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="preview-container">
                        <div class="preview-value" id="preview-${systemField}">
                            ${fieldMapping[systemField] ? getPreviewValue(fieldMapping[systemField]) : 'לא נבחר'}
                        </div>
                    </div>
                `;
                
                mappingContainer.appendChild(row);
            });
            
            mappingSection.style.display = 'block';
            updateMappingStats();
        }

        function updateMapping(systemField, sourceField) {
            if (sourceField) {
                fieldMapping[systemField] = sourceField;
            } else {
                delete fieldMapping[systemField];
            }
            
            // עדכון תצוגה מקדימה
            const previewElement = document.getElementById(`preview-${systemField}`);
            if (previewElement) {
                previewElement.textContent = sourceField ? getPreviewValue(sourceField) : 'לא נבחר';
            }
            
            updateMappingStats();
        }

        function getPreviewValue(sourceField) {
            if (!importedData || importedData.length === 0) return '';
            
            const sampleValue = importedData[0][sourceField];
            if (sampleValue === undefined || sampleValue === null) return '(ריק)';
            
            const strValue = String(sampleValue);
            return strValue.length > 30 ? strValue.substring(0, 30) + '...' : strValue;
        }

        function updateMappingStats() {
            const mappedCount = Object.keys(fieldMapping).length;
            const requiredCount = Object.keys(systemFields).filter(key => systemFields[key].required).length;
            const mappedRequired = Object.keys(fieldMapping).filter(key => systemFields[key].required).length;
            
            document.getElementById('mapping-stats').innerHTML = `
                <div class="stat-item">
                    <span class="stat-label">שדות ממופים:</span>
                    <span class="stat-value">${mappedCount}/${Object.keys(systemFields).length}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">שדות חובה ממופים:</span>
                    <span class="stat-value ${mappedRequired === requiredCount ? 'complete' : 'incomplete'}">${mappedRequired}/${requiredCount}</span>
                </div>
            `;
            
            // הפעלת/השבתת כפתור הייבוא
            const importBtn = document.getElementById('execute-import-btn');
            importBtn.disabled = mappedRequired < requiredCount;
            importBtn.className = `btn ${mappedRequired >= requiredCount ? '' : 'btn-disabled'}`;
        }

        function resetMapping() {
            fieldMapping = {};
            if (importedData && importedData.length > 0) {
                const sourceFields = Object.keys(importedData[0]);
                initializeSmartMapping(sourceFields);
                showMappingInterface(sourceFields);
                showNotification('המיפוי אופס והוגדר מחדש אוטומטית', 'success');
            }

            function toggleAutoSplit() {
    autoSplitEnabled = !autoSplitEnabled;
    const text = document.getElementById('splitText');
    const icon = document.getElementById('splitIcon');
    
    if (autoSplitEnabled) {
        text.textContent = 'פיצול תיאור לדרישות: מופעל';
        icon.className = 'fas fa-cut';
    } else {
        text.textContent = 'פיצול תיאור לדרישות: כבוי';
        icon.className = 'fas fa-times';
    }
}       
        }
function extractRequirementsFromDescription(description) {
    if (!description) return { description: '', requirements: '' };
    
    // מילות מפתח לזיהוי דרישות
    const requirementKeywords = [
        'דרישות:', 'דרישות התפקיד:', 'נדרש:', 'חובה:', 'כישורים נדרשים:',
        'Requirements:', 'Required:', 'Must have:', 'Qualifications:',
        'צריך:', 'דרוש:', 'כישורים:', 'ניסיון:', 'השכלה:'
    ];
    
    const text = description.trim();
    let splitIndex = -1;
    
    // חיפוש מילת מפתח שמתחילה דרישות
    for (let keyword of requirementKeywords) {
        const index = text.indexOf(keyword);
        if (index !== -1) {
            splitIndex = index;
            break;
        }
    }
    
    if (splitIndex === -1) {
        // אין דרישות מזוהות - כל הטקסט נשאר תיאור
        return { description: text, requirements: '' };
    }
    
    // פיצול הטקסט
    const descriptionPart = text.substring(0, splitIndex).trim();
    const requirementsPart = text.substring(splitIndex).trim();
    
    return {
        description: descriptionPart,
        requirements: requirementsPart
    };
}
        
        function executeImport() {
            if (!importedData || Object.keys(fieldMapping).length === 0) {
                showNotification('אין נתונים לייבא', 'error');
                return;
            }
            
            // אישור החלפה
            if (jobs.length > 0) {
                const confirmed = confirm(`האם אתה בטוח שברצונך להחליף את כל ${jobs.length} המשרות הקיימות עם ${importedData.length} משרות חדשות?

⚠️ פעולה זו תמחק את כל הנתונים הקיימים!

לחץ OK להמשך או Cancel לביטול.`);
                
                if (!confirmed) {
                    return;
                }
            }
            
            showLoading();
            
            try {
                let successCount = 0;
                let errorCount = 0;
                const newJobs = []; // מערך חדש לנתונים המובאים
                
                importedData.forEach((sourceJob, index) => {
                    try {
                        const mappedJob = {};
                        
                        // מיפוי השדות
                        Object.keys(systemFields).forEach(systemField => {
                            const sourceField = fieldMapping[systemField];
                            
                            if (sourceField && sourceJob.hasOwnProperty(sourceField)) {
                                let value = sourceJob[sourceField];
                                
                                // טיפול בסוגי נתונים שונים
                                if (systemField === 'featured') {
                                    // המרה לבוליאני
                                    value = value === true || value === 'true' || value === 'כן' || value === '1' || value === 1;
                                } else if (systemFields[systemField].type === 'string') {
                                    value = String(value || '').trim();
                                }
                                
if (systemField === 'descriif (systemField === 'description' && value && autoSplitEnabled) {
    ption' && value) {
    // אם זה שדה תיאור ויש בו תוכן, נבדוק אם יש דרישות להפריד
    const extracted = extractRequirementsFromDescription(value);
    mappedJob['description'] = extracted.description;
    
    // אם יש דרישות ושדה הדרישות לא ממופה, נוסיף אותן
    if (extracted.requirements && !fieldMapping['requirements']) {
        mappedJob['requirements'] = extracted.requirements;
    }
} else {
    mappedJob[systemField] = value;
}
                            } else {
                                // ערכי ברירת מחדל - רק אם השדה לא ממופה
                                switch (systemField) {
                                    case 'jobNumber':
                                        // אם יש מיפוי לשדה jobNumber, נשמור אותו מהמקור
                                        if (!fieldMapping['jobNumber']) {
                                            mappedJob[systemField] = generateJobNumberForImport(newJobs, index);
                                        }
                                        break;
                                    case 'status':
                                        mappedJob[systemField] = 'פעיל';
                                        break;
                                    case 'category':
                                        mappedJob[systemField] = 'אחר';
                                        break;
                                    case 'region':
                                        mappedJob[systemField] = 'מרכז';
                                        break;
                                    case 'featured':
                                        mappedJob[systemField] = false;
                                        break;
                                    default:
                                        mappedJob[systemField] = '';
                                }
                            }
                        });
                        
                        // וידוא שיש מספר משרה (אם לא ממופה או ריק)
                        if (!mappedJob.jobNumber || mappedJob.jobNumber.trim() === '') {
                            mappedJob.jobNumber = generateJobNumberForImport(newJobs, index);
                        }

                        // בדיקת שדות חובה
                        const missingRequired = Object.keys(systemFields)
                            .filter(field => systemFields[field].required && !mappedJob[field]);
                        
                        if (missingRequired.length > 0) {
                            console.warn(`שורה ${index + 1}: חסרים שדות חובה:`, missingRequired);
                            errorCount++;
                            return;
                        }
                        
                        newJobs.push(mappedJob);
                        successCount++;
                        
                    } catch (error) {
                        console.error(`שגיאה בשורה ${index + 1}:`, error);
                        errorCount++;
                    }
                });
                
                // החלפת הנתונים הקיימים עם החדשים
                if (successCount > 0) {
                    jobs.length = 0; // מחיקת כל הנתונים הקיימים
                    jobs.push(...newJobs); // הוספת הנתונים החדשים
                    selectedJobs.clear(); // ניקוי הבחירות
                    currentPage = 1; // חזרה לעמוד הראשון
                }
                
                markLocalChanges();
                updateAllDisplays();
                closeImportModal();
                hideLoading();
                
                if (successCount > 0) {
                    showNotification(
                        `הייבוא הושלם! החלפת ${successCount} משרות` + 
                        (errorCount > 0 ? ` (${errorCount} שגיאות)` : ''), 
                        'success'
                    );
                } else {
                    showNotification('לא ניתן היה לייבא אף משרה בשל שגיאות', 'error');
                }
                
            } catch (error) {
                hideLoading();
                showNotification('שגיאה בייבוא: ' + error.message, 'error');
            }
        }

        // פונקציה מיוחדת ליצירת מספרי משרות בייבוא
        function generateJobNumberForImport(existingJobs, index) {
            const baseNumber = index + 1;
            return `A-${baseNumber.toString().padStart(5, '0')}`;
        }

        // עדכון כל התצוגות
        function updateAllDisplays() {
            if (isFiltered) {
                applyFilters();
            } else {
                filteredJobs = [...jobs];
            }
            
            displayJobsAdvanced();
            updateCategoryFilters();
            updateStatistics();
        }

        // הצגת משרות
        function displayJobsAdvanced() {
            const tableBody = document.getElementById('jobsTableBody');
            tableBody.innerHTML = '';
            
            const jobsToDisplay = filteredJobs;
            
            if (jobsToDisplay.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="8" style="text-align: center; padding: 3rem; color: #aaa;">
                    ${isFiltered ? 
                        'לא נמצאו משרות התואמות את הסינון<br><button class="btn btn-secondary" onclick="clearJobsFilters()">נקה סינון</button>' : 
                        'אין משרות להצגה<br><button class="btn" onclick="syncFromGitHub()">טען מ-GitHub</button>'
                    }
                </td>`;
                tableBody.appendChild(row);
                document.getElementById('jobsPagination').innerHTML = '';
                return;
            }
            
            const totalPages = Math.ceil(jobsToDisplay.length / jobsPerPage);
            currentPage = Math.min(currentPage, totalPages);
            currentPage = Math.max(currentPage, 1);
            
            const startIndex = (currentPage - 1) * jobsPerPage;
            const endIndex = Math.min(startIndex + jobsPerPage, jobsToDisplay.length);
            const pageJobs = jobsToDisplay.slice(startIndex, endIndex);
            
            pageJobs.forEach((job, index) => {
                const actualIndex = startIndex + index;
                const originalIndex = jobs.findIndex(j => 
                    j.jobNumber === job.jobNumber && j.title === job.title
                );
                
                const row = document.createElement('tr');
                if (job.featured) {
                    row.classList.add('featured-row');
                }
                
                const isSelected = selectedJobs.has(originalIndex);
                row.innerHTML = `
                    <td>
                        <input type="checkbox" ${isSelected ? 'checked' : ''} 
                               onchange="toggleJobSelection(${originalIndex})">
                    </td>
                    <td>${job.jobNumber || 'אוטו'}</td>
                    <td>
                        ${job.featured ? '<span class="featured-badge">⭐ מומלצת</span>' : ''}
                        ${job.title || '-'}
                    </td>
                    <td>${job.category || 'אחר'}</td>
                    <td>${job.city ? job.city + ', ' + job.region : job.region}</td>
                    <td class="${job.status === 'לא פעיל' ? 'status-inactive' : 'status-active'}">
                        ${job.status || 'פעיל'}
                    </td>
                    <td>
                        <button class="btn btn-sm ${job.featured ? 'btn-featured' : 'btn-secondary'}" 
                                onclick="toggleJobFeatured(${originalIndex})" 
                                title="${job.featured ? 'בטל המלצה' : 'סמן כמומלצת'}">
                            <i class="fas ${job.featured ? 'fa-star' : 'fa-star-o'}"></i>
                        </button>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-view" onclick="viewJobAdvanced(${originalIndex})" title="הצג פרטים">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-edit" onclick="editJobAdvanced(${originalIndex})" title="ערוך">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-delete" onclick="deleteJobAdvanced(${originalIndex})" title="מחק">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            updatePaginationAdvanced(totalPages);
        }

        // עדכון מניית דפים
        function updatePaginationAdvanced(totalPages) {
            const pagination = document.getElementById('jobsPagination');
            pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('div');
                pageBtn.className = 'page-item' + (i === currentPage ? ' active' : '');
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage = i;
                    displayJobsAdvanced();
                };
                pagination.appendChild(pageBtn);
            }
        }

        // עדכון סטטיסטיקות
        function updateStatistics() {
            const total = jobs.length;
            const active = jobs.filter(job => job.status === 'פעיל').length;
            const featured = jobs.filter(job => job.featured).length;
            const categories = [...new Set(jobs.map(job => job.category).filter(Boolean))].length;
            
            document.getElementById('totalJobsCount').textContent = total;
            document.getElementById('activeJobsCount').textContent = active;
            document.getElementById('featuredJobsCount').textContent = featured;
            document.getElementById('categoriesCount').textContent = categories;
        }

        // עדכון מסנני קטגוריות
        function updateCategoryFilters() {
            const categoryFilter = document.getElementById('categoryFilterAdmin');
            const currentValue = categoryFilter.value;
            
            const categories = [...new Set(jobs.map(job => job.category).filter(Boolean))].sort();
            
            categoryFilter.innerHTML = '<option value="">כל הקטגוריות</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
            
            categoryFilter.value = currentValue;
        }

        // פונקציות ניהול משרות
        function toggleJobSelection(index) {
            if (selectedJobs.has(index)) {
                selectedJobs.delete(index);
            } else {
                selectedJobs.add(index);
            }
        }

        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAllJobs');
            if (selectAllCheckbox.checked) {
                filteredJobs.forEach((job, index) => {
                    const originalIndex = jobs.findIndex(j => 
                        j.jobNumber === job.jobNumber && j.title === job.title
                    );
                    if (originalIndex !== -1) {
                        selectedJobs.add(originalIndex);
                    }
                });
            } else {
                selectedJobs.clear();
            }
            displayJobsAdvanced();
        }

        function toggleJobFeatured(index) {
            jobs[index].featured = !jobs[index].featured;
            markLocalChanges();
            updateAllDisplays();
            showNotification(
                jobs[index].featured ? 'המשרה סומנה כמומלצת' : 'ההמלצה בוטלה',
                'success'
            );
        }

        function editJobAdvanced(index) {
            const job = jobs[index];
            
            document.getElementById('edit-modal-title').innerHTML = '<i class="fas fa-edit"></i> עריכת משרה';
            document.getElementById('edit-job-id').value = index;
            document.getElementById('edit-job-number').value = job.jobNumber || '';
            document.getElementById('edit-job-title').value = job.title || '';
            document.getElementById('edit-job-category').value = job.category || 'אחר';
            document.getElementById('edit-job-city').value = job.city || '';
            document.getElementById('edit-job-region').value = job.region || 'מרכז';
            document.getElementById('edit-job-status').value = job.status || 'פעיל';
            document.getElementById('edit-job-description').value = job.description || '';
            document.getElementById('edit-job-requirements').value = job.requirements || '';
            
            featuredJobId = job.featured;
            updateFeaturedToggle();
            
            document.getElementById('job-edit-modal').style.display = 'block';
        }

        function viewJobAdvanced(index) {
            const job = jobs[index];
            let details = '';
            
            details += `🔢 מספר משרה: ${job.jobNumber || 'אוטומטי'}\n`;
            details += `📋 כותרת: ${job.title || 'לא הוגדר'}\n`;
            details += `📂 קטגוריה: ${job.category || 'אחר'}\n`;
            details += `📍 מיקום: ${job.city ? job.city + ', ' + job.region : job.region}\n`;
            details += `📊 סטטוס: ${job.status || 'פעיל'}\n`;
            details += `⭐ מומלצת: ${job.featured ? 'כן' : 'לא'}\n\n`;
            details += `📝 תיאור המשרה:\n${job.description || '(אין תיאור)'}\n\n`;
            details += `📋 דרישות התפקיד:\n${job.requirements || '(אין דרישות מיוחדות)'}`;
            
            alert(details);
        }

        function deleteJobAdvanced(index) {
            const job = jobs[index];
            if (confirm(`האם אתה בטוח שברצונך למחוק את המשרה:\n"${job.title}"?`)) {
                jobs.splice(index, 1);
                selectedJobs.delete(index);
                markLocalChanges();
                updateAllDisplays();
                showNotification('המשרה נמחקה', 'success');
            }
        }

        // פונקציות מודל
        function openAddJobModal() {
            document.getElementById('edit-modal-title').innerHTML = '<i class="fas fa-plus"></i> הוספת משרה חדשה';
            document.getElementById('job-edit-form').reset();
            document.getElementById('edit-job-id').value = '';
            
            featuredJobId = false;
            updateFeaturedToggle();
            
            document.getElementById('job-edit-modal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('job-edit-modal').style.display = 'none';
        }

        function saveJob(event) {
            event.preventDefault();
            
            const id = document.getElementById('edit-job-id').value;
            const job = {
                jobNumber: document.getElementById('edit-job-number').value || generateJobNumber(),
                title: document.getElementById('edit-job-title').value,
                category: document.getElementById('edit-job-category').value,
                city: document.getElementById('edit-job-city').value,
                region: document.getElementById('edit-job-region').value,
                status: document.getElementById('edit-job-status').value,
                description: document.getElementById('edit-job-description').value,
                requirements: document.getElementById('edit-job-requirements').value,
                featured: featuredJobId
            };
            
            if (id === '') {
                jobs.push(job);
                showNotification('משרה חדשה נוספה!', 'success');
            } else {
                jobs[parseInt(id)] = job;
                showNotification('המשרה עודכנה!', 'success');
            }
            
            markLocalChanges();
            updateAllDisplays();
            closeEditModal();
            return false;
        }

        function generateJobNumber() {
            const existing = jobs.map(job => job.jobNumber).filter(Boolean);
            const numbers = existing.map(num => {
                const match = num.match(/(\d+)/);
                return match ? parseInt(match[1]) : 0;
            });
            const maxNumber = numbers.length > 0 ? Math.max(...numbers) : 0;
            return `A-${(maxNumber + 1).toString().padStart(5, '0')}`;
        }

        // טוגל למשרה מומלצת
        function toggleFeatured() {
            featuredJobId = !featuredJobId;
            updateFeaturedToggle();
        }

        function updateFeaturedToggle() {
            const toggle = document.getElementById('featuredToggle');
            if (featuredJobId) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }

        // סינון
        function filterJobsList() {
            applyFilters();
            currentPage = 1;
            displayJobsAdvanced();
        }

        function applyFilters() {
            const searchText = document.getElementById('searchJobsInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilterAdmin').value;
            const statusFilter = document.getElementById('statusFilterAdmin').value;
            const featuredFilter = document.getElementById('featuredFilterAdmin').value;
            
            isFiltered = searchText || categoryFilter || statusFilter || featuredFilter;
            
            filteredJobs = jobs.filter(job => {
                const matchesSearch = !searchText || 
                    (job.title && job.title.toLowerCase().includes(searchText)) ||
                    (job.jobNumber && job.jobNumber.toLowerCase().includes(searchText)) ||
                    (job.city && job.city.toLowerCase().includes(searchText));
                
                const matchesCategory = !categoryFilter || job.category === categoryFilter;
                const matchesStatus = !statusFilter || job.status === statusFilter;
                const matchesFeatured = !featuredFilter || 
                    (featuredFilter === 'true' && job.featured) ||
                    (featuredFilter === 'false' && !job.featured);
                
                return matchesSearch && matchesCategory && matchesStatus && matchesFeatured;
            });
        }

        function clearJobsFilters() {
            document.getElementById('searchJobsInput').value = '';
            document.getElementById('categoryFilterAdmin').value = '';
            document.getElementById('statusFilterAdmin').value = '';
            document.getElementById('featuredFilterAdmin').value = '';
            
            isFiltered = false;
            filteredJobs = [...jobs];
            selectedJobs.clear();
            currentPage = 1;
            displayJobsAdvanced();
        }

        // פעולות מרובות
        function openBulkModal() {
            if (selectedJobs.size === 0) {
                showNotification('יש לבחור לפחות משרה אחת', 'warning');
                return;
            }
            
            document.getElementById('selectedCount').textContent = selectedJobs.size;
            document.getElementById('bulk-modal').style.display = 'block';
        }

        function closeBulkModal() {
            document.getElementById('bulk-modal').style.display = 'none';
        }

        function bulkAction(action) {
            if (selectedJobs.size === 0) return;
            
            let message = '';
            
            switch (action) {
                case 'activate':
                    selectedJobs.forEach(index => {
                        jobs[index].status = 'פעיל';
                    });
                    message = `${selectedJobs.size} משרות הופעלו`;
                    break;
                    
                case 'deactivate':
                    selectedJobs.forEach(index => {
                        jobs[index].status = 'לא פעיל';
                    });
                    message = `${selectedJobs.size} משרות הושבתו`;
                    break;
                    
                case 'feature':
                    selectedJobs.forEach(index => {
                        jobs[index].featured = true;
                    });
                    message = `${selectedJobs.size} משרות סומנו כמומלצות`;
                    break;
                    
                case 'unfeature':
                    selectedJobs.forEach(index => {
                        jobs[index].featured = false;
                    });
                    message = `${selectedJobs.size} משרות בוטלה המלצתן`;
                    break;
                    
                case 'delete':
                    if (!confirm(`האם אתה בטוח שברצונך למחוק ${selectedJobs.size} משרות?`)) {
                        return;
                    }
                    
                    const sortedIndexes = Array.from(selectedJobs).sort((a, b) => b - a);
                    sortedIndexes.forEach(index => {
                        jobs.splice(index, 1);
                    });
                    
                    selectedJobs.clear();
                    message = `${sortedIndexes.length} משרות נמחקו`;
                    break;
            }
            
            markLocalChanges();
            updateAllDisplays();
            closeBulkModal();
            showNotification(message, 'success');
        }

        function bulkActions() {
            if (selectedJobs.size === 0) {
                showNotification('בחר משרות קודם', 'warning');
                return;
            }
            openBulkModal();
        }

        function exportForGitHub() {
            if (jobs.length === 0) {
                showNotification('אין משרות לייצוא', 'warning');
                return;
            }
            
            const jobsJson = JSON.stringify(jobs, null, 2);
            const blob = new Blob([jobsJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = 'jobs.json';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            URL.revokeObjectURL(url);
            
            showNotification('קובץ ל-GitHub יוצא!', 'success');
            
            setTimeout(() => {
                alert(`קובץ jobs.json הורד בהצלחה!

הוראות לעדכון GitHub:
1. היכנס ל-GitHub לפרויקט שלך
2. נווט לקובץ המשרות שלך
3. לחץ על "Edit" (עיפרון)
4. מחק את התוכן הקיים
5. העתק והדבק את תוכן הקובץ החדש
6. לחץ "Commit changes"

✅ האתר יתעדכן אוטומטית!`);
            }, 1000);
        }

        // עדכון סטטוס
        function markLocalChanges() {
            hasLocalChanges = true;
            updateLocalChangesStatus();
        }

        function updateLocalChangesStatus() {
            const element = document.getElementById('localChanges');
            if (hasLocalChanges) {
                element.innerHTML = '<i class="fas fa-exclamation-triangle" style="color: #ffc107;"></i> יש שינויים';
            } else {
                element.innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> אין';
            }
        }

        function updateSyncStatus(system, isConnected) {
            const element = document.getElementById('githubSync');
            if (isConnected) {
                element.innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> מחובר';
            } else {
                element.innerHTML = '<i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i> שגיאה';
            }
            
            document.getElementById('lastLoad').textContent = new Date().toLocaleString('he-IL');
            document.getElementById('lastCheck').textContent = new Date().toLocaleString('he-IL');
        }

        function showSyncStatus(status) {
            const indicator = document.getElementById('syncIndicator');
            const text = document.getElementById('syncText');
            
            switch(status) {
                case 'syncing':
                    indicator.className = 'sync-indicator syncing';
                    text.textContent = 'מסנכרן...';
                    break;
                case 'success':
                    indicator.className = 'sync-indicator';
                    text.textContent = 'מסונכרן';
                    break;
                case 'error':
                    indicator.className = 'sync-indicator error';
                    text.textContent = 'שגיאה';
                    break;
            }
        }

        // פונקציות עזר
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const textElement = document.getElementById('notificationText');
            
            const icons = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-triangle', 
                'warning': 'fas fa-exclamation-circle'
            };
            
            notification.className = `notification ${type}`;
            textElement.innerHTML = `<i class="${icons[type]}"></i> ${message}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, type === 'error' ? 5000 : 3000);
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // אתחול
        document.addEventListener('DOMContentLoaded', function() {
            // טעינת URL מהאחסון המקומי
            const savedUrl = localStorage.getItem('github_url');
            if (savedUrl) {
                document.getElementById('githubUrl').value = savedUrl;
            }
            
            // מאזיני אירועים
            document.getElementById('adminPassword').addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    checkAdminPassword();
                }
            });
        });

        // סגירת מודלים
        window.addEventListener('click', function(event) {
            const modals = ['import-modal', 'job-edit-modal', 'bulk-modal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modals = ['import-modal', 'job-edit-modal', 'bulk-modal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
        });

        // פונקציות גלובליות
        window.checkAdminPassword = checkAdminPassword;
        window.syncFromGitHub = syncFromGitHub;
        window.openImportModal = openImportModal;
        window.closeImportModal = closeImportModal;
        window.handleFileUpload = handleFileUpload;
        window.openAddJobModal = openAddJobModal;
        window.closeEditModal = closeEditModal;
        window.saveJob = saveJob;
        window.toggleFeatured = toggleFeatured;
        window.editJobAdvanced = editJobAdvanced;
        window.viewJobAdvanced = viewJobAdvanced;
        window.deleteJobAdvanced = deleteJobAdvanced;
        window.toggleJobSelection = toggleJobSelection;
        window.toggleSelectAll = toggleSelectAll;
        window.toggleJobFeatured = toggleJobFeatured;
        window.filterJobsList = filterJobsList;
        window.clearJobsFilters = clearJobsFilters;
        window.openBulkModal = openBulkModal;
        window.closeBulkModal = closeBulkModal;
        window.bulkAction = bulkAction;
        window.exportForGitHub = exportForGitHub;
        window.bulkActions = bulkActions;
        window.resetMapping = resetMapping;
        window.updateMapping = updateMapping;
        window.executeImport = executeImport;
        window.toggleAutoSplit = toggleAutoSplit;

        console.log('🚀 מערכת ניהול GitHub עם מיפוי שדות נטענה בהצלחה!');
    </script>
</body>
</html>
